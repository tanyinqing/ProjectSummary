 # 2017 08 01
[文档地址](http://pan.baidu.com/disk/home?errno=0&errmsg=Auth%20Login%20Sucess&&bduss=&ssnerror=0&#list/vmode=list&path=%2F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%B9%2F%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%2FMarkDown%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3 "查看")→[源文件相关](http://pan.baidu.com/disk/home?errno=0&errmsg=Auth%20Login%20Sucess&&bduss=&ssnerror=0&#list/vmode=list&path=%2F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%B9%2F%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%2FAndBaseDemo%E6%A1%86%E6%9E%B6 "查看")→[首页](https://tanyinqing.github.io/)

D:\workspace\AndBaseDemo

<h1 id="1">目录列表</h1> 

* 页面→[1. 类 MainActivity主页](#0301)→

* 资源→[1. themes](#0103)→[2. styles](#0104)→[3. colors](#0105)→[4. Drawable资源](#0106)→[5. 权限](#0101)→[6. 清单文件](#0108)→[2. Android Studio中使用.9.png](#0107)

# 最常用的服务
<h1 id="106">106. 各种集合框架</h1> 
[1.各种集合框架](#10601) ——  [2.进度条](#10602) —— [3.土司](#10603) ——  [4.容器的运用list与map相互嵌套 动态获得数据](#10604) ——  [5.图片下载器](#10605)

<h1 id="107">107. 各种类</h1>

[1. MediaRecorder](#10701)

<h1 id="01">1. 简介</h1> 
1. 简介
2. studio bug
[1. No resource found that matches the given name](#0102)

<h1 id="58">58. IocViewActivity  ioc示例  注解绑定</h1>  [1. IOC适配View  注解绑定](#5801)

<h1 id="02">2.LauncherActivity  首页</h1> 


<h1 id="04">04. DemoMainActivity  程序案例</h1> 
[1. listView的数据容器](#0401)

<h1 id="05">05. DialogActivity  Dialog示例</h1> 
[1. 多种弹出框的用法](#0501)

<h1 id="06">06. ImageDownActivity  下载图片与裁剪缩放</h1>
[1. 下载图片与裁剪缩放](#0601)

<h1 id="07">07. AnimationActivity  动画效果汇总</h1>
<h1 id="08">08. UIElementActivity  常用控件汇总</h1>

<h1 id="09">09. CityListActivity  城市选择</h1>
[1. 城市选择](#0901)

<h1 id="10">10. DemoAbActivity  AbActivity用法</h1>

<h1 id="11">11. DBInsideSampleActivity  数据库在 内置存储 中建表</h1> 
[1. 数据库的基本操作](#1101)

<h1 id="12">12. DBSDSampleActivity  数据库建立在SD卡中</h1>
[1. 数据库建立在SD卡中](#1201)

<h1 id="13">13. DBOne2OneActivity  一对一关联</h1> 
[1. 两个对象在两个表里的一对一关联](#1301)
<h1 id="14">14. DBOne2ManyActivity  一对多关联</h1> 
[1. 两个表里对象的一对多关联](#1401)

<h1 id="15">15. DBObjectActivity  对象化存储</h1> 
[1. 数据库演示andbase的对象化存储](#1501)

<h1 id="16">16. TitleBarActivity  多功能标题栏</h1>
[1. 各种标题栏的修改和底部导航栏的用法](#1601)


<h1 id="72">72. HttpActivity  Http框架</h1>
[1. Http框架](#7201)

<h1 id="73">73. HttpMiniActivity  快速响应的请求</h1> 
[1. 适合大量频繁快速响应的请求](#7301)

<h1 id="17">17. ThreadControlActivity  线程管理</h1>
[1. 异步线程的使用参照](#1701)

<h1 id="42">42. PullToRefreshViewActivity  下拉刷新上滑加载普通控件</h1>
[1. 下拉刷新上滑加载普通控件](#4201)

<h1 id="25">25. PullToRefreshListActivity  下拉刷新上滑加载分页</h1> 
[1. 下拉刷新上滑加载分页](#2501)

<h1 id="26">26. PullToRefreshGridActivity  GridView下拉刷新分页加载</h1>

<h1 id="43">43. PullToRefreshMultiColumnListActivity  多列View瀑布流</h1> 
[1. 运用集成的方法实现访问网络并把字符串解析成对象](#4301)

<h1 id="18">18. TabActivity  Tab切换</h1>
<h1 id="19">19. TabTopActivity  顶部切换Tab</h1>
[1. 顶部切换Tab](#1901)
[2. FragmentLoad 每一个的Activity碎片](#1902)

<h1 id="20">20. TabBottomActivity  底部切换Tab</h1>
[1. 底部切换Tab](#2001)

<h1 id="21">21. DownListActivity  下载器</h1> 
[1. 多线程断点续传 下载器](#2101)

<h1 id="22">22. DBActivity  数据库操作</h1>
<h1 id="23">23. PullToRefreshActivity  下拉刷新分页</h1> 
<h1 id="24">24. ChartActivity  图表</h1> 

<h1 id="27">27. SlidingButtonActivity  滑动按钮</h1>
[1. 滑动按钮](#2701)

<h1 id="28">28. SlidingPlayViewActivity  图片联播</h1>
[1. 图片联播](#2801)

<h1 id="29">29. SlidingLeftActivity  </h1>
<h1 id="30">30. WelcomeActivity  欢迎页面</h1>
[1. 欢迎页面](#3001)

<h1 id="31">31. XYLineChartActivity  XY线图</h1> 
<h1 id="32">32. XYBarChartActivity  XY柱图</h1>
[1. XY柱图](#3201)

<h1 id="33">33. PieChartActivity  饼图</h1> 
[1.  饼图](#3301)

<h1 id="34">34. TimeChartActivity  线图</h1> 
<h1 id="35">35. XYAreaChartActivity  区域图</h1> 
<h1 id="36">36. LevelChartActivity  等级条</h1>
<h1 id="37">37. WheelActivity  轮子选择</h1>
[1. 轮子选择](#3701)

<h1 id="38">38. CropImageActivity  裁剪界面</h1>
<h1 id="39">39. AddPhotoActivity  拍照相册选择</h1>
[1. 拍照相册选择](#3901)

<h1 id="40">40. CalendarActivity  日历选择器</h1>

<h1 id="41">41. PHashActivity  图片相近查询</h1> 

<h1 id="44">44. SlidingMenuActivity  侧边栏</h1> 
[1. 侧边栏](#4401)

<h1 id="45">45. SlidingMenuLeftActivity  左边的侧边栏</h1> 
[1. 左边的侧边栏](#4501)

<h1 id="46">46. SlidingMenuRightActivity  侧边栏</h1>
<h1 id="47">47. SlidingMenuLeftRightActivity  侧边栏</h1>
<h1 id="48">48. SlidingMenuZoomActivity  侧边栏</h1>
<h1 id="49">49. SlidingMenuSlideActivity  侧边栏</h1>
<h1 id="50">50. SlidingMenuScaleActivity  侧边栏</h1>

<h1 id="51">51. SlidingMenuTitleHoldActivity  侧边栏</h1> 
<h1 id="52">52. CarouselActivity  旋转木马</h1>
<h1 id="53">53. CarouselImageActivity  图片适配的旋转木马</h1> 
[1. 图片适配的旋转木马](#5301)

<h1 id="54">54. CarouselViewActivity  View适配的旋转木马</h1> 
<h1 id="55">55. ProgressBarActivity  2种漂亮的进度条</h1> 
<h1 id="56">56. ProgressBarCircleActivity  环形进度条</h1>
[1. 环形进度条](#5601)

<h1 id="57">57. ProgressBarHorizontalActivity  水平进度条</h1>
[1. 水平进度条](#5701)

<h1 id="59">59. Rotate3DActivity  3D翻转示例</h1>
<h1 id="60">60. Rotate3DActivity1  硬币翻转</h1>
[1. 硬币翻转](#6001)

<h1 id="71">71. Rotate3DActivity2  3d旋转View</h1> 

<h1 id="74">74. SoapActivity  soap框架</h1> 
<h1 id="75">75. NestScrollActivity  各种嵌套</h1> 
<h1 id="76">76. ListNestViewPagerActivity  ListView与ViewPager组合</h1>
[1.ListView与ViewPager组合](#7601)

<h1 id="77">77. SlidingMenuNestViewPagerActivity  SlidingMenu+ViewPager冲突解决的演示</h1>
[1.SlidingMenuNestViewPagerActivity  SlidingMenu+ViewPager冲突解决的演示](#7701)

<h1 id="78">78. SceneActivity  场景化UI</h1>
<h1 id="79">79. AnalogClockActivity  圆形挂钟</h1>
[1.圆形挂钟](#7901)
<h1 id="80">80. NumberClockActivity  数字时钟</h1>
[1.数字时钟](#8001)
<h1 id="91">91. DeskCalendarActivity  台历</h1> 
[1.台历](#9101)

<h1 id="92">92. PopoverActivity  提示框</h1>
[1.提示框](#9201)

 <h1 id="93">93. SlidingMenuNestTabActivity  SlidingMenu+SlidingTab冲突解决的演示</h1> 

<h1 id="94">94. WebActivity  网站Wap</h1> 
<h1 id="95">95. LoginActivity  </h1> 
<h1 id="96">96. RegisterActivity  </h1>
<h1 id="97">97. AgreementActivity  用户注册协议</h1>
<h1 id="98">98. FindPwdActivity  </h1>
<h1 id="99">99. AboutActivity  </h1>
<h1 id="100">100. ContacterActivity  我的联系人</h1>
[1.我的联系人](#10001)
[1.ContacterFragment 联系人列表界面](#10002)

<h1 id="101">101. MessageActivity  系统通知</h1> 
[1.系统通知 分配从数据库加载数据](#10101)

<h1 id="102">102. IMContactService  联系人服务</h1>
[1.联系人服务](#10201)

<h1 id="103">103. IMChatService  聊天服务</h1> 
[1.聊天服务](#10301)

<h1 id="104">104. IMSystemMsgService  系统消息服务</h1> 
[1.系统消息服务](#10401)

<h1 id="105">105. ReConnectService  重连接服务</h1> 
[1.重连接服务  服务中注册了监听器](#10501)

<h1 id="108">108. ChatActivity  与朋友的会话</h1> 
[1.与朋友的会话](#10801)

<h1 id="109">109. IMMessageReceiver  接收消息的广播接受器</h1> 
[1.接收消息的广播接受器](#10901)

参考文档
[Android 快速开发框架](http://lib.csdn.net/article/android/4461 "查看")

1. 简介  

<h1 id="0101">1. 权限</h1>

> ## [返回目录](#1)

```
<!-- 权限 -->
	//联网
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.READ_PHONE_STATE" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /> 
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" /> 
    <uses-permission android:name="android.permission.CHANGE_WIFI_STATE" />
　　  <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    
    <!-- -->
    <uses-permission android:name="com.android.launcher.permission.INSTALL_SHORTCUT" />
    <uses-permission android:name="com.android.browser.permission.READ_HISTORY_BOOKMARKS" />
    <uses-permission android:name="com.android.browser.permission.WRITE_HISTORY_BOOKMARKS" />
```
> ## <h1 id="0102">1. No resource found that matches the given name</h1>

> ## [返回目录](#01)

app_panel_bg_f.9.png  这个命名方式 在studio中找不到 会报错  重命名时去掉 .9


> ## <h1 id="0103">1. themes</h1>

> ## [返回目录](#1)

# 定义了各种全局的控件的变量

 android:theme="@style/myTheme"  清单文件中配置

```
<?xml version="1.0" encoding="utf-8"?>
<resources xmlns:android="http://schemas.android.com/apk/res/android">
	<style name="myTheme" parent="android:Theme">
        <!-- <item name="android:windowBackground">@drawable/start</item> -->
	    <item name="android:windowFullscreen">false</item>  //是否全屏
        <item name="android:windowContentOverlay">@null</item>  <!--定义ActionBar窗体的背景-->
	    <item name="android:windowNoTitle">false</item>  //没有标题
	    <item name="android:windowTitleSize">55dip</item>
	    <item name="android:windowTitleBackgroundStyle">@style/mCustomWindowTitleBackground</item>
		<!--这个的各种常用控件的样式-->
	    <item name="android:expandableListViewStyle">@style/mExpandableListView</item>
	    <item name="android:listViewStyle">@style/mListView</item>
	    <item name="android:buttonStyle">@style/mButtonWhite</item>
	    <item name="android:editTextStyle">@style/mEditText</item>
	    <item name="android:checkboxStyle">@style/mCheckBox</item>
	    
	    <item name="android:progressBarStyleHorizontal">@style/mProgressBarHorizontal</item>
	    
	    <item name="android:scrollbarSize">15dip</item>
        <item name="android:scrollbarThumbVertical">@drawable/scrollbar_handle_vertical</item>
        <item name="android:scrollbarTrackVertical">@drawable/scrollbar_vertical</item>
	</style>

</resources>
```

> ## <h1 id="0104">2. styles</h1>

> ## [返回目录](#1)

# 定义了各种控件的样式
```
这个是控件单击加样式的代码
style="@style/mEditText"


<resources>

    <!-- Base application theme. -->
    <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
        <!-- Customize your theme here. -->
    </style>

    <style name="Widget" parent="android:Widget"></style>

    <style name="mCustomWindowTitleBackground" parent="@style/Widget">
        <item name="android:background">@color/transparent</item>
    </style>

    <style name="mExpandableListView" parent="@style/Widget">
        <item name="android:groupIndicator">@drawable/expander_group</item>
        <item name="android:indicatorLeft">10dip</item>
        <item name="android:indicatorRight">?android:attr/expandableListPreferredItemIndicatorRight</item>
        <item name="android:childDivider">@drawable/list_divider</item>
    </style>

     <style name="mProgressBarHorizontal" parent="@style/Widget">
         <item name="android:indeterminateOnly">false</item>
         <item name="android:progressDrawable">@drawable/progress_horizontal</item>
         <item name="android:indeterminateDrawable">@drawable/progress_indeterminate_horizontal</item>
         <item name="android:minHeight">5dip</item>
         <item name="android:maxHeight">5dip</item>
     </style>

     <style name="mProgressBarCircular" parent="@style/Widget">
         <item name="android:indeterminateOnly">true</item>
         <item name="android:indeterminateDrawable">@drawable/progress_circular</item>
         <item name="android:minHeight">5dip</item>
         <item name="android:maxHeight">5dip</item>
     </style>

      <style name="mButtonWhite" parent="@style/Widget">
          <item name="android:background">@drawable/button_selector_white</item>
          <item name="android:focusable">true</item>
          <item name="android:clickable">true</item>
          <item name="android:textAppearance">?android:attr/textAppearanceSmallInverse</item>
          <item name="android:gravity">center_vertical|center_horizontal</item>
          <item name="android:textColor">@android:color/primary_text_light</item>
      </style>

      <style name="mListView" parent="@style/Widget">
          <item name="android:listSelector">@drawable/list_selector_background</item>
          <item name="android:cacheColorHint">?android:attr/colorBackgroundCacheHint</item>
          <item name="android:divider">@drawable/list_divider</item>
      </style>

      <style name="mEditText" parent="@style/Widget">
          <item name="android:focusable">true</item>
          <item name="android:focusableInTouchMode">true</item>
          <item name="android:clickable">true</item>
          <item name="android:background">@drawable/input_bg</item>
          <item name="android:textAppearance">?android:attr/textAppearanceMediumInverse</item>
          <item name="android:textColor">@color/gray</item>
          <item name="android:gravity">center_vertical</item>
      </style>

      <style name="mCheckBox" parent="@android:style/Widget.CompoundButton.CheckBox">
          <item name="android:textSize">18sp</item>
          <item name="android:textColor">@color/gray</item>
          <item name="android:paddingLeft">10dip</item>
          <item name="android:button">@drawable/check_box</item>
      </style>
</resources>

```

> ## <h1 id="0105">3. colors</h1>

> ## [返回目录](#1)

```
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="red">#FF0000</color>
    <color name="green">#00FF00</color>
    <color name="green_dark">#9CDC6A</color>
    <color name="blue">#33B5E5</color>
    <color name="white">#FFFFFFFF</color>
    <color name="black">#000000</color>
    <color name="gray">#7c7c7c</color>
    <color name="gray_white">#ebebeb</color>
    <color name="gray_light">#887c7c7c</color>
    <color name="gray_dark">#2e2e2e</color>
    <color name="yellow">#FFFC00</color>
    <color name="pink">#FF87EF</color>
    <color name="orange">#ff6200</color>
    <color name="list_divider">#D3D3D3</color>
    <color name="transparent">#00000000</color>
    <color name="transparent_bg">#88838B8B</color>
</resources>
```
> ## <h1 id="0106">4.  Drawable资源</h1>

> ## [返回目录](#1)

[常规转圈进度条](#0106_01)

```

选择器  expander_group
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:drawable="@drawable/indicator_expanded" android:state_expanded="true"/>
    <item android:drawable="@drawable/indicator_unexpanded"/>
</selector>

背景色渐变
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android" >
    <gradient
        android:endColor="#33000000"
        android:centerColor="#11000000"
        android:startColor="#00000000" />
</shape>


check_box
<?xml version="1.0" encoding="UTF-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:drawable="@drawable/btn_check_box_on" android:state_checked="true" android:state_enabled="true" android:state_window_focused="false"/>
    <item android:drawable="@drawable/btn_check_box_off" android:state_checked="false" android:state_enabled="true" android:state_window_focused="false"/>
    <item android:drawable="@drawable/btn_check_box_on" android:state_checked="true" android:state_enabled="true" android:state_pressed="true"/>
    <item android:drawable="@drawable/btn_check_box_off" android:state_checked="false" android:state_enabled="true" android:state_pressed="true"/>
    <item android:drawable="@drawable/btn_check_box_on" android:state_checked="true" android:state_enabled="true" android:state_focused="true"/>
    <item android:drawable="@drawable/btn_check_box_off" android:state_checked="false" android:state_enabled="true" android:state_focused="true"/>
    <item android:drawable="@drawable/btn_check_box_off" android:state_checked="false" android:state_enabled="true"/>
    <item android:drawable="@drawable/btn_check_box_on" android:state_checked="true" android:state_enabled="true"/>
</selector>

```

> ## <h1 id="0106_01">4.  Drawable资源</h1>

> ## [返回目录](#0106)

![](http://i.imgur.com/uxt8NdP.png)
```
    <style name="mProgressBarCircular" parent="@style/Widget">
        <item name="android:indeterminateOnly">true</item>
        <item name="android:indeterminateDrawable">@drawable/progress_circular</item>
        <item name="android:minHeight">5dip</item>
        <item name="android:maxHeight">5dip</item>
    </style>

差值
<?xml version="1.0" encoding="utf-8"?>
<animated-rotate xmlns:android="http://schemas.android.com/apk/res/android"
    android:duration="200"  时间200秒
    android:fromDegrees="0.0"  度数
    android:interpolator="@android:anim/accelerate_decelerate_interpolator"
    android:pivotX="50.0%"   旋转圆心
    android:pivotY="50.0%"
    android:repeatMode="restart"  不断重复
    android:toDegrees="360.0" 
    android:drawable="@drawable/progress_loading2">
</animated-rotate>
```

> ## <h1 id="0107">Android Studio中使用.9.png</h1>

> ## [返回目录](#01)

#  用鼠标左键画黑线  画黑线的表明可以拉伸，否则不拉伸
# 点9图片每个边都必须有黑线标记；
# 在Eclipse中不检查.9.png的边，但是AS会检查，在每个边上要求有且仅有一段黑色标记

[android studio 中 .9.png的制作](http://blog.csdn.net/sky_castle/article/details/49426015)
[Android Studio中关于.9.png图片的使用](http://blog.csdn.net/dengpeng0419/article/details/52902869)
   
<h1 id="0108">清单文件</h1>

[返回目录](#01)

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    package="com.andbase"
    android:versionCode="18"
    android:versionName="1.6">

    <uses-sdk
        android:minSdkVersion="14"
        android:targetSdkVersion="17"/>

    <!-- 权限 -->
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.READ_PHONE_STATE" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /> 
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" /> 
    <uses-permission android:name="android.permission.CHANGE_WIFI_STATE" />
　　  <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    
    <!-- -->
    <uses-permission android:name="com.android.launcher.permission.INSTALL_SHORTCUT" />
    <uses-permission android:name="com.android.browser.permission.READ_HISTORY_BOOKMARKS" />
    <uses-permission android:name="com.android.browser.permission.WRITE_HISTORY_BOOKMARKS" />
    
    
    <application
        android:name=".global.MyApplication"
        android:icon="@drawable/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/myTheme" >
         //android:name=".main.LauncherActivity"
    <!-- android:configChanges="keyboardHidden|orientation" 
     切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法 
     
     对android:configChanges属性，一般认为有以下几点：
1、不设置Activity的android:configChanges时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次

2、设置Activity的android:configChanges="orientation"时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次

3、设置Activity的android:configChanges="orientation|keyboardHidden"时，
切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法

     但是，自从Android 3.2（API 13），
     在设置Activity的android:configChanges="orientation|keyboardHidden"后，
     还是一样会重新调用各个生命周期的。因为screen size也开始跟着设备的横竖切换而改变。
     所以，在AndroidManifest.xml里设置的MiniSdkVersion和 TargetSdkVersion属性大于等于13的情况下，
     如果你想阻止程序在运行时重新加载Activity，除了设置"orientation"，你还必须设置"ScreenSize"。
解决方法：
AndroidManifest.xml中设置android:configChanges="orientation|screenSize“-->
        <activity
           android:name=".main.LauncherActivity"           
            android:launchMode="singleTop"
            android:label="引导页"
            android:configChanges="keyboardHidden|orientation" >
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
        
        <activity
            android:name=".main.MainActivity"
               android:label="主页页"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.DemoMainActivity"
            android:label="程序案例"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.DialogActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.ImageDownActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.AnimationActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.UIElementActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CityListActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DemoAbActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBInsideSampleActivity"
              android:label="数据库内置存储"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBSDSampleActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBOne2OneActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBOne2ManyActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBObjectActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.TitleBarActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ThreadControlActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.TabActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.TabTopActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.TabBottomActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DownListActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DBActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.PullToRefreshActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.PullToRefreshListActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.PullToRefreshGridActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingButtonActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingPlayViewActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.SlidingLeftActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        
        <activity
            android:name=".demo.activity.WelcomeActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.XYLineChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.XYBarChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.PieChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.TimeChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.XYAreaChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.LevelChartActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.WheelActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CropImageActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.AddPhotoActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CalendarActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        
        <activity
            android:name=".demo.activity.PHashActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.PullToRefreshViewActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.PullToRefreshMultiColumnListActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuLeftActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuRightActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuLeftRightActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuZoomActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuSlideActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuScaleActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuTitleHoldActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CarouselActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CarouselImageActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.CarouselViewActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ProgressBarActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ProgressBarCircleActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ProgressBarHorizontalActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.IocViewActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.Rotate3DActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".demo.activity.Rotate3DActivity1"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
          <activity
            android:name=".demo.activity.Rotate3DActivity2"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.HttpActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.HttpMiniActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
       <activity
            android:name=".demo.activity.SoapActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.NestScrollActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.ListNestViewPagerActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuNestViewPagerActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SceneActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.AnalogClockActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.NumberClockActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.DeskCalendarActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.PopoverActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".demo.activity.SlidingMenuNestTabActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".blog.WebActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".login.LoginActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".login.RegisterActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".login.AgreementActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".login.FindPwdActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".login.AboutActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <activity
            android:name=".im.activity.ContacterActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
         <activity
            android:name=".im.activity.ChatActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity> 
        
        <activity
            android:name=".im.activity.MessageActivity"
            android:configChanges="keyboardHidden|orientation" >
        </activity>
        
        <!-- <activity android:name="com.kfb.c.Kf"
			android:launchMode="singleInstance"
			android:screenOrientation="portrait" />
        
        <activity
            android:name="com.kfb.a.Qim"
            android:configChanges="keyboard|keyboardHidden|orientation"
            android:launchMode="singleInstance"
            android:theme="@android:style/Theme.Translucent.NoTitleBar" /> -->
        
        
        <!-- push service client -->
	    <receiver android:name=".im.receiver.IMMessageReceiver">
	        <intent-filter>
	            <!-- 接收消息 -->
	            <action android:name="com.andbase.action.NEW_MESSAGE" />
	            <action android:name="com.andbase.action.CHAT_MESSAGE" />
	            <action android:name="com.andbase.action.SYS_MESSAGE" />
	            <!-- 收到好友邀请 -->
	            <action android:name="com.andbase.action.ROSTER_SUBSCRIBE" />
	        </intent-filter>
	    </receiver>
        
        <!-- 联系人服务 -->
		<service android:name=".im.service.IMContactService"></service>
		<!-- 聊天服务 -->
		<service android:name=".im.service.IMChatService"></service>  
		<!-- 系统消息服务 -->
		<service android:name=".im.service.IMSystemMsgService"></service>
		<!-- 重连接服务 -->
 		<service android:name=".im.service.ReConnectService"></service>
        
        
    </application>

</manifest>
```

> ## <h1 id="0401">1.  listView的数据容器</h1>

> ## [返回目录](#04)

```
// 列表内是键值对
private List<Map<String, Object>> list = null;


向数据链表中添加对象
// ListView数据
		list = new ArrayList<Map<String, Object>>();
		Map<String, Object> map = new HashMap<String, Object>();

		map = new HashMap<String, Object>();
		map.put("itemsIcon", mPhotoList.get(0));
		map.put("itemsTitle", "AbActivity基本用法");
		map.put("itemsText", "AbActivity使用示例");
		list.add(map);

		map = new HashMap<String, Object>();
		map.put("itemsIcon", mPhotoList.get(1));
		map.put("itemsTitle", "数据库ORM");
		map.put("itemsText", "注解，数据库对象映射");
		list.add(map);

		map = new HashMap<String, Object>();
		map.put("itemsIcon", mPhotoList.get(2));
		map.put("itemsTitle", "IOC 适配View");
		map.put("itemsText", "像findViewById说no");
		list.add(map);

		map = new HashMap<String, Object>();
		map.put("itemsIcon", mPhotoList.get(3));
		map.put("itemsTitle", "Http工具类");
		map.put("itemsText", "网络通信首选1");
		list.add(map);




//这个是方法的使用
// 使用自定义的Adapter
		myListViewAdapter = new MyListViewAdapter(DemoMainActivity.this, list,
				R.layout.item_list, new String[] { "itemsIcon", "itemsTitle",
						"itemsText" }, new int[] { R.id.itemsIcon,
						R.id.itemsTitle, R.id.itemsText });
		mListView.setAdapter(myListViewAdapter);
		// item被点击事件
		mListView.setOnItemClickListener(new OnItemClickListener() {
			@Override
			public void onItemClick(AdapterView<?> parent, View view,
					int position, long id) {
				Intent intent = null;
				switch (position) {
				case 0:
					intent = new Intent(DemoMainActivity.this, DemoAbActivity.class);
					startActivity(intent);
					break;



xml布局
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:padding="5dip" >

    <RelativeLayout
        android:id="@+id/itemsImage"
        android:layout_width="60dip"
        android:layout_height="60dip"
        android:background="@drawable/image_border" >

        <ProgressBar
            android:id="@+id/progressBar"
            style="?android:attr/progressBarStyleSmall"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_centerInParent="true" />

        <ImageView
            android:id="@+id/itemsIcon"
            android:layout_width="fill_parent"
            android:layout_height="fill_parent"
            android:layout_centerInParent="true"
            android:padding="2dip"
            android:scaleType="fitXY" />
    </RelativeLayout>

    <TextView
        android:id="@+id/itemsTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_vertical"
        android:layout_toRightOf="@+id/itemsImage"
        android:paddingLeft="10dip"
        android:paddingRight="10dip"
        android:paddingTop="5dip"
        android:textColor="@color/gray_dark"
        android:textSize="18sp" />

    <TextView
        android:id="@+id/itemsText"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:layout_below="@+id/itemsTitle"
        android:layout_toRightOf="@+id/itemsImage"
        android:gravity="left"
        android:paddingBottom="2dip"
        android:paddingLeft="10dip"
        android:paddingRight="10dip"
        android:textColor="@color/gray"
        android:textSize="15sp" />

</RelativeLayout>
```

> ## <h1 id="1601">1.  listView的数据容器</h1>

> ## [返回目录](#16)

```
各种标题栏的修改和弹出框的用法
```
> ## <h1 id="1101">1.   数据库的基本操作</h1>

> ## [返回目录](#11)

```
分页查询数据的应用

 //初始化数据库操作实现类
	    userDao = new UserInsideDao(DBInsideSampleActivity.this);
	    
	    //(1)获取数据库 
	  	userDao.startReadableDatabase();

//(2)执行查询    userDao表明查询的表  按create_time进行desc升序排列  pageSize显示的条数   查询从0到10的数据  得到的是符合条件的列表
	    userList = userDao.queryList(null, null, null, null, null, "create_time desc limit "+String.valueOf(pageSize)+ " offset " +0, null);
	   //这个是总的条数
	    totalCount = userDao.queryCount(null, null);
	    //(3)关闭数据库
	  	userDao.closeDatabase();

// 修改和删除按钮
		// 释放焦点
		holder.modifyBtn.setFocusable(false);
		holder.delBtn.setFocusable(false);

Java 中的instanceof 运算符是用来在运行时指出对象是否是特定类的一个实例。instanceof通过返回一个布尔值来指出，这个对象是否是这个特定类或者是它的子类的一个实例。
 if(mContext instanceof DBInsideSampleActivity){
					 ((DBInsideSampleActivity)mContext).updateData(user);
				 }


/**
	 * 更新数据
	 * 描述：TODO
	 * @param u
	 */
	public void updateData(LocalUser u){
		//(1)获取数据库
		userDao.startWritableDatabase(false);
		userDao.update(u);
		userDao.closeDatabase();
	}


/**
	 * 
	 * 描述：删除数据
	 * @param id
	 */
	public void delData(int id){
		
		//(1)获取数据库
		userDao.startWritableDatabase(false);
		//(2)执行查询
		userDao.delete(id);
		//(3)关闭数据库
		userDao.closeDatabase();
		
		queryData();
	}


/**
	 * 
	 * 描述：查询数据
	 * @throws 
	 */
	public void queryData(){
		//(1)获取数据库
		userDao.startReadableDatabase();
		//(2)执行查询
		List<LocalUser> userListNew = userDao.queryList(null, null, null, null, null, "create_time desc limit "+String.valueOf(pageSize)+ " offset " +String.valueOf((pageNum-1)*pageSize), null);
		//(3)关闭数据库
		userDao.closeDatabase();
		
		userList.clear();
		if(userListNew!=null){
			 userList.addAll(userListNew);
		}
       
		myListViewAdapter.notifyDataSetChanged();
		checkPageBar();
	}


//检查分页的条数
	private void checkPageBar(){
    	if(userList == null || userList.size()==0){
			//无数据隐藏分页栏
			mListViewForPage.setVisibility(View.GONE);
		}else{
			queryDataCount();
		}
    }


/**
	 * 
	 * 描述：查询数量
	 * @throws 
	 */
	public void queryDataCount(){
		//(1)获取数据库
		userDao.startReadableDatabase();
		//(2)执行查询
		totalCount = userDao.queryCount(null, null);
		//(3)关闭数据库
		userDao.closeDatabase();
		
		total.setText("总条数:" +String.valueOf(totalCount));
		current.setText("当前页:" + String.valueOf(pageNum));
		checkView();
		mListViewForPage.setVisibility(View.VISIBLE);
		
	}

/**
	 * 
	 * 描述：保存数据
	 * @param u
	 * @throws 
	 */
	public void saveData(LocalUser u){
		//(1)获取数据库
		userDao.startWritableDatabase(false);
		//(2)执行查询
		long id = userDao.insert(u);
		//(3)关闭数据库
		userDao.closeDatabase();
		
		//showToast("插入数据成功,ID:"+id);
		//插入数据成功
		if(id!=-1){
			//查询数据
			queryData();
		}
	}


UserInsideDao  是把数据表建立在项目的内部

```

> ## <h1 id="1201">1.  数据库建立在SD卡中</h1>

> ## [返回目录](#12)

```
一个把数据库建立在程序内部，一个把程序建立在SD卡上，主要区别是它们的构造器不同DBInsideHelper与DBSDHelper区别
/**
 * 
 * © 2012 amsoft.cn
 * 名称：UserInsideDao.java 
 * 描述：本地数据库 在data下面
 * @author 还如一梦中
 * @date：2013-7-31 下午4:12:36
 * @version v1.0
 */
public class UserInsideDao extends AbDBDaoImpl<LocalUser> {
	public UserInsideDao(Context context) {
		super(new DBInsideHelper(context),LocalUser.class);
	}
}


/**
 * 
 * © 2012 amsoft.cn
 * 名称：UserDao.java 
 * 描述：本地数据库在sd中
 * @author 还如一梦中
 * @date：2013-7-31 下午4:13:02
 * @version v1.0
 */
public class UserSDDao extends AbDBDaoImpl<LocalUser> {
	public UserSDDao(Context context) {
		super(new DBSDHelper(context),LocalUser.class);
	}
}
```

> ## <h1 id="1301">1.  listView的数据容器</h1>

> ## [返回目录](#13)

```
// 包含实体的存储，指定外键 类型1对1 外键
	@Relations(name="stock",type="one2one",foreignKey = "u_id",action="query_insert")
	private Stock stock;


 //测试数据
		final LocalUser mLocalUser  = new LocalUser();
		mLocalUser.setuId("99");
		mLocalUser.setName("测试内容");
		
		Stock mStock = new Stock();
		mStock.setuId("99");
		mStock.setText1("关联内容");
		
		mLocalUser.setStock(mStock);

// 查询结果
 public void queryData(){
    	    //查询出结果检查是否成功了
			userDao.startReadableDatabase();
			List<LocalUser>  mLocalUserList = userDao.queryList();
			userDao.closeDatabase();
			resultData.setText("查询结果为：");
			if(mLocalUserList==null || mLocalUserList.size()==0){
				resultData.append("查询结果为：0");
			}else{
				for(LocalUser localUser:mLocalUserList){
					Stock stock = localUser.getStock();
					resultData.append("\nlocal_user{\n_id:"+localUser.get_id()+",uId:"+localUser.getuId()+",name:"+localUser.getName());
					if(stock!=null){
						resultData.append("\n,stock{_id:"+stock.get_id()+",uId:"+stock.getuId()+",text1:"+stock.getText1()+"}");
					}
					
					
					resultData.append("\n}");
					
					resultData.append("\n-----------------------");
				}
			}
     }
```

> ## <h1 id="1401">1. 两个表里对象的一对多关联</h1>

> ## [返回目录](#14)

```
// 包含List的存储，指定外键
	@Relations(name="stocks",type="one2many",foreignKey = "u_id",action="query_insert")
	private List<Stock> stocks;



//测试数据
		final LocalUser mLocalUser  = new LocalUser();
		mLocalUser.setuId("100");
		mLocalUser.setName("测试内容");
		
		final Stock mStock1 = new Stock();
		mStock1.setuId("100");
		mStock1.setText1("关联内容1");
		
		final Stock mStock2 = new Stock();
		mStock2.setuId("100");
		mStock2.setText1("关联内容2");
		
		List<Stock> stocks = new ArrayList<Stock>();
		
		stocks.add(mStock1);
		stocks.add(mStock2);
		
		mLocalUser.setStocks(stocks);

```
> ## <h1 id="1501">1. 数据库演示andbase的对象化存储</h1>

> ## [返回目录](#15)

```
//创建一个HeaderView用于向数据库中增加一条数据
        View headerView = mInflater.inflate(R.layout.db_list_header,null);
        //加到ListView的顶部
        mListView.addHeaderView(headerView);

/**
	 * 
	 * 描述：根据ID查询数据
	 * @param id
	 * @return
	 */
	public void queryDataById(int id){
		
		//条件
		AbStorageQuery mAbStorageQuery = new AbStorageQuery();
		mAbStorageQuery.equals("_id", String.valueOf(id));
		
		//无sql存储的查询
		mAbSqliteStorage.findData(mAbStorageQuery, userDao, new AbDataSelectListener(){

			@Override
			public void onFailure(int errorCode, String errorMessage) {
				AbToastUtil.showToast(DBObjectActivity.this,errorMessage);
			}

			@Override
			public void onSuccess(List<?> paramList) {
				if(paramList!=null && paramList.size()>0){
					LocalUser u = (LocalUser)paramList.get(0);
					AbToastUtil.showToast(DBObjectActivity.this,"结果：_id:"+u.get_id()+",name:"+u.getName());
				}
			}
			
		});
		
	}
	
	/**
	 * 
	 * 描述：删除数据
	 * @param id
	 */
	public void delData(int id){
		
		//条件
		AbStorageQuery mAbStorageQuery = new AbStorageQuery();
		mAbStorageQuery.equals("_id", String.valueOf(id));
		
		//无sql存储的删除
		mAbSqliteStorage.deleteData(mAbStorageQuery, userDao, new AbDataDeleteListener(){

			@Override
			public void onSuccess(int rows) {
				queryData();
			}

			@Override
			public void onFailure(int errorCode, String errorMessage) {
				AbToastUtil.showToast(DBObjectActivity.this,errorMessage);
			}
			
		});
		
	}



/**
	 * 更新数据
	 * 描述：TODO
	 * @param u
	 */
	public void updateData(LocalUser u){
		
		//无sql存储的更新
		mAbSqliteStorage.updateData(u, userDao, new AbDataUpdateListener(){

			@Override
			public void onFailure(int errorCode, String errorMessage) {
				AbToastUtil.showToast(DBObjectActivity.this,errorMessage);
			}

			@Override
			public void onSuccess(int rows) {
				queryData();
			}
			
		});
		
	
	}

```
> ## <h1 id="5801">1. IOC适配View  注解绑定</h1>

> ## [返回目录](#58)

```
@AbIocView(id = R.id.mBtn,click="btnClick")
	Button button;
	
	@AbIocView(id = R.id.mText)
	TextView mTextView;


  public void btnClick(View v){
		mTextView.setText("我变了");
	}
```
> ## <h1 id="7201">1. Http框架</h1>

> ## [返回目录](#72)

```
  //获取Http工具类
        mAbHttpUtil = AbHttpUtil.getInstance(this);
        mAbHttpUtil.setTimeout(10000);
        //get请求
        getBtn.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				
				// 一个url地址
				//String urlString = "http://www.amsoft.cn/rss.php"; 
				String urlString = "http://211.149.169.221:8080/umijoyappsvr/common/findDistrict.do"; 
				mAbHttpUtil.get(urlString, new AbStringHttpResponseListener() {
					
					//获取数据成功会调用这里
		        	@Override
					public void onSuccess(int statusCode, String content) {
		        		Log.d(TAG, "onSuccess");
		        		
		        		AbDialogUtil.showAlertDialog(HttpActivity.this,"返回结果",content.trim(),new AbDialogOnClickListener(){

							@Override
							public void onNegativeClick() {
								// TODO Auto-generated method stub
								
							}

							@Override
							public void onPositiveClick() {
								// TODO Auto-generated method stub
								
							}
							
		            		
		            	});
		        	
		        	}
		        	
		        	
		        	// 失败，调用
		            @Override
					public void onFailure(int statusCode, String content,
							Throwable error) {
		            	
		            	Log.d(TAG, "onFailure");
		            	AbToastUtil.showToast(HttpActivity.this,error.getMessage());
					}

		            // 开始执行前
		            @Override
					public void onStart() {
		            	Log.d(TAG, "onStart");
		            	//显示进度框
		            	AbDialogUtil.showProgressDialog(HttpActivity.this,0,"正在查询...");
					}


					// 完成后调用，失败，成功
		            @Override
		            public void onFinish() { 
		            	Log.d(TAG, "onFinish");
		            	//移除进度框
		            	AbDialogUtil.removeDialog(HttpActivity.this);
		            };
		            
		        });
				
			}
		});



 //post请求
        postBtn.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				
				String url = "http://210.56.209.87:90/Interface/AppNews.ashx";
				// 绑定参数
		        AbRequestParams params = new AbRequestParams(); 
		        params.put("U_Id", "42");
		       /* params.put("param2", "2");
		        params.put("param3", "10");*/
		        mAbHttpUtil.post(url,params, new AbStringHttpResponseListener() {
		        	
		        	// 获取数据成功会调用这里
		        	@Override
		        	public void onSuccess(int statusCode, String content) {
		        		Log.d(TAG, "onSuccess");
		        		AbDialogUtil.showAlertDialog(HttpActivity.this,"返回结果",content,new AbDialogOnClickListener(){

							@Override
							public void onPositiveClick() {
								// TODO Auto-generated method stub
								
							}

							@Override
							public void onNegativeClick() {
								// TODO Auto-generated method stub
								
							}
		            		
		            	});
		            };
		            
		            // 开始执行前
		            @Override
					public void onStart() {
		            	Log.d(TAG, "onStart");
		            	//显示进度框
		            	AbDialogUtil.showProgressDialog(HttpActivity.this,0,"正在查询...");
					}
		            
		            // 失败，调用
		            @Override
					public void onFailure(int statusCode, String content,
							Throwable error) {
		            	AbToastUtil.showToast(HttpActivity.this,error.getMessage());
					}

					// 完成后调用，失败，成功
		            @Override
		            public void onFinish() { 
		            	Log.d(TAG, "onFinish");
		            	//移除进度框
		            	AbDialogUtil.removeDialog(HttpActivity.this);
		            };
		            
		        });
			}
		});


//字节数组下载  可能返回的是一个图片
        byteBtn.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				
				String url = "https://timg01.bdimg.com/timg?pacompress&imgtype=1&sec=1439619614&autorotate=1&di=e2148c26123235aa7c5e07cd5d369e65&quality=90&size=b870_10000&src=http%3A%2F%2Fbos.nj.bpc.baidu.com%2Fv1%2Fmediaspot%2F76ec2b982287bcb6244a8d4d551b38c9.jpeg";
				mAbHttpUtil.get(url, new AbBinaryHttpResponseListener() {
		        	
					// 获取数据成功会调用这里
		        	@Override
					public void onSuccess(int statusCode, byte[] content) {
		        		Log.d(TAG, "onSuccess");
		        		Bitmap bitmap = AbImageUtil.bytes2Bimap(content);
		            	ImageView view = new ImageView(HttpActivity.this);
		            	view.setImageBitmap(bitmap);
		            	
		            	AbDialogUtil.showAlertDialog("返回结果",view,new AbDialogOnClickListener(){

							@Override
							public void onPositiveClick() {
								// TODO Auto-generated method stub
								
							}

							@Override
							public void onNegativeClick() {
								// TODO Auto-generated method stub
								
							}
		            		
		            	});
					}
		        	
		        	// 开始执行前
		            @Override
					public void onStart() {
		            	Log.d(TAG, "onStart");
		            	//显示进度框
		            	AbDialogUtil.showProgressDialog(HttpActivity.this,0,"正在查询...");
					}

		            // 失败，调用
		            @Override
					public void onFailure(int statusCode, String content,
							Throwable error) {
		            	AbToastUtil.showToast(HttpActivity.this,error.getMessage());
					}

					// 完成后调用，失败，成功
		            @Override
		            public void onFinish() { 
		            	Log.d(TAG, "onFinish");
		            	//移除进度框
		            	AbDialogUtil.removeDialog(HttpActivity.this);
		            };
		            
		        });
			}
		});


 //文件下载
        fileDownBtn.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				
				String url = "https://timg01.bdimg.com/timg?pacompress&imgtype=1&sec=1439619614&autorotate=1&di=e2148c26123235aa7c5e07cd5d369e65&quality=90&size=b870_10000&src=http%3A%2F%2Fbos.nj.bpc.baidu.com%2Fv1%2Fmediaspot%2F76ec2b982287bcb6244a8d4d551b38c9.jpeg";
				
				mAbHttpUtil.get(url, new AbFileHttpResponseListener(url) {
		        	
					
					// 获取数据成功会调用这里
		        	@Override
					public void onSuccess(int statusCode, File file) {
		        		Log.d(TAG, "onSuccess");
		        		Bitmap bitmap = AbFileUtil.getBitmapFromSD(file);
		            	ImageView view = new ImageView(HttpActivity.this);
		            	view.setImageBitmap(bitmap);
		            	
		            	AbDialogUtil.showAlertDialog("返回结果",view,new AbDialogOnClickListener(){

							@Override
							public void onPositiveClick() {
								// TODO Auto-generated method stub
								
							}

							@Override
							public void onNegativeClick() {
								// TODO Auto-generated method stub
								
							}
							
		            		
		            	});
					}
		        	
		        	// 开始执行前
		            @Override
					public void onStart() {
		            	Log.d(TAG, "onStart");
		            	//打开进度框
		            	View v = LayoutInflater.from(HttpActivity.this).inflate(R.layout.progress_bar_horizontal, null, false);
		            	mAbProgressBar = (AbHorizontalProgressBar) v.findViewById(R.id.horizontalProgressBar);
		            	numberText = (TextView) v.findViewById(R.id.numberText);
		        		maxText = (TextView) v.findViewById(R.id.maxText);
		        		
		        		maxText.setText(progress+"/"+String.valueOf(max));
		        		mAbProgressBar.setMax(max);
		        		mAbProgressBar.setProgress(progress);
		            	
		        		mAlertDialog = AbDialogUtil.showAlertDialog("正在下载",v);
					}

		        	// 失败，调用
		            @Override
					public void onFailure(int statusCode, String content,
							Throwable error) {
						Log.d(TAG, "onFailure");
						AbToastUtil.showToast(HttpActivity.this,error.getMessage());
					}
					
					// 下载进度
					@Override
					public void onProgress(int bytesWritten, int totalSize) {
						maxText.setText(bytesWritten/(totalSize/max)+"/"+max);
						mAbProgressBar.setProgress(bytesWritten/(totalSize/max));
					}

					// 完成后调用，失败，成功
		            public void onFinish() { 
		            	//下载完成取消进度框
		            	if(mAlertDialog!=null){
		            		mAlertDialog.dismiss();
			            	mAlertDialog  = null;
		            	}
		            	
		            	Log.d(TAG, "onFinish");
		            };
		            
		        });
			}
		});



 //文件上传
        fileUploadBtn.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				//已经在后台上传
				if(mAlertDialog!=null){
					mAlertDialog.show(getFragmentManager(), "dialog");
					return;
				}
				String url = "http://210.56.209.87:90/Interface/doReceiveMessage.ashx";
				
				AbRequestParams params = new AbRequestParams(); 
				
				try {
					//多文件上传添加多个即可
					File pathRoot = Environment.getExternalStorageDirectory();
					String path = pathRoot.getAbsolutePath();
					params.put("data1",URLEncoder.encode("中文的处理",HTTP.UTF_8));
					params.put("data2","100");
					//参数随便加，在sd卡根目录放图片
					File file1 = new File(path+"/1.jpg");
					File file2 = new File(path+"/1.txt");
					params.put(file1.getName(),file1);
					params.put(file2.getName(),file2);
					
					//只支持最多2个文件域，因为会产生流中断的异常，所以你需要传递更多，请分次数上传
					//File file3 = new File(path+"/3.log");
					//File file4 = new File(path+"/1.jpg");
					//params.put(file3.getName(),file3);
					//params.put(file4.getName(),file4);
				} catch (Exception e) {
					e.printStackTrace();
				}
				
				mAbHttpUtil.post(url, params, new AbStringHttpResponseListener() {

					
					@Override
					public void onSuccess(int statusCode, String content) {
						AbToastUtil.showToast(HttpActivity.this,"onSuccess");
					}

					// 开始执行前
		            @Override
					public void onStart() {
		            	Log.d(TAG, "onStart");
		            	//打开进度框
		            	View v = LayoutInflater.from(HttpActivity.this).inflate(R.layout.progress_bar_horizontal, null, false);
		            	mAbProgressBar = (AbHorizontalProgressBar) v.findViewById(R.id.horizontalProgressBar);
		            	numberText = (TextView) v.findViewById(R.id.numberText);
		        		maxText = (TextView) v.findViewById(R.id.maxText);
		        		
		        		maxText.setText(progress+"/"+String.valueOf(max));
		        		mAbProgressBar.setMax(max);
		        		mAbProgressBar.setProgress(progress);
		            	
		        		mAlertDialog = AbDialogUtil.showAlertDialog("正在上传",v);
					}

					@Override
					public void onFailure(int statusCode, String content,
							Throwable error) {
						AbToastUtil.showToast(HttpActivity.this,error.getMessage());
					}

					// 进度
					@Override
					public void onProgress(int bytesWritten, int totalSize) {
						maxText.setText(bytesWritten/(totalSize/max)+"/"+max);
						mAbProgressBar.setProgress(bytesWritten/(totalSize/max));
					}

					// 完成后调用，失败，成功，都要调用
		            public void onFinish() { 
		            	Log.d(TAG, "onFinish");
		            	//下载完成取消进度框
		            	if(mAlertDialog!=null){
		            	    //mAlertDialog.dismiss();
		            	   // mAlertDialog  = null;
		            	}
		            };
					
		            
		        });
			}
		});
```
> ## <h1 id="9301">1. 适合大量频繁快速响应的请求</h1>

> ## [返回目录](#93)

```
private RequestQueue mQueue = null;
	private Response.Listener<String> mListener = new Response.Listener<String>() {
		@Override
		public void onResponse(String response) {
			AbDialogUtil.showAlertDialog(HttpMiniActivity.this,"返回结果",response.trim(),new AbDialogOnClickListener(){

				@Override
				public void onNegativeClick() {
				}

				@Override
				public void onPositiveClick() {
				}
        	});
		}
	};
	
	private Response.ErrorListener mErrorListener = new Response.ErrorListener() {
		@Override
		public void onErrorResponse(VolleyError error) {
			AbToastUtil.showToast(HttpMiniActivity.this,error.getMessage());
		}
    };
	

mQueue = Volley.newRequestQueue(this);  
		
		// get请求
		getBtn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {

				// 一个url地址
				String urlGet = "http://blog.csdn.net/shineflowers/article/details/44176549";
				StringRequest requestGet = new StringRequest(urlGet,mListener,mErrorListener);
				
				mQueue.add(requestGet);
				
				String urlPost = "http://www.baidu.com";
				
				StringRequest requestPost = new StringRequest(Method.POST, urlPost, mListener,mErrorListener) {
					@Override
					protected Map<String, String> getParams() throws AuthFailureError {
						Map<String, String> map = new HashMap<String, String>();
						map.put("params1", "value1");
						map.put("params2", "value2");
						return map;
					}
				};
				
				mQueue.add(requestPost);

			}
		});



@Override
	public void finish() {
		mQueue.cancelAll(new RequestFilter(){

			@Override
			public boolean apply(Request<?> request) {
				//所有
				return true;
			}
			
		});
		super.finish();
	}
```
> ## <h1 id="1701">1. 异步的使用参照</h1>

> ## [返回目录](#17)

```
//单个线程
        threadBtn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View arg0) {
				//显示进度框
				AbDialogUtil.showProgressDialog(ThreadControlActivity.this,R.drawable.progress_circular,"正在查询...");
				AbTask mAbTask = new AbTask();
				//定义异步执行的对象
		    	final AbTaskItem item = new AbTaskItem();
				item.setListener(new AbTaskListener() {

					@Override
					public void update() {
						AbDialogUtil.removeDialog(ThreadControlActivity.this);
						AbToastUtil.showToast(ThreadControlActivity.this,"执行完成");
					}

					@Override
					public void get() {
			   		    try {
			   		    	AbToastUtil.showToastInThread(ThreadControlActivity.this,"开始执行");
			   		    	Thread.sleep(3000);
			   		    	//下面写要执行的代码，如下载数据  完成耗时的任务
			   		    } catch (Exception e) {
			   		    }
				  };
				});
				//开始执行
				mAbTask.execute(item);
			}
        	
        });


 //线程队列
        final AbTaskQueue mAbTaskQueue = AbTaskQueue.getInstance();;
        queueBtn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View arg0) {
				//显示进度框
				AbDialogUtil.showProgressDialog(ThreadControlActivity.this,R.drawable.progress_circular,"正在查询...");
				//获取队列
				//定义异步执行的对象
		    	AbTaskItem item1 = new AbTaskItem();
				item1.setListener(new AbTaskObjectListener() {

					
					@SuppressWarnings("unchecked")
					@Override
					public String getObject() {
						String msg1 = "amsoft";
						AbToastUtil.showToastInThread(ThreadControlActivity.this,"开始执行1,"+msg1);
		   		    	try {
							Thread.sleep(2000);
						} catch (Exception e) {
						}
		   		    	//下面写要执行的代码，如下载数据
						return msg1;
					}

					@Override
					public <T> void update(T obj) {
						AbToastUtil.showToast(ThreadControlActivity.this,"执行完成1,"+(String)obj);
					}

				});
				
				AbTaskItem item2 = new AbTaskItem();
				item2.setListener(new AbTaskListener() {

					@Override
					public void update() {
						AbToastUtil.showToast(ThreadControlActivity.this,"执行完成2");
						AbDialogUtil.removeDialog(ThreadControlActivity.this);
					}

					@Override
					public void get() {
			   		    try {
			   		    	String msg1 = "amsoft";
			   		    	Thread.sleep(2000);
			   		    	AbToastUtil.showToastInThread(ThreadControlActivity.this,"开始执行2");
			   		    	//下面写要执行的代码，如下载数据
			   		    } catch (Exception e) {
			   		    }
				  };
				});
				
				//开始执行
				mAbTaskQueue.execute(item1);
				mAbTaskQueue.execute(item2);
				
				//强制停止
				//mAbTaskQueue.cancel(true);
				
				//强制停止前面的请求
				//mAbTaskQueue.execute(item2,true);
			}
        	
        });
        
        
        //线程池
        poolBtn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View arg0) {
				//显示进度框
				AbDialogUtil.showProgressDialog(ThreadControlActivity.this,R.drawable.progress_circular,"正在查询...");
				AbTaskPool mAbTaskPool = AbTaskPool.getInstance();
				//定义异步执行的对象
		    	final AbTaskItem item = new AbTaskItem();
				item.setListener(new AbTaskListener() {

					@Override
					public void update() {
						AbDialogUtil.removeDialog(ThreadControlActivity.this);
						AbToastUtil.showToast(ThreadControlActivity.this,"执行完成");
					}

					@Override
					public void get() {
			   		    try {
			   		    	AbToastUtil.showToastInThread(ThreadControlActivity.this,"开始执行");
			   		    	Thread.sleep(1000);
			   		    	//下面写要执行的代码，如下载数据
			   		    } catch (Exception e) {
			   		    }
				  };
				});
				//开始执行
				mAbTaskPool.execute(item);
			}
        	
        });
        
        //异步任务(void)
        taskBtn1.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View arg0) {
				AbDialogUtil.showProgressDialog(ThreadControlActivity.this,R.drawable.progress_circular,"正在查询...");
				AbTask task = new AbTask();
				//定义异步执行的对象
		    	final AbTaskItem item = new AbTaskItem();
				item.setListener(new AbTaskListener() {

					@Override
					public void update() {
						AbDialogUtil.removeDialog(ThreadControlActivity.this);
						AbToastUtil.showToast(ThreadControlActivity.this,"执行完成");
					}

					@Override
					public void get() {
			   		    try {
			   		    	AbToastUtil.showToastInThread(ThreadControlActivity.this,"开始执行");
			   		    	Thread.sleep(3000);
			   		    	//下面写要执行的代码，如下载数据
			   		    } catch (Exception e) {
			   		    }
				  };
				});
		        task.execute(item);
			}
        	
        });
        
        //异步任务(对象)
        taskBtn2.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View arg0) {
				AbDialogUtil.showProgressDialog(ThreadControlActivity.this,R.drawable.progress_circular,"正在查询...");
			    //执行任务
			    loadObjectDataTask();
			}
        	
        });


public void loadObjectDataTask(){
        AbTask task = new AbTask();
        final AbTaskItem item = new AbTaskItem();
        item.setListener(new AbTaskObjectListener(){

            @Override
            public <T> void update(T entity) {
                AbDialogUtil.removeDialog(ThreadControlActivity.this);
                AbToastUtil.showToast(ThreadControlActivity.this,(String)entity);
                Log.d("TAG", "执行完成:"+(String)entity);
            }

            @SuppressWarnings("unchecked")
            @Override
            public String getObject() {
                String result = null;
                try {
                    Thread.sleep(3000);
                    result = "hello andbase";
                } catch (Exception e) {
                    e.printStackTrace();
                }
                return result;
            }
            
        });
        
        task.execute(item);
        
        //task.cancel(mayInterruptIfRunning)
    }
```
> ## <h1 id="0501">1. 多种弹出框的用法</h1>

> ## [返回目录](#05)
![](http://i.imgur.com/QwhIfjx.jpg)

```
 @AbIocView(id = R.id.button2,click="btnClick")Button button2;

case R.id.button11:
			//无按钮＋动画  特色标题，自己放view进去
			mView = mInflater.inflate(R.layout.dialog_text,null);
			AbDialogUtil.showDialog(mView,R.animator.fragment_top_enter,R.animator.fragment_top_exit,R.animator.fragment_pop_top_enter,R.animator.fragment_pop_top_exit);
			break;
		case R.id.button12:
			//按钮＋列表
			mView = mInflater.inflate(R.layout.dialog_button_listview,null);
			AbDialogUtil.showDialog(mView,R.animator.fragment_top_enter,R.animator.fragment_top_exit,R.animator.fragment_pop_top_enter,R.animator.fragment_pop_top_exit);
			ListView listView = (ListView)mView.findViewById(R.id.list);
			String[] mStrings = {
		            "对话框选项item1", "对话框选项item2", "对话框选项item3", "对话框选项item4"};
			listView.setAdapter(new ArrayAdapter<String>(this,
		               R.layout.dialog_list_item_1, mStrings));
			Button leftBtn = (Button)mView.findViewById(R.id.left_btn);
			Button rightBtn = (Button)mView.findViewById(R.id.right_btn);
			leftBtn.setOnClickListener(new OnClickListener(){

				@Override
				public void onClick(View v) {
					AbDialogUtil.removeDialog(DialogActivity.this);
				}
				
			});
			
			rightBtn.setOnClickListener(new OnClickListener(){

				@Override
				public void onClick(View v) {
					AbDialogUtil.removeDialog(DialogActivity.this);
				}
				
			});
			
			break;
case R.id.button13:
			//按钮＋文本
			//动画未生效
			mView = mInflater.inflate(R.layout.dialog_text_button,null);
			AbDialogUtil.showDialog(mView,R.animator.fragment_top_enter,R.animator.fragment_top_exit,R.animator.fragment_pop_top_enter,R.animator.fragment_pop_top_exit);
			Button leftBtn1 = (Button)mView.findViewById(R.id.left_btn);
			Button rightBtn1 = (Button)mView.findViewById(R.id.right_btn);
			leftBtn1.setOnClickListener(new OnClickListener(){

				@Override
				public void onClick(View v) {
					AbDialogUtil.removeDialog(DialogActivity.this);
				}
				
			});
			
			rightBtn1.setOnClickListener(new OnClickListener(){

				@Override
				public void onClick(View v) {
					AbDialogUtil.removeDialog(DialogActivity.this);
				}
				
			});
			break;
case R.id.button14:
			//上
			mView = mInflater.inflate(R.layout.dialog_custom_view,null);
			AbDialogUtil.showDialog(mView,Gravity.TOP);
			break;
		case R.id.button15:
			//中
			mView = mInflater.inflate(R.layout.dialog_custom_view,null);
			AbDialogUtil.showDialog(mView,Gravity.CENTER);
			break;
		case R.id.button16:
			//下
			mView = mInflater.inflate(R.layout.dialog_custom_view,null);
			AbDialogUtil.showDialog(mView,Gravity.BOTTOM);
			break;
		case R.id.button17:
			//全屏
			mView = mInflater.inflate(R.layout.dialog_custom_view,null);
			AbDialogUtil.showFullScreenDialog(mView);
			break;
		case R.id.button18:
			AbDialogUtil.showProgressDialog(DialogActivity.this, 0,
					"查询中...");
			//AbDialogUtil.removeDialog(DemoAbActivity.this);
			break;
		case R.id.button19:
			AbToastUtil.showToast(DialogActivity.this, "Toast提示框");
			break;
```

> ## <h1 id="0601">1. 下载图片与裁剪缩放</h1>

> ## [返回目录](#06)

```
//图片下载类
	private AbImageLoader mAbImageLoader = null;


 String imageUrl = "https://timg01.bdimg.com/timg?pacompress&imgtype=1&sec=1439619614&autorotate=1&di=e2148c26123235aa7c5e07cd5d369e65&quality=90&size=b870_10000&src=http%3A%2F%2Fbos.nj.bpc.baidu.com%2Fv1%2Fmediaspot%2F76ec2b982287bcb6244a8d4d551b38c9.jpeg";


 //图片的下载
        mAbImageLoader = AbImageLoader.newInstance(this);
        mAbImageLoader.setLoadingImage(R.drawable.image_loading);
        mAbImageLoader.setErrorImage(R.drawable.image_error);
        mAbImageLoader.setEmptyImage(R.drawable.image_empty);




 //原图片的下载
        mAbImageLoader.setMaxWidth(0);
        mAbImageLoader.setMaxHeight(0);
        mAbImageLoader.display(scaleView,imageUrl);
        
        //缩放图片的下载（保持宽高比，计算缩放比例，使一个方向缩放后，另一方向不小与显示的大小的最合适比例）
        mAbImageLoader.setMaxWidth(150);
        mAbImageLoader.setMaxHeight(150);
        mAbImageLoader.display(scaleView2,imageUrl2);
        
        //放大图片的下载
        mAbImageLoader.setMaxWidth(180);
        mAbImageLoader.setMaxHeight(180);
        mAbImageLoader.display(scaleView3,imageUrl3);
```
> ## <h1 id="4201">1. 下拉刷新分页</h1>

> ## [返回目录](#42)

```

extends AbActivity implements OnHeaderRefreshListener,OnFooterLoadListener



//获取ListView对象
        mAbPullToRefreshView = (AbPullToRefreshView)this.findViewById(R.id.mPullRefreshView);
        mTextView = (TextView)this.findViewById(R.id.mTextView);
        
        //设置监听器
        mAbPullToRefreshView.setOnHeaderRefreshListener(this);
        mAbPullToRefreshView.setOnFooterLoadListener(this);
        
        //设置进度条的样式
        mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        mAbPullToRefreshView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        
        //显示进度框
  		mDialogFragment = AbDialogUtil.showLoadDialog(this, R.drawable.ic_load, "查询中,请等一小会");
  		mDialogFragment
  		.setAbDialogOnLoadListener(new AbDialogOnLoadListener() {

  			@Override
  			public void onLoad() {
  				// 下载网络数据
  				refreshTask();
  			}

  		});



@Override
    public void onFooterLoad(AbPullToRefreshView view) {
	    loadMoreTask();
    }
	
    @Override
    public void onHeaderRefresh(AbPullToRefreshView view) {
        refreshTask();
    }
	
	
	public void refreshTask(){
        AbTask mAbTask = new AbTask();
        final AbTaskItem item = new AbTaskItem();
        item.setListener(new AbTaskListener() {

            @Override
            public void update() {
            	AbDialogUtil.removeDialog(PullToRefreshViewActivity.this);
                mTextView.setText("This is "+new Random().nextInt(100));
                mAbPullToRefreshView.onHeaderRefreshFinish();
            }

            @Override
            public void get() {
                try {
                    Thread.sleep(1000);
                } catch (Exception e) {
                }
          };
        });
        
        mAbTask.execute(item);
    }
	
	public void loadMoreTask(){
        AbTask mAbTask = new AbTask();
        final AbTaskItem item = new AbTaskItem();
        item.setListener(new AbTaskListener() {

            @Override
            public void update() {
            	AbDialogUtil.removeDialog(PullToRefreshViewActivity.this);
                mTextView.append("+"+new Random().nextInt(100));
                mAbPullToRefreshView.onFooterLoadFinish();
            }

            @Override
            public void get() {
                try {
                    Thread.sleep(1000);
                } catch (Exception e) {
                }
          };
        });
        
        mAbTask.execute(item);
    }
```

> ## <h1 id="2501">1. 下拉刷新上滑加载分页</h1>

> ## [返回目录](#25)

```
下拉刷新，上滑加载页面，分页加载。
```
> ## <h1 id="4301">1. 运用集成的方法实现访问网络并把字符串解析成对象</h1>

> ## [返回目录](#43)

```
public void refreshTask() {
		currentPage = 1;
		String url = "http://www.duitang.com/album/1733789/masn/p/"
				+ currentPage + "/24/";
		mAbHttpUtil.get(url, new AbStringHttpResponseListener() {
			

			@Override
			public void onStart() {
			}

			@Override
			public void onSuccess(int statusCode, String content) {
				List<ImageInfo> mNewImageList = parseJSON(content);
				mImageList.clear();
				if (mNewImageList != null && mNewImageList.size() > 0) {
					mImageList.addAll(mNewImageList);
					myListViewAdapter.notifyDataSetChanged();
				}
				mAbPullToRefreshView.onHeaderRefreshFinish();
			}

			@Override
			public void onFailure(int statusCode, String content,
					Throwable error) {
				AbToastUtil.showToast(PullToRefreshMultiColumnListActivity.this,error.getMessage());
			}

			public void onFinish() {
			};

		});

	}

	public void loadMoreTask() {
		currentPage++;
		String url = "http://www.duitang.com/album/1733789/masn/p/"
				+ currentPage + "/24/";
		mAbHttpUtil.get(url, new AbStringHttpResponseListener() {

			@Override
			public void onStart() {
			}

			@Override
			public void onSuccess(int statusCode, String content) {
				List<ImageInfo> mNewImageList = parseJSON(content);

				if (mNewImageList != null && mNewImageList.size() > 0) {
					mImageList.addAll(mNewImageList);
					myListViewAdapter.notifyDataSetChanged();
				}
				mAbPullToRefreshView.onFooterLoadFinish();
			}

			@Override
			public void onFailure(int statusCode, String content,
					Throwable error) {
				AbToastUtil.showToast(PullToRefreshMultiColumnListActivity.this,error.getMessage());
			}

			public void onFinish() {
			};

		});
	}
	

	/**
	 * 
	 * 描述：数据来源
	 * 
	 * @param json
	 * @return
	 * @throws
	 */
	public List<ImageInfo> parseJSON(String json) {
		List<ImageInfo> mImageList = new ArrayList<ImageInfo>();
		try {
			if (null != json) {
				JSONObject newsObject = new JSONObject(json);
				JSONObject jsonObject = newsObject.getJSONObject("data");
				JSONArray blogsJson = jsonObject.getJSONArray("blogs");
				ImageInfo imageInfo = null;
				for (int i = 0; i < blogsJson.length(); i++) {
					imageInfo = new ImageInfo();
					JSONObject newsInfoLeftObject = blogsJson.getJSONObject(i);
					imageInfo.setUrl(newsInfoLeftObject.isNull("isrc") ? ""
							: newsInfoLeftObject.getString("isrc"));
					imageInfo.setWidth(newsInfoLeftObject.getInt("iwd"));
					imageInfo.setHeight(newsInfoLeftObject.getInt("iht"));
					mImageList.add(imageInfo);
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mImageList;
	}
```
> ## <h1 id="2101">1. 多线程断点续传 下载器</h1>

> ## [返回目录](#21)

```
多线程断点续传 下载器
```
> ## <h1 id="2701">1. 滑动按钮</h1>

> ## [返回目录](#27)

```
<com.ab.view.sliding.AbSlidingButton
        android:id="@+id/mSliderBtn"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentRight="true"
        android:layout_marginTop="8dip"
        android:layout_marginRight="10dip">
    </com.ab.view.sliding.AbSlidingButton>

holder.itemsCheck = ((AbSlidingButton) convertView.findViewById(mTo[2])) ;

//设置开关显示所用的图片
          holder.itemsCheck.setImageResource(R.drawable.btn_bottom,R.drawable.btn_frame,R.drawable.btn_mask, R.drawable.btn_unpressed,R.drawable.btn_pressed);
          //holder.itemsCheck.setFocusable(false);
          //设置开关的默认状态    true开启状态
          //holder.itemsCheck.setToggleState(true);
          
          //设置开关的监听
          holder.itemsCheck.setOnCheckedChangeListener(new OnCheckedChangeListener() {
			
			@Override
			public void onCheckedChanged(CompoundButton arg0, boolean arg1) {
				AbToastUtil.showToast(mContext,"开关变化");
			}
		});
```
![](http://i.imgur.com/ZOSG5nE.jpg)

```
这个是图形的布局

<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent" >

    <TextView
        android:id="@+id/itemsTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_vertical"
        android:paddingLeft="10dip"
        android:paddingTop="5dip"
        android:textColor="@color/gray_dark"
        android:textSize="20dip" />

    <TextView
        android:id="@+id/itemsText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_below="@+id/itemsTitle"
        android:gravity="left"
        android:paddingBottom="2dip"
        android:paddingLeft="10dip"
        android:textColor="@color/gray"
        android:textSize="15dip" />

    <com.ab.view.sliding.AbSlidingButton
        android:id="@+id/mSliderBtn"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentRight="true"
        android:layout_marginTop="8dip"
        android:layout_marginRight="10dip">
    </com.ab.view.sliding.AbSlidingButton>

</RelativeLayout>
```
> ## <h1 id="2801">1. 图片联播</h1>

> ## [返回目录](#28)

```
<com.ab.view.sliding.AbSlidingPlayView
        android:id="@+id/mAbSlidingPlayView"
        android:layout_width="fill_parent"
        android:layout_height="150dip" >
    </com.ab.view.sliding.AbSlidingPlayView>


 addAllButton.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				mSlidingPlayView.removeAllViews();
				mSlidingPlayView.addView(mPlayView);
				mSlidingPlayView.addView(mPlayView1);
				mSlidingPlayView.addView(mPlayView2);
			}
        	
        });
        
        removeButton.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				mSlidingPlayView.removeAllViews();
			}
        	
        });
        
        startButton.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				mSlidingPlayView.startPlay();
			}
        	
        });
        
        stopButton.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				mSlidingPlayView.stopPlay();
			}
        	
        });

 mSlidingPlayView.setOnItemClickListener(new AbSlidingPlayView.AbOnItemClickListener() {
			
			@Override
			public void onClick(int position) {
				AbToastUtil.showToast(SlidingPlayViewActivity.this,"点击"+position);
			}
		});
        
        mSlidingPlayView.setOnPageChangeListener(new AbSlidingPlayView.AbOnChangeListener() {
			
			@Override
			public void onChange(int position) {
				AbToastUtil.showToast(SlidingPlayViewActivity.this,"改变"+position);
			}
		});
```
> ## <h1 id="9201">1. 提示框</h1>

> ## [返回目录](#92)

```
	RelativeLayout rootView = null;
	AbPopoverView popoverView = null;

 		rootView = (RelativeLayout)findViewById(R.id.rootLayout);
        popoverView = new AbPopoverView(this);
        popoverView.setBackgroundDrawable(this.getResources().getDrawable(R.drawable.popover_bg));
        popoverView.setArrowLeftDrawable(this.getResources().getDrawable(R.drawable.popover_arrow_left));
        popoverView.setArrowRightDrawable(this.getResources().getDrawable(R.drawable.popover_arrow_right));
        popoverView.setArrowDownDrawable(this.getResources().getDrawable(R.drawable.popover_arrow_down));
        popoverView.setArrowUpDrawable(this.getResources().getDrawable(R.drawable.popover_arrow_up));
        
        popoverView.setContentSizeForViewInPopover(new Point(300, 300));
        popoverView.setPopoverViewListener(new AbPopoverView.PopoverViewListener() {
			
			@Override
			public void popoverViewWillShow(AbPopoverView view) {
			}
			
			@Override
			public void popoverViewWillDismiss(AbPopoverView view) {
			}
			
			@Override
			public void popoverViewDidShow(AbPopoverView view) {
			}
			
			@Override
			public void popoverViewDidDismiss(AbPopoverView view) {
			}
		});


	@Override
	public void onClick(View v) {
		popoverView.setPopoverContentView(mInflater.inflate(R.layout.popover_showed_view, null));
		popoverView.showPopoverFromRectInViewGroup(rootView, AbPopoverView.getFrameForView(v), AbPopoverView.PopoverArrowDirectionAny, true);
	}
```
> ## <h1 id="3701">1.轮子选择</h1>

> ## [返回目录](#37)

![](http://i.imgur.com/jlOCl8G.jpg)
```
 timeTextView1.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				mTimeView1 = mInflater.inflate(R.layout.choose_three, null);
				// mTimeView1这个是自定义的视图
				initWheelDate(mTimeView1,timeTextView1);
				AbDialogUtil.showDialog(mTimeView1,Gravity.BOTTOM);
			}
			
		});
 

			这个是自定义控件
				<com.ab.view.wheel.AbWheelView
                android:id="@+id/wheelView3"
                android:layout_width="wrap_content"
                android:layout_height="fill_parent"
                android:layout_marginLeft="5dip"
                android:layout_weight="1"
                android:background="@drawable/wheel_bg_1" />


public void initWheelData1(View mDataView1){
    	final AbWheelView mWheelView1 = (AbWheelView)mDataView1.findViewById(R.id.wheelView1);
		mWheelView1.setAdapter(new AbNumericWheelAdapter(40, 190));
		// 可循环滚动
		mWheelView1.setCyclic(true);
		// 添加文字
		mWheelView1.setLabel(getResources().getString(R.string.data1_unit));
		// 初始化时显示的数据
		mWheelView1.setCurrentItem(40);
		mWheelView1.setValueTextSize(35);
		mWheelView1.setLabelTextSize(35);
		mWheelView1.setLabelTextColor(0x80000000);
		mWheelView1.setCenterSelectDrawable(this.getResources().getDrawable(R.drawable.wheel_select));
		
		Button okBtn = (Button)mDataView1.findViewById(R.id.okBtn);
		Button cancelBtn = (Button)mDataView1.findViewById(R.id.cancelBtn);
		okBtn.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				AbDialogUtil.removeDialog(v.getContext());
				int index = mWheelView1.getCurrentItem();
				String val = mWheelView1.getAdapter().getItem(index);
				mDataTextView1.setText(val);
			}
			
		});
		
		cancelBtn.setOnClickListener(new OnClickListener(){

			@Override
			public void onClick(View v) {
				AbDialogUtil.removeDialog(v.getContext());
			}
			
		});
    }
```
```
以下是图形的xml文件
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/gray_white" >

    <LinearLayout
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical" >

        <include
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            layout="@layout/space_view_title" />

        <LinearLayout
            android:id="@+id/layout01"
            android:layout_width="fill_parent"
            android:layout_height="wrap_content"
            android:layout_marginLeft="10dip"
            android:layout_marginRight="10dip"
            android:layout_marginTop="10dip"
            android:background="@drawable/edit_text_n"
            android:orientation="vertical" >

            <RelativeLayout
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical" >

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:hint="@string/date_picker"
                    android:paddingBottom="8dip"
                    android:paddingLeft="5dip"
                    android:paddingTop="10dip"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />

                <TextView
                    android:id="@+id/measureTimeText1"
                    android:layout_width="fill_parent"
                    android:layout_height="45dip"
                    android:background="@color/transparent"
                    android:clickable="true"
                    android:gravity="center_vertical|right"
                    android:paddingRight="10dip"
                    android:singleLine="true"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />
            </RelativeLayout>
			<!-- 这个是分界线 -->
            <View
                android:layout_width="match_parent"
                android:layout_height="1dip"
                android:background="@drawable/list_divider"
                android:focusable="true"
                android:focusableInTouchMode="true" />

            <RelativeLayout
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical" >

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:hint="@string/time_picker1"
                    android:paddingBottom="8dip"
                    android:paddingLeft="5dip"
                    android:paddingTop="10dip"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />

                <TextView
                    android:id="@+id/measureTimeText2"
                    android:layout_width="fill_parent"
                    android:layout_height="45dip"
                    android:background="@color/transparent"
                    android:clickable="true"
                    android:gravity="center_vertical|right"
                    android:paddingRight="10dip"
                    android:singleLine="true"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />
            </RelativeLayout>
            
            <View
                android:layout_width="match_parent"
                android:layout_height="1dip"
                android:background="@drawable/list_divider"
                android:focusable="true"
                android:focusableInTouchMode="true" />

            <RelativeLayout
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical" >

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:hint="@string/time_picker2"
                    android:paddingBottom="8dip"
                    android:paddingLeft="5dip"
                    android:paddingTop="10dip"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />

                <TextView
                    android:id="@+id/measureTimeText3"
                    android:layout_width="fill_parent"
                    android:layout_height="45dip"
                    android:background="@color/transparent"
                    android:clickable="true"
                    android:gravity="center_vertical|right"
                    android:paddingRight="10dip"
                    android:singleLine="true"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />
            </RelativeLayout>
        </LinearLayout>
<!-- 以上是前三个选项框 -->
        <LinearLayout
            android:layout_width="fill_parent"
            android:layout_height="wrap_content"
            android:layout_marginLeft="10dip"
            android:layout_marginRight="10dip"
            android:layout_marginTop="10dip"
            android:background="@drawable/edit_text_n"
            android:orientation="vertical" >

            <RelativeLayout
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical" >

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:hint="@string/data1_desc"
                    android:paddingBottom="8dip"
                    android:paddingLeft="5dip"
                    android:paddingTop="10dip"
                    android:textColor="@color/gray_dark"
                    android:textSize="18sp" />

                <TextView
                    android:id="@+id/dataTextView1"
                    android:layout_width="fill_parent"
                    android:layout_height="45dip"
                    android:background="@color/transparent"
                    android:clickable="true"
                    android:gravity="center_vertical|right"
                    android:maxLength="20"
                    android:paddingRight="80dip"
                    android:singleLine="true"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />

                <TextView
                    android:layout_width="70dip"
                    android:layout_height="45dip"
                    android:layout_alignParentRight="true"
                    android:drawableLeft="@drawable/line"
                    android:drawablePadding="5dip"
                    android:paddingBottom="8dip"
                    android:paddingRight="5dip"
                    android:paddingTop="10dip"
                    android:text="@string/data1_unit"
                    android:textColor="@color/gray"
                    android:textSize="18sp" />
            </RelativeLayout>
            
        </LinearLayout>
    </LinearLayout>

</ScrollView>

```

> ## <h1 id="3001">1.欢迎页面</h1>

> ## [返回目录](#30)

```
	/**
	 * 初始化控件
	 */
	private void init() {
		initAnim();
		initPicture();
		/**
		 * 界面刚开始显示的内容
		 */
		mShowPicture.setImageDrawable(mPicture_1);
		mShowText.setText("图片1");
		mShowPicture.startAnimation(mFadeIn);
	}

	/**
	 * 三个切换的动画
	 */
	private Animation mFadeIn;
	private Animation mFadeInScale;
	private Animation mFadeOut;

	/**
	 * 初始化动画
	 */
	private void initAnim() {
		mFadeIn = AnimationUtils.loadAnimation(WelcomeActivity.this,R.anim.welcome_fade_in);
		mFadeIn.setDuration(1000);
		mFadeInScale = AnimationUtils.loadAnimation(WelcomeActivity.this,R.anim.welcome_fade_in_scale);
		mFadeInScale.setDuration(6000);
		mFadeOut = AnimationUtils.loadAnimation(WelcomeActivity.this,R.anim.welcome_fade_out);
		mFadeOut.setDuration(1000);
	}


	/**
	 * 三个图片
	 */
	private Drawable mPicture_1;
	private Drawable mPicture_2;
	private Drawable mPicture_3;
	/**
	 * 初始化图片  把图片转化成对象
	 */
	private void initPicture() {
		mPicture_1 = getResources().getDrawable(R.drawable.pic1);
		mPicture_2 = getResources().getDrawable(R.drawable.pic2);
		mPicture_3 = getResources().getDrawable(R.drawable.pic3);
	}


	/**
	 * 监听事件
	 */
	private void setListener() {
		/**
		 * 动画切换原理:开始时是用第一个渐现动画,当第一个动画结束时开始第二个放大动画,当第二个动画结束时调用第三个渐隐动画,
		 * 第三个动画结束时修改显示的内容并且重新调用第一个动画,从而达到循环效果
		 */
		mFadeIn.setAnimationListener(new AnimationListener() {

			public void onAnimationStart(Animation animation) {

			}

			public void onAnimationRepeat(Animation animation) {

			}

			public void onAnimationEnd(Animation animation) {
				mShowPicture.startAnimation(mFadeInScale);
			}
		});
		mFadeInScale.setAnimationListener(new AnimationListener() {

			public void onAnimationStart(Animation animation) {

			}

			public void onAnimationRepeat(Animation animation) {

			}

			public void onAnimationEnd(Animation animation) {
				mShowPicture.startAnimation(mFadeOut);
			}
		});
		mFadeOut.setAnimationListener(new AnimationListener() {

			public void onAnimationStart(Animation animation) {

			}

			public void onAnimationRepeat(Animation animation) {

			}

			public void onAnimationEnd(Animation animation) {
				/**
				 * 这里其实有些写的不好,还可以采用更多的方式来判断当前显示的是第几个,从而修改数据,
				 * 我这里只是简单的采用获取当前显示的图片来进行判断。
				 */
				if (mShowPicture.getDrawable().equals(mPicture_1)) {
					mShowText.setText("图片1");
					mShowPicture.setImageDrawable(mPicture_2);
				} else if (mShowPicture.getDrawable().equals(mPicture_2)) {
					mShowText.setText("图片2");
					mShowPicture.setImageDrawable(mPicture_3);
				} else if (mShowPicture.getDrawable().equals(mPicture_3)) {
					mShowText.setText("图片3");
					mShowPicture.setImageDrawable(mPicture_1);
				}
				mShowPicture.startAnimation(mFadeIn);
			}
		});
		
	}
```
> ## <h1 id="3901">1.拍照相册选择</h1>

> ## [返回目录](#39)

```
这些都是变量

 private GridView mGridView = null;
    private ArrayList<String> mPhotoList = null;
    private int selectIndex = 0;
    private int camIndex = 0;
    private View mAvatarView = null;

    /* 用来标识请求照相功能的activity */
    private static final int CAMERA_WITH_DATA = 3023;
    /* 用来标识请求gallery的activity */
    private static final int PHOTO_PICKED_WITH_DATA = 3021;
    /* 用来标识请求裁剪图片后的activity */
    private static final int CAMERA_CROP_DATA = 3022;

    /* 拍照的照片存储位置 */
    private File PHOTO_DIR = null;
    // 照相机拍照得到的图片
    private File mCurrentPhotoFile;
    private String mFileName;

    /* ProgressBar进度控制 */
    private AbHorizontalProgressBar mAbProgressBar;
    /* 最大100 */
    private int max = 100;
    private int progress = 0;
    private TextView numberText, maxText;
    private DialogFragment mAlertDialog  = null;
    private AbHttpUtil mAbHttpUtil = null;

实例化
//获取Http工具类
        mAbHttpUtil = AbHttpUtil.getInstance(this);
        uploadFile();


网络访问的方法
public void uploadFile(){
        //已经在后台上传
        if(mAlertDialog!=null){
            mAlertDialog.show(getFragmentManager(), "dialog");
            return;
        }
        //String url = "http://192.168.0.104:8080/demo/upload.do";
        String url = "http://211.149.169.221:8080/umijoyappsvr/distribution/DistributionLogin.do";

        AbRequestParams params = new AbRequestParams();

        try {
            //多文件上传添加多个即可
           // params.put("data1", URLEncoder.encode("如果包含中文的处理方式", HTTP.UTF_8));
            params.put("phoneNum","15132146262");
            params.put("password","123456");
            //文件参数，去掉后边那个按钮 上传多个文件
           /* for(int i=0;i<list.size()-1;i++){
                String path = list.get(i);
                File file = new File(path);
                params.put(file.getName(),file);
            }*/
        } catch (Exception e) {
            e.printStackTrace();
        }

        mAbHttpUtil.post(url, params, new AbStringHttpResponseListener() {


            @Override
            public void onSuccess(int statusCode, String content) {
                AbToastUtil.showToast(MainActivity.this, content);
            }

            // 开始执行前
            @Override
            public void onStart() {
                //打开进度框
                View v = LayoutInflater.from(MainActivity.this).inflate(R.layout.progress_bar_horizontal, null, false);
                mAbProgressBar = (AbHorizontalProgressBar) v.findViewById(R.id.horizontalProgressBar);
                numberText = (TextView) v.findViewById(R.id.numberText);
                maxText = (TextView) v.findViewById(R.id.maxText);

                maxText.setText(progress+"/"+String.valueOf(max));
                mAbProgressBar.setMax(max);
                mAbProgressBar.setProgress(progress);

                mAlertDialog = AbDialogUtil.showAlertDialog("正在上传", v);
            }

            @Override
            public void onFailure(int statusCode, String content,
                                  Throwable error) {
                AbToastUtil.showToast(MainActivity.this,error.getMessage());
            }

            // 进度
            @Override
            public void onProgress(int bytesWritten, int totalSize) {
                maxText.setText(bytesWritten/(totalSize/max)+"/"+max);
                mAbProgressBar.setProgress(bytesWritten/(totalSize/max));
            }

            // 完成后调用，失败，成功，都要调用
            public void onFinish() {
                //下载完成取消进度框
                if(mAlertDialog!=null){
                  /*  mAlertDialog.dismiss();
                    mAlertDialog  = null;*/
                }
            };


        });
    }
```
> ## <h1 id="0901">1.城市选择</h1>

> ## [返回目录](#09)

```
	<com.ab.view.sample.AbLetterFilterListView
        android:id="@+id/letterView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent" >

        <ListView
            android:id="@+id/listView"
            android:layout_width="fill_parent"
            android:layout_height="fill_parent"
            android:layout_gravity="center"
            android:cacheColorHint="#00000000"
            android:divider="@null"/>
    </com.ab.view.sample.AbLetterFilterListView>

添加头部
private ListView mListView = null;

		// 获取ListView对象
		View headerView = LayoutInflater.from(this).inflate(R.layout.city_header, null);
		mListView = (ListView) this.findViewById(R.id.listView);
		mListView.addHeaderView(headerView);


//填充数据
	public void downTask() {
		AbLogUtil.prepareLog(CityListActivity.class);
		AbTask mAbTask = new AbTask();
		final AbTaskItem item = new AbTaskItem();
		item.setListener(new AbTaskListListener() {
			@Override
			public List<?> getList() {
				List<City> newList = null;
				try {
					newList = filledData(getResources().getStringArray(R.array.list));
				} catch (Exception e) {
				}
				return newList;
			}

			@Override
			public void update(List<?> paramList) {
				list.clear();
				list.addAll((List<City>)paramList);
				//通知Dialog
				mDialogFragment.loadFinish();
				mCityListAdapter.notifyDataSetChanged();
			}

		});

		mAbTask.execute(item);
	}
	
	/**
	 * 为ListView填充数据
	 * @param date
	 * @return
	 */
	private List<City> filledData(String [] array){
		List<City> newList = new ArrayList<City>();
		//实例化汉字转拼音类
		AbCharacterParser	characterParser = AbCharacterParser.getInstance();
		
		for(int i=0; i<array.length; i++){
			City city = new City();
			city.setName(array[i]);
			//汉字转换成拼音 在得到拼音的首字母的大写
			String pinyin = characterParser.getSelling(array[i]);
			String sortString = pinyin.substring(0, 1).toUpperCase();
			
			// 正则表达式，判断首字母是否是英文字母
			if(sortString.matches("[A-Z]")){
				city.setFirstLetter(sortString.toUpperCase());
			}else{
				city.setFirstLetter("#");
			}
			newList.add(city);
		}
		//对数据进行排列
		Collections.sort(newList);
		return newList;
		
	}


/**
	 * 根据输入框中的值来过滤数据并更新ListView
	 * @param filterStr
	 */
	private void filterData(String filterStr){
		//实例化汉字转拼音类
		AbCharacterParser characterParser = AbCharacterParser.getInstance();
		List<City> filterDateList = new ArrayList<City>();
		if(!TextUtils.isEmpty(filterStr)){
			for(City city : list){
				String name = city.getName();
				//如果城市名的拼音以filterStr开头，或者城市名中包含filterStr
				if(name.indexOf(filterStr) != -1 || characterParser.getSelling(name).startsWith(filterStr)){
					filterDateList.add(city);
				}
			}
		}
		
		// 根据a-z进行排序
		Collections.sort(filterDateList);
	//跟新适配器
		mCityListAdapter.updateListView(filterDateList);
	}

	/**
	 * 当ListView数据发生变化时,调用此方法来更新ListView  
	 * @param list  CityListAdapter中的方法
	 */
	public void updateListView(List<City> list){
		this.list.clear();
		this.list.addAll(list);
		notifyDataSetChanged();
	}

```
> ## <h1 id="4501">1.左边的侧边栏</h1>

> ## [返回目录](#45)

```
private SlidingMenu menu;


 //主视图的Fragment添加
		getFragmentManager()
		.beginTransaction()
		.replace(R.id.content_frame, new FragmentLoad())
		.commit();

		//SlidingMenu的配置
		menu = new SlidingMenu(this);
		menu.setMode(SlidingMenu.LEFT);
		menu.setTouchModeAbove(SlidingMenu.TOUCHMODE_FULLSCREEN);
		menu.setShadowWidthRes(R.dimen.shadow_width);
		menu.setShadowDrawable(R.drawable.shadow);
		menu.setBehindOffsetRes(R.dimen.slidingmenu_offset);
		menu.setFadeDegree(0.35f);
		menu.attachToActivity(this, SlidingMenu.SLIDING_CONTENT);
		
		//menu视图的Fragment添加
		menu.setMenu(R.layout.sliding_menu_menu);
		getFragmentManager()
		.beginTransaction()
		.replace(R.id.menu_frame, new FragmentLoad())
		.commit();
		
		mAbTitleBar.getLogoView().setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View arg0) {
				if (menu.isMenuShowing()) {
 					menu.showContent();
 				} else {
 					menu.showMenu();
 				}
			}
		});


	@Override
	public void onBackPressed() {
		if (menu.isMenuShowing()) {
			menu.showContent();
		} else {
			super.onBackPressed();
		}
	}
```
> ## <h1 id="1901">1.顶部切换Tab</h1>

> ## [返回目录](#19)

```
自定义控件
 <com.ab.view.sliding.AbSlidingTabView
        android:id="@+id/mAbSlidingTabView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent" />

private AbSlidingTabView mAbSlidingTabView;	
mAbSlidingTabView = (AbSlidingTabView) findViewById(R.id.mAbSlidingTabView);

 //AbSlidingTabView2这个类包含了另外的一种效果，和AbSlidingTabView是不同的
		mAbSlidingTabView = (AbSlidingTabView) findViewById(R.id.mAbSlidingTabView);
		
		//如果里面的页面列表不能下载原因：
		//Fragment里面用的AbTaskQueue,由于有多个tab，顺序下载有延迟，还没下载好就被缓存了。改成用AbTaskPool，就ok了。
		//或者setOffscreenPageLimit(0)
		
		//缓存数量
		mAbSlidingTabView.getViewPager().setOffscreenPageLimit(5);
		
		//禁止滑动
		/*mAbSlidingTabView.getViewPager().setOnTouchListener(new OnTouchListener(){

			@Override
			public boolean onTouch(View v, MotionEvent event) {
				return true;
			}
			
		});*/

		//这个是tab栏下对应的内容部分
		FragmentLoad page1 = new FragmentLoad();
		FragmentLoad page2 = new FragmentLoad();
		FragmentLoad page3 = new FragmentLoad();
		FragmentLoad page4 = new FragmentLoad();
		FragmentLoad page5 = new FragmentLoad();
		FragmentLoad page6 = new FragmentLoad();
		FragmentLoad page7 = new FragmentLoad();
		FragmentLoad page8 = new FragmentLoad();
		
		List<Fragment> mFragments = new ArrayList<Fragment>();
		mFragments.add(page1);
		mFragments.add(page2);
		mFragments.add(page3);
		mFragments.add(page4);
		
		List<String> tabTexts = new ArrayList<String>();
		tabTexts.add("推荐");
		tabTexts.add("排行");
		tabTexts.add("游戏中心");
		tabTexts.add("专题栏目");
		
		//设置样式
		mAbSlidingTabView.setTabTextColor(Color.BLACK);
		mAbSlidingTabView.setTabSelectColor(Color.rgb(30, 168, 131));
		mAbSlidingTabView.setTabBackgroundResource(R.drawable.tab_bg);
		mAbSlidingTabView.setTabLayoutBackgroundResource(R.drawable.slide_top);
		//演示增加一组 4个
		mAbSlidingTabView.addItemViews(tabTexts, mFragments);
		
		//演示增加一个
		mAbSlidingTabView.addItemView("咖啡屋", page5);
		mAbSlidingTabView.addItemView("英雄三国", page6);
		mAbSlidingTabView.addItemView("今日新闻", page7);
		mAbSlidingTabView.addItemView("朋友圈", page8);
		
		mAbSlidingTabView.setTabPadding(20, 8, 20, 8);

```
> ## <h1 id="1902">2.FragmentLoad 每一个的Activity碎片</h1>

> ## [返回目录](#19)

每一个的Activity碎片
```

package com.andbase.demo.activity;

import java.util.ArrayList;
import java.util.List;

import android.app.Activity;
import android.os.Bundle;
import android.os.Handler;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;

import com.ab.fragment.AbFragment;
import com.ab.http.AbHttpListener;
import com.ab.http.AbRequestParams;
import com.ab.util.AbToastUtil;
import com.ab.view.pullview.AbPullToRefreshView;
import com.ab.view.pullview.AbPullToRefreshView.OnFooterLoadListener;
import com.ab.view.pullview.AbPullToRefreshView.OnHeaderRefreshListener;
import com.andbase.R;
import com.andbase.demo.adapter.ArticleListAdapter;
import com.andbase.demo.model.Article;
import com.andbase.global.MyApplication;
import com.andbase.web.NetworkWeb;


public class FragmentLoad extends AbFragment {
	
	private MyApplication application;
	private Activity mActivity = null;
	private List<Article> mList = null;
	private AbPullToRefreshView mAbPullToRefreshView = null;
	private ListView mListView = null;
	private int currentPage = 1;
	private ArticleListAdapter myListViewAdapter = null;
	private int total = 50;
	private int pageSize = 5;

	@Override
	public View onCreateContentView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) { 
		
		 mActivity = this.getActivity();
		 application = (MyApplication) mActivity.getApplication();
		
		 View view = inflater.inflate(R.layout.pull_to_refresh_list, null);
		 //获取ListView对象
         mAbPullToRefreshView = (AbPullToRefreshView)view.findViewById(R.id.mPullRefreshView);
         mListView = (ListView)view.findViewById(R.id.mListView);
        
         //设置监听器
         mAbPullToRefreshView.setOnHeaderRefreshListener(new OnHeaderRefreshListener() {
			
			@Override
			public void onHeaderRefresh(AbPullToRefreshView view) {
				refreshTask();
			}
		});
         mAbPullToRefreshView.setOnFooterLoadListener(new OnFooterLoadListener() {
			
			@Override
			public void onFooterLoad(AbPullToRefreshView view) {
				loadMoreTask();
				
			}
		});
        
         //设置进度条的样式
         mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
         mAbPullToRefreshView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
         
         //ListView数据
         mList = new ArrayList<Article>();
    	
    	 //使用自定义的Adapter
    	 myListViewAdapter = new ArticleListAdapter(mActivity, mList);
    	 mListView.setAdapter(myListViewAdapter);
    	 //item被点击事件
    	 mListView.setOnItemClickListener(new OnItemClickListener(){
			@Override
			public void onItemClick(AdapterView<?> parent, View view,
					int position, long id) {
			}
    	 });
    	 
    	 //加载数据必须
    	 this.setAbFragmentOnLoadListener(new AbFragmentOnLoadListener(){

			@Override
			public void onLoad() {
				//第一次下载数据
				refreshTask();
			}
    		 
    	 });
    	 
    	 return view;
	} 
	
	@Override
	public void setResource() {
		//设置加载的资源
		this.setLoadDrawable(R.drawable.ic_load);
		this.setLoadMessage("正在查询,请稍候");
		 
		this.setRefreshDrawable(R.drawable.ic_refresh);
		this.setRefreshMessage("请求出错，请重试");
	}

	/**
	 * 下载数据
	 */
	public void refreshTask() {
		currentPage = 1;
		// 绑定参数
		AbRequestParams params = new AbRequestParams();
		params.put("cityCode", "11");
		params.put("pageSize", String.valueOf(pageSize));
		params.put("toPageNo",String.valueOf(currentPage));
		// 下载网络数据
		NetworkWeb web = NetworkWeb.newInstance(mActivity);
		web.findLogList(params, new AbHttpListener(){

			@Override
			public void onSuccess(List<?> newList) {
				mList.clear();
				if(newList!=null && newList.size()>0){
					mList.addAll((List<Article>)newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onHeaderRefreshFinish();
				
				//模拟用，真是开发中需要直接调用run内的内容
				new Handler().postDelayed(new Runnable(){

					@Override
					public void run() {
						//显示内容
						showContentView();
					}
					
				}, 3000);
				
			}

			@Override
			public void onFailure(String content) {
				AbToastUtil.showToast(mActivity, content);
				//显示重试的框
				showRefreshView();
			}
			
		});
	}
    
    public void loadMoreTask(){
    	currentPage++;
		// 绑定参数
		AbRequestParams params = new AbRequestParams();
		params.put("cityCode", "11");
		params.put("pageSize", String.valueOf(pageSize));
		params.put("toPageNo",String.valueOf(currentPage));
    	// 下载网络数据
		NetworkWeb web = NetworkWeb.newInstance(this.getActivity());
		web.findLogList(params, new AbHttpListener(){

			@Override
			public void onSuccess(List<?> newList) {
				if(newList!=null && newList.size()>0){
					mList.addAll((List<Article>)newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onFooterLoadFinish();
			}

			@Override
			public void onFailure(String content) {
				
			}
			
		});
    }

}


```
<h1 id="2001">1.底部切换Tab</h1>

[返回目录](#20)

```
 <com.ab.view.sliding.AbBottomTabView
        android:id="@+id/mBottomTabView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent" />

private AbBottomTabView mBottomTabView;
private List<Drawable> tabDrawables = null;


AbTitleBar mAbTitleBar = this.getTitleBar();
		mAbTitleBar.setTitleText(R.string.tab_bottom_name);
		mAbTitleBar.setLogo(R.drawable.button_selector_back);
		mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
		mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
		mAbTitleBar.setLogoLine(R.drawable.line);
		initTitleRightLayout();
		
		mBottomTabView = (AbBottomTabView) findViewById(R.id.mBottomTabView);
		
		//如果里面的页面列表不能下载原因：
		//Fragment里面用的AbTaskQueue,由于有多个tab，顺序下载有延迟，还没下载好就被缓存了。改成用AbTaskPool，就ok了。
		//或者setOffscreenPageLimit(0)
		
		//缓存数量
		mBottomTabView.getViewPager().setOffscreenPageLimit(5);
		
		//禁止滑动
		/*mBottomTabView.getViewPager().setOnTouchListener(new OnTouchListener(){

			@Override
			public boolean onTouch(View v, MotionEvent event) {
				return true;
			}
			
		});*/
		
		//mBottomTabView.setOnPageChangeListener(listener);

		FragmentLoad page1 = new FragmentLoad();
		FragmentLoad page2 = new FragmentLoad();
		FragmentRefresh page3 = new FragmentRefresh();
		FragmentLoad page4 = new FragmentLoad();
		
		List<Fragment> mFragments = new ArrayList<Fragment>();
		mFragments.add(page1);
		mFragments.add(page2);
		mFragments.add(page3);
		mFragments.add(page4);
		
		List<String> tabTexts = new ArrayList<String>();
		tabTexts.add("我的音乐");
		tabTexts.add("音乐馆");
		tabTexts.add("发现");
		tabTexts.add("更多");
		
		//设置样式
		mBottomTabView.setTabTextColor(Color.BLACK);
		mBottomTabView.setTabSelectColor(Color.rgb(255, 255,255));
		mBottomTabView.setTabBackgroundResource(R.drawable.tab_bg2);
		mBottomTabView.setTabLayoutBackgroundResource(R.drawable.tablayout_bg2);
		
		//注意图片的顺序
		tabDrawables = new ArrayList<Drawable>();
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu1_n));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu1_f));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu2_n));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu2_f));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu3_n));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu3_f));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu4_n));
		tabDrawables.add(this.getResources().getDrawable(R.drawable.menu4_f));
		
		//演示增加一组
		mBottomTabView.addItemViews(tabTexts,mFragments,tabDrawables);
		
		mBottomTabView.setTabPadding(2,10, 2, 2);

```
Activity碎片
```

package com.andbase.demo.activity;

import java.util.ArrayList;
import java.util.List;

import android.app.Activity;
import android.os.Bundle;
import android.os.Handler;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;

import com.ab.fragment.AbFragment;
import com.ab.http.AbHttpListener;
import com.ab.http.AbRequestParams;
import com.ab.util.AbToastUtil;
import com.ab.view.pullview.AbPullToRefreshView;
import com.ab.view.pullview.AbPullToRefreshView.OnFooterLoadListener;
import com.ab.view.pullview.AbPullToRefreshView.OnHeaderRefreshListener;
import com.andbase.R;
import com.andbase.demo.adapter.ArticleListAdapter;
import com.andbase.demo.model.Article;
import com.andbase.global.MyApplication;
import com.andbase.web.NetworkWeb;


public class FragmentRefresh extends AbFragment {
	
	private MyApplication application;
	private Activity mActivity = null;
	private List<Article> mList = null;
	private AbPullToRefreshView mAbPullToRefreshView = null;
	private ListView mListView = null;
	private int currentPage = 1;
	private ArticleListAdapter myListViewAdapter = null;
	private int total = 50;
	private int pageSize = 5;

	@Override
	public View onCreateContentView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) { 
		
		 mActivity = this.getActivity();
		 application = (MyApplication) mActivity.getApplication();
		
		 View view = inflater.inflate(R.layout.pull_to_refresh_list, null);
		 //获取ListView对象
         mAbPullToRefreshView = (AbPullToRefreshView)view.findViewById(R.id.mPullRefreshView);
         mListView = (ListView)view.findViewById(R.id.mListView);
        
         //设置监听器
         mAbPullToRefreshView.setOnHeaderRefreshListener(new OnHeaderRefreshListener() {
			
			@Override
			public void onHeaderRefresh(AbPullToRefreshView view) {
				refreshTask();
			}
		});
         mAbPullToRefreshView.setOnFooterLoadListener(new OnFooterLoadListener() {
			
			@Override
			public void onFooterLoad(AbPullToRefreshView view) {
				loadMoreTask();
				
			}
		});
        
         //设置进度条的样式
         mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
         mAbPullToRefreshView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
         
         //ListView数据
         mList = new ArrayList<Article>();
    	
    	 //使用自定义的Adapter
    	 myListViewAdapter = new ArticleListAdapter(mActivity, mList);
    	 mListView.setAdapter(myListViewAdapter);
    	 //item被点击事件
    	 mListView.setOnItemClickListener(new OnItemClickListener(){
			@Override
			public void onItemClick(AdapterView<?> parent, View view,
					int position, long id) {
			}
    	 });
    	 
    	 //加载数据必须
    	 this.setAbFragmentOnLoadListener(new AbFragmentOnLoadListener(){

			@Override
			public void onLoad() {
				//第一次下载数据
				refreshTask();
			}
    		 
    	 });
    	 
    	 return view;
	} 
	
	@Override
	public void setResource() {
		//设置加载的资源
		this.setLoadDrawable(R.drawable.ic_load);
		this.setLoadMessage("正在查询,请稍候");
		 
		this.setRefreshDrawable(R.drawable.ic_refresh);
		this.setRefreshMessage("请求出错，请重试");
	}

	/**
	 * 下载数据
	 */
	public void refreshTask() {
		currentPage = 1;
		// 绑定参数
		AbRequestParams params = new AbRequestParams();
		params.put("cityCode", "11");
		params.put("pageSize", String.valueOf(pageSize));
		params.put("toPageNo",String.valueOf(currentPage));
		// 下载网络数据
		NetworkWeb web = NetworkWeb.newInstance(mActivity);
		web.findLogList(params, new AbHttpListener(){

			@Override
			public void onSuccess(List<?> newList) {
				mList.clear();
				if(newList!=null && newList.size()>0){
					mList.addAll((List<Article>)newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onHeaderRefreshFinish();
				
				//模拟用，真是开发中需要直接调用run内的内容
				new Handler().postDelayed(new Runnable(){

					@Override
					public void run() {
						//显示内容
						showContentView();
					}
					
				}, 3000);
				
			}

			@Override
			public void onFailure(String content) {
				AbToastUtil.showToast(mActivity, content);
				//显示重试的框
				showRefreshView();
			}
			
		});
	}
    
    public void loadMoreTask(){
    	currentPage++;
		// 绑定参数
		AbRequestParams params = new AbRequestParams();
		params.put("cityCode", "11");
		params.put("pageSize", String.valueOf(pageSize));
		params.put("toPageNo",String.valueOf(currentPage));
    	// 下载网络数据
		NetworkWeb web = NetworkWeb.newInstance(this.getActivity());
		web.findLogList(params, new AbHttpListener(){

			@Override
			public void onSuccess(List<?> newList) {
				if(newList!=null && newList.size()>0){
					mList.addAll((List<Article>)newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onFooterLoadFinish();
			}

			@Override
			public void onFailure(String content) {
				
			}
			
		});
    }

}
```
<h1 id="3201">1. XY柱图</h1>

[返回目录](#32)

数据结构
```
//数据
 List<double[]> values = new ArrayList<double[]>();

		// 第一组的数据
	    values.add(new double[] { 14230, 0, 0, 0, 15900, 17200, 12030});
	    //第二组的数据
	    values.add(new double[] { 5230, 0, 0, 0, 7900, 9200, 13030});
```
这个是实现的过程
```
 <LinearLayout
        android:id="@+id/chart01"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent"
        android:orientation="vertical" >
    </LinearLayout>



 setAbContentView(R.layout.chart);
        
        AbTitleBar mAbTitleBar = this.getTitleBar();
        mAbTitleBar.setTitleText(R.string.chart_bar);
        mAbTitleBar.setLogo(R.drawable.button_selector_back);
        mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
        mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
        mAbTitleBar.setLogoLine(R.drawable.line);
	    
        application = (MyApplication)abApplication;
        
    	//要显示图形的View
		LinearLayout linearLayout = (LinearLayout) findViewById(R.id.chart01);
		//说明文字
		String[] titles = new String[] { "第一组", "第二组" };
		//数据
	    List<double[]> values = new ArrayList<double[]>();
	    //每个数据点的颜色
	    List<int[]> colors = new ArrayList<int[]>();
	    //每个数据点的简要 说明
	    List<String[]> explains = new ArrayList<String[]>();
	    // 第一组的数据
	    values.add(new double[] { 14230, 0, 0, 0, 15900, 17200, 12030});
	    //第二组的数据
	    values.add(new double[] { 5230, 0, 0, 0, 7900, 9200, 13030});
	    
	    colors.add(new int[] { Color.RED, 0, 0, 0, 0, 0, 0});
	    colors.add(new int[] { 0, 0, Color.BLUE, 0, Color.GREEN, 0, 0});
	    
	    explains.add(new String[] { "红色", "点2", "点3", "点4", "", "点6", ""});
	    explains.add(new String[] { "没有颜色", "没有颜色", "蓝色的点\n第二行的文字\n第三行的文字", "没有颜色\n第二行的文字\n第三行的文字\n第四行的文字\n第五行的文字", "没有颜色", "没有颜色", ""});
	    
	    //柱体或者线条颜色
	    int[] mSeriescolors = new int[] { Color.rgb(153, 204, 0),Color.rgb(51, 181, 229) };
	    //创建渲染器
	    XYMultipleSeriesRenderer renderer = new XYMultipleSeriesRenderer();
	  //柱体或者线条颜色的数量
	    int length = mSeriescolors.length;
	    for (int i = 0; i < length; i++) {
	      //创建SimpleSeriesRenderer单一渲染器
	      XYSeriesRenderer r = new XYSeriesRenderer();
	      //SimpleSeriesRenderer r = new SimpleSeriesRenderer();
	      //设置渲染器颜色
	      r.setColor(mSeriescolors[i]);
	      r.setFillPoints(true);
		  r.setPointStyle(PointStyle.CIRCLE);
		  r.setLineWidth(1);
		  r.setChartValuesTextSize(16);
	      //加入到集合中
	      renderer.addSeriesRenderer(r);
	    }
	    //点的大小
	    renderer.setPointSize(2f);
	    //坐标轴标题文字大小
		renderer.setAxisTitleTextSize(16);
		//图形标题文字大小
		renderer.setChartTitleTextSize(25);
		//轴线上标签文字大小
		renderer.setLabelsTextSize(15);
		//说明文字大小
		renderer.setLegendTextSize(15);
		//图表标题
	    renderer.setChartTitle("我是图表的标题");
	    //X轴标题
	    renderer.setXTitle("X轴");
	    //Y轴标题
	    renderer.setYTitle("Y轴");
	    //X轴最小坐标点
	    renderer.setXAxisMin(0.5);
	    //X轴最大坐标点
	    renderer.setXAxisMax(7.5);
	    //Y轴最小坐标点
	    renderer.setYAxisMin(0);
	    //Y轴最大坐标点
	    renderer.setYAxisMax(24000);
	    //坐标轴颜色
	    renderer.setAxesColor(Color.rgb(51, 181, 229));
	    renderer.setXLabelsColor(Color.rgb(51, 181, 229));
	    renderer.setYLabelsColor(0,Color.rgb(51, 181, 229));
	    //设置图表上标题与X轴与Y轴的说明文字颜色
	    renderer.setLabelsColor(Color.GRAY);
	    //renderer.setGridColor(Color.GRAY);
	    //设置字体加粗
		renderer.setTextTypeface("sans_serif", Typeface.BOLD);
		//设置在图表上是否显示值标签
	    renderer.getSeriesRendererAt(0).setDisplayChartValues(true);
	    renderer.getSeriesRendererAt(1).setDisplayChartValues(true);
	    //显示屏幕可见取区的XY分割数
	    renderer.setXLabels(7);
	    renderer.setYLabels(10);
	    //X刻度标签相对X轴位置
	    renderer.setXLabelsAlign(Align.CENTER);
	    //Y刻度标签相对Y轴位置
	    renderer.setYLabelsAlign(Align.LEFT);
	    renderer.setPanEnabled(true, false);
	    renderer.setZoomEnabled(true);
	    renderer.setZoomButtonsVisible(true);
	    renderer.setZoomRate(1.1f);
	    renderer.setBarSpacing(0.5f);
	    
	    //标尺开启
	    renderer.setScaleLineEnabled(true);
	    //设置标尺提示框高
	    renderer.setScaleRectHeight(60);
	    //设置标尺提示框宽
	    renderer.setScaleRectWidth(150);
	    //设置标尺提示框背景色
	    renderer.setScaleRectColor(Color.argb(150, 52, 182, 232));
	    renderer.setScaleLineColor(Color.argb(175, 150, 150, 150));
	    renderer.setScaleCircleRadius(35);
	    //第一行文字的大小
	    renderer.setExplainTextSize1(20);
	    //第二行文字的大小
	    renderer.setExplainTextSize2(20);
	    
	    //临界线
	    double[] limit = new double[]{15000,12000,4000,9000};
	    renderer.setmYLimitsLine(limit);
	    int[] colorsLimit = new int[] { Color.rgb(100, 255,255),Color.rgb(100, 255,255),Color.rgb(0, 255, 255),Color.rgb(0, 255, 255) };
	    renderer.setmYLimitsLineColor(colorsLimit);
	    
	    //显示表格线
	    renderer.setShowGrid(true);
	    
	    //如果值是0是否要显示
	    renderer.setDisplayValue0(true);
	    //创建渲染器数据填充器
	    XYMultipleSeriesDataset mXYMultipleSeriesDataset = new XYMultipleSeriesDataset();
	    for (int i = 0; i < length; i++) {
	      CategorySeries series = new CategorySeries(titles[i]);
	      double[] v = values.get(i);
	      int[] c = colors.get(i);
	      String[] e = explains.get(i);
	      int seriesLength = v.length;
	      for (int k = 0; k < seriesLength; k++) {
	    	  //设置每个点的颜色
	          series.add(v[k],c[k],e[k]);
	      }
	      mXYMultipleSeriesDataset.addSeries(series.toXYSeries());
	    }
	    //背景
	    renderer.setApplyBackgroundColor(true);
	    renderer.setBackgroundColor(Color.rgb(222, 222, 200));
	    renderer.setMarginsColor(Color.rgb(222, 222, 200));
	    
	    //线图
	    View chart = ChartFactory.getBarChartView(this,mXYMultipleSeriesDataset,renderer,BarChart.Type.DEFAULT);
        linearLayout.addView(chart);
		
      } 
```
<h1 id="3301">1. 饼图</h1>

[返回目录](#33)

```
//要显示图形的View
		LinearLayout linearLayout = (LinearLayout) findViewById(R.id.chart01);
		
		//每个块的颜色
		int[] colors = new int[] { Color.BLUE, Color.GREEN, Color.MAGENTA, Color.YELLOW, Color.CYAN };
		//渲染器
		DefaultRenderer renderer = new DefaultRenderer();
		//图表标题
	    renderer.setChartTitle("我是图表的标题");
	    //图形标题文字大小
  		renderer.setChartTitleTextSize(25);
  		//轴线上标签文字大小
  		renderer.setLabelsTextSize(15);
  		//说明文字大小
  		renderer.setLegendTextSize(15);
  	    //设置图表上标题与X轴与Y轴的说明文字颜色
	    renderer.setLabelsColor(Color.GRAY);
		//说明文字大小
		renderer.setLegendTextSize(15);
		for (int color : colors) {
			  //创建SimpleSeriesRenderer对象  单一渲染器
		      SimpleSeriesRenderer r = new SimpleSeriesRenderer();
		      r.setColor(color);
		      renderer.addSeriesRenderer(r);
		}
		//创建数据填充器
		CategorySeries series = new CategorySeries("支出情况");
		series.add("住房", 28);
		series.add("食物", 25);
		series.add("水电", 2);
		series.add("娱乐", 20);
		series.add("服装", 25);
		
		//设置图表的背景颜色
	    renderer.setApplyBackgroundColor(true);
	    renderer.setBackgroundColor(Color.rgb(222, 222, 200));
	    //renderer.setMargins(new int[]{5,5,5,5});
		//获取图表View
	    View chart = ChartFactory.getPieChartView(this,series,renderer);
        linearLayout.addView(chart);
```
<h1 id="5301">1.图片适配的旋转木马</h1>

[返回目录](#53)

```
 <com.ab.view.carousel.CarouselImageView
        android:id="@+id/carousel"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent" />


carousel = (CarouselImageView) findViewById(R.id.carousel);
		
		List<Drawable> mDrawables = new ArrayList<Drawable>();
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon1));
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon2));
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon3));
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon4));
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon5));
		mDrawables.add(this.getResources().getDrawable(R.drawable.icon6));
		
		//不支持的动态添加dapter.notifyDataSetChanged();增强滑动的流畅
		
		CarouselImageAdapter adapter = new CarouselImageAdapter(this,mDrawables,true);
		carousel.setAdapter(adapter);
		
		carousel.setOnItemClickListener(new OnItemClickListener() {

			@Override
			public void onItemClick(CarouselAdapter<?> parent, View view,
					int position, long id) {
				AbToastUtil.showToast(CarouselImageActivity.this,"Click Position=" + position);
				
			}

		});
		
		carousel.setOnItemSelectedListener(new OnItemSelectedListener(){

			@Override
			public void onItemSelected(CarouselAdapter<?> parent, View view,
					int position, long id) {
				AbToastUtil.showToast(CarouselImageActivity.this,"Selected Position=" + position);
			}

			@Override
			public void onNothingSelected(CarouselAdapter<?> parent) {
			}
			
		});
		
```
<h1 id="5601">1.环形进度条</h1>

[返回目录](#56)

![](http://i.imgur.com/sPrlH7F.jpg)

xml布局的写法
```
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/gray_white"
    android:gravity="center" 
    android:orientation="horizontal">

    <RelativeLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="@color/gray_white"
        android:gravity="center" >
<!-- 相对布局，内容居中显示 -->
        <RelativeLayout
            android:layout_width="210dip"
            android:layout_height="210dip"
            android:layout_centerHorizontal="true"
            android:layout_centerVertical="true"
            android:background="@drawable/progress_circle_bg"
            android:clickable="true"
            android:gravity="center" >

            <TextView
                android:id="@+id/stepText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_centerHorizontal="true"
                android:text="当前"
                android:textColor="@color/gray" />
<!-- android:textStyle="bold"意思是黑体 -->
            <TextView
                android:id="@+id/numberText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@+id/stepText"
                android:layout_centerHorizontal="true"
                android:textSize="30sp"
                android:textStyle="bold" />

            <TextView
                android:id="@+id/maxText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@+id/numberText"
                android:layout_centerHorizontal="true"
                android:textColor="@color/gray" />
        </RelativeLayout>
<!-- 相对布局里相互叠加 -->
        <com.ab.view.progress.AbCircleProgressBar
            android:id="@+id/circleProgressBar"
            android:layout_width="210dip"
            android:layout_height="210dip"
            android:layout_centerHorizontal="true"
            android:layout_centerVertical="true" />
        
    </RelativeLayout>

</LinearLayout>
```

代码实现的过程
```
// ProgressBar进度控制
	private AbCircleProgressBar mAbProgressBar;
	// 最大100
	private int max = 100;	
	private int progress = 0;
	private TextView numberText, maxText;

// ProgressBar进度控制
		mAbProgressBar = (AbCircleProgressBar) findViewById(R.id.circleProgressBar);
		
		numberText = (TextView) findViewById(R.id.numberText);
		maxText = (TextView) findViewById(R.id.maxText);
		
		maxText.setText("总共  "+String.valueOf(max));
		mAbProgressBar.setMax(max);
		mAbProgressBar.setProgress(progress);

//开启进度条
		startAddProgress();
		// 进度条加入监听器
		mAbProgressBar.setAbOnProgressListener(new AbCircleProgressBar.AbOnProgressListener() {
			
			@Override
			public void onProgress(int progress) {
				
			}
			
			@Override
			public void onComplete() {
				progress = 0;
				mAbProgressBar.reset();
			}
		});



public void startAddProgress() {
		progress = progress+10;
		numberText.setText(String.valueOf(progress));
		mAbProgressBar.setProgress(progress);
		mUpdateHandler.sendEmptyMessageDelayed(1, 1000);
	}

	//每秒更新十分之一
	private Handler mUpdateHandler = new Handler() {
		public void handleMessage(Message msg) {
			switch (msg.what) {
			case 1:
				startAddProgress();
				break;
			}
			super.handleMessage(msg);
		}
	};
	
	private Runnable mUpdateRunnable = new Runnable() {
		public void run() {
			while (true) {
				Message message = new Message();
				message.what = 1;
				mUpdateHandler.sendMessage(message);
				try {
					// 更新间隔毫秒数
					Thread.sleep(200);
				} catch (InterruptedException e) {
					Thread.currentThread().interrupt();
				}
			}
		}
	};
```
<h1 id="5701">1.水平进度条</h1>

[返回目录](#57)

![](http://i.imgur.com/IvCQbxO.jpg)
xml文件
```
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/gray_white"
    android:gravity="center"
    android:orientation="vertical" 
    android:paddingTop="10dip">

    <com.ab.view.progress.AbHorizontalProgressBar
        android:id="@+id/horizontalProgressBar"
        android:layout_width="250dip"
        android:layout_height="30dip" />

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:gravity="center"
        android:orientation="horizontal" >

        <TextView
            android:id="@+id/numberText"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textColor="@color/gray"/>

        <TextView
            android:id="@+id/maxText"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textColor="@color/gray" />
    </LinearLayout>

</LinearLayout>
```
代码实现部分
```
// ProgressBar进度控制
	private AbHorizontalProgressBar mAbProgressBar;
	// 最大1000
	private int max = 100;	
	private int progress = 0;
	private TextView numberText, maxText;


// ProgressBar进度控制
		mAbProgressBar = (AbHorizontalProgressBar) findViewById(R.id.horizontalProgressBar);
		
		numberText = (TextView) findViewById(R.id.numberText);
		maxText = (TextView) findViewById(R.id.maxText);
		
		maxText.setText("/"+String.valueOf(max));
		mAbProgressBar.setMax(max);
		mAbProgressBar.setProgress(progress);
		
		mAbTitleBar.getLogoView().setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {
				finish();
			}
		});
		
		startAddProgress();
		
		mAbProgressBar.setAbOnProgressListener(new AbHorizontalProgressBar.AbOnProgressListener() {
			
			@Override
			public void onProgress(int progress) {
				
			}
			
			@Override
			public void onComplete() {
				progress = 0;
				mAbProgressBar.reset();
			}
		});


public void startAddProgress() {
		progress = progress+10;
		numberText.setText(String.valueOf(progress));
		mAbProgressBar.setProgress(progress);
		mUpdateHandler.sendEmptyMessageDelayed(1, 1000);
	}

	private Handler mUpdateHandler = new Handler() {
		public void handleMessage(Message msg) {
			switch (msg.what) {
			case 1:
				startAddProgress();
				break;
			}
			super.handleMessage(msg);
		}
	};
	
	private Runnable mUpdateRunnable = new Runnable() {
		public void run() {
			while (true) {
				Message message = new Message();
				message.what = 1;
				mUpdateHandler.sendMessage(message);
				try {
					// 更新间隔毫秒数
					Thread.sleep(200);
				} catch (InterruptedException e) {
					Thread.currentThread().interrupt();
				}
			}
		}
	};
```
<h1 id="6001">1.硬币翻转</h1>

[返回目录](#60)

xml定义布局
```
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/white"
    android:gravity="center" >
<!-- 硬币的两面分别放在两个相对布局中，两个相对布局又放在同一个帧布局中。 -->
    <FrameLayout
        android:id="@+id/container"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:gravity="center" >

        <RelativeLayout
            android:id="@+id/layout01"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" 
            android:gravity="center">

            <ImageView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:scaleType="matrix"
                android:src="@drawable/yuan1_z" >
            </ImageView>
        </RelativeLayout>

        <RelativeLayout
            android:id="@+id/layout02"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" 
            android:gravity="center"
            android:visibility="gone">

            <ImageView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:scaleType="matrix"
                android:src="@drawable/yuan1_f" >
            </ImageView>
        </RelativeLayout>
    </FrameLayout>

</RelativeLayout>
```
代码实现过程
```
private ViewGroup mContainer = null;
private RelativeLayout mRelativeLayout01,mRelativeLayout02;


//帧布局是容器
		mContainer = (ViewGroup) findViewById(R.id.container);
		// Since we are caching large views, we want to keep their cache
        // between each animation
		//PERSISTENT_ANIMATION_CACHE 说明只保存动画绘图缓存；
        mContainer.setPersistentDrawingCache(ViewGroup.PERSISTENT_ANIMATION_CACHE);
        
        mRelativeLayout01 = (RelativeLayout) findViewById(R.id.layout01);
        mRelativeLayout02 = (RelativeLayout) findViewById(R.id.layout02);
				
				
		mRelativeLayout01.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View arg0) {
				applyRotation(0,0,90);
			}
		});
		
        mRelativeLayout02.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View arg0) {
				applyRotation(-1, 180, 90);
			}
		});




/**
     * Setup a new 3D rotation on the container view.
     *
     * @param position the item that was clicked to show a picture, or -1 to show the list
     * @param start the start angle at which the rotation must begin
     * @param end the end angle of the rotation
     */
    private void applyRotation(int position, float start, float end) {
        // Find the center of the container f表明是float类型
        final float centerX = mContainer.getWidth() / 2.0f;
        final float centerY = mContainer.getHeight() / 2.0f;

        // Create a new 3D rotation with the supplied parameter
        // The animation listener is used to trigger the next animation
       //从270到360度，顺时针旋转视图，此时reverse参数为false，达到360度动画结束时视图变得可见
		 final AbRotate3dAnimation rotation =
                new AbRotate3dAnimation(start, end, centerX, centerY, 310.0f, true);
        rotation.setDuration(500);
        rotation.setFillAfter(true);
        //中间的差值
        rotation.setInterpolator(new AccelerateInterpolator());
        //加入对动画的监听
        rotation.setAnimationListener(new DisplayNextView(position));

        mContainer.startAnimation(rotation);
    }
    
    /**这个是动画监听器
     * 这个类监听动画的上半部分结束。然后，当容器旋转90度，从而不可见时，
     * 它将发布一个新的操作，有效地交换视图。
     * This class listens for the end of the first half of the animation.
     * It then posts a new action that effectively swaps the views when the container
     * is rotated 90 degrees and thus invisible.
     */
    private final class DisplayNextView implements Animation.AnimationListener {
        private final int mPosition;

        private DisplayNextView(int position) {
            mPosition = position;
        }

        public void onAnimationStart(Animation animation) {
        }

        public void onAnimationEnd(Animation animation) {
            mContainer.post(new SwapViews(mPosition));
        }

        public void onAnimationRepeat(Animation animation) {
        }
    }

    /**这个类负责交换视图并启动动画的下半部分。
     * This class is responsible for swapping the views and start the second
     * half of the animation.
     */
    private final class SwapViews implements Runnable {
        private final int mPosition;

        public SwapViews(int position) {
            mPosition = position;
        }

        public void run() {
            final float centerX = mContainer.getWidth() / 2.0f;
            final float centerY = mContainer.getHeight() / 2.0f;
            AbRotate3dAnimation rotation;
            
            if (mPosition > -1) {
            	mRelativeLayout01.setVisibility(View.GONE);
            	mRelativeLayout02.setVisibility(View.VISIBLE);

                rotation = new AbRotate3dAnimation(90,180, centerX, centerY, 310.0f, false);
            } else {
            	mRelativeLayout02.setVisibility(View.GONE);
            	mRelativeLayout01.setVisibility(View.VISIBLE);
                rotation = new AbRotate3dAnimation(90, 0, centerX, centerY, 310.0f, false);
            }

            rotation.setDuration(500);
            rotation.setFillAfter(true);
            rotation.setInterpolator(new DecelerateInterpolator());

            mContainer.startAnimation(rotation);
        }
    }
```
<h1 id="7601">1.ListView与ViewPager组合</h1>

[返回目录](#76)

xml文档是
```
<?xml version="1.0" encoding="utf-8"?>
<com.ab.view.pullview.AbPullToRefreshView 
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/mPullRefreshView"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:background="@color/gray_white">

    <ListView
        android:id="@+id/mListView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent"
        android:cacheColorHint="#00000000"
        android:divider="@drawable/list_divider"
        android:dividerHeight="1px" />

</com.ab.view.pullview.AbPullToRefreshView>
```
代码的实现是
```
package com.andbase.demo.activity;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;

import android.os.Bundle;
import android.view.Gravity;
import android.view.View;
import android.view.ViewGroup.LayoutParams;
import android.widget.AbsListView;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;

import com.ab.activity.AbActivity;
import com.ab.task.AbTask;
import com.ab.task.AbTaskItem;
import com.ab.task.AbTaskListener;
import com.ab.util.AbDialogUtil;
import com.ab.util.AbToastUtil;
import com.ab.view.pullview.AbPullToRefreshView;
import com.ab.view.pullview.AbPullToRefreshView.OnFooterLoadListener;
import com.ab.view.pullview.AbPullToRefreshView.OnHeaderRefreshListener;
import com.ab.view.sliding.AbSlidingPlayView;
import com.ab.view.titlebar.AbTitleBar;
import com.andbase.R;
import com.andbase.demo.adapter.ImageListAdapter;
import com.andbase.global.Constant;
import com.andbase.global.MyApplication;

public class ListNestViewPagerActivity extends AbActivity implements OnHeaderRefreshListener,OnFooterLoadListener{
	
	private MyApplication application;
	private List<Map<String, Object>> list = null;
	private List<Map<String, Object>> newList = null;
	private AbPullToRefreshView mAbPullToRefreshView = null;
	private ListView mListView = null;
	private int currentPage = 1;
	private ArrayList<String> mPhotoList = new ArrayList<String>();
	private AbTitleBar mAbTitleBar = null;
	private ImageListAdapter myListViewAdapter = null;
	private AbSlidingPlayView mSlidingPlayView = null;
    
	@Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setAbContentView(R.layout.pull_to_refresh_list);
        application = (MyApplication)abApplication;
        
        mAbTitleBar = this.getTitleBar();
        mAbTitleBar.setTitleText(R.string.list_pager_name);
        mAbTitleBar.setLogo(R.drawable.button_selector_back);
        mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
        mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
        mAbTitleBar.setLogoLine(R.drawable.line);
        
        for (int i = 0; i < 23; i++) {
        	mPhotoList.add(Constant.BASEURL+"content/templates/amsoft/images/rand/"+i+".jpg");
		}
		//获取ListView对象
        mAbPullToRefreshView = (AbPullToRefreshView)this.findViewById(R.id.mPullRefreshView);
        mListView = (ListView)this.findViewById(R.id.mListView);
        
        //设置监听器
        mAbPullToRefreshView.setOnHeaderRefreshListener(this);
        mAbPullToRefreshView.setOnFooterLoadListener(this);
        
        //设置进度条的样式
        mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        mAbPullToRefreshView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        //mAbPullListView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular2));
        //mAbPullListView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular2));
        
        //ListView数据
    	list = new ArrayList<Map<String, Object>>();
    	
    	//使用自定义的Adapter
    	myListViewAdapter = new ImageListAdapter(this, list,R.layout.item_list,
				new String[] { "itemsIcon", "itemsTitle","itemsText" }, new int[] { R.id.itemsIcon,
						R.id.itemsTitle,R.id.itemsText });
    	
    	//item被点击事件
    	mListView.setOnItemClickListener(new OnItemClickListener(){
			@Override
			public void onItemClick(AdapterView<?> parent, View view,
					int position, long id) {
			}
    	});
    	
		//组和个AbSlidingPlayView
        mSlidingPlayView = new AbSlidingPlayView(this);
        
	    final View mPlayView = mInflater.inflate(R.layout.play_view_item, null);
		ImageView mPlayImage = (ImageView) mPlayView.findViewById(R.id.mPlayImage);
		TextView mPlayText = (TextView) mPlayView.findViewById(R.id.mPlayText);
		mPlayText.setText("1111111111111");
		mPlayImage.setBackgroundResource(R.drawable.pic1);
		
		final View mPlayView1 = mInflater.inflate(R.layout.play_view_item, null);
		ImageView mPlayImage1 = (ImageView) mPlayView1.findViewById(R.id.mPlayImage);
		TextView mPlayText1 = (TextView) mPlayView1.findViewById(R.id.mPlayText);
		mPlayText1.setText("2222222222222");
		mPlayImage1.setBackgroundResource(R.drawable.pic2);
		
		final View mPlayView2 = mInflater.inflate(R.layout.play_view_item, null);
		ImageView mPlayImage2 = (ImageView) mPlayView2.findViewById(R.id.mPlayImage);
		TextView mPlayText2 = (TextView) mPlayView2.findViewById(R.id.mPlayText);
		mPlayText2.setText("33333333333333333");
		mPlayImage2.setBackgroundResource(R.drawable.pic3);

		mSlidingPlayView.setNavHorizontalGravity(Gravity.RIGHT);
		mSlidingPlayView.addView(mPlayView);
		mSlidingPlayView.addView(mPlayView1);
		mSlidingPlayView.addView(mPlayView2);
		mSlidingPlayView.startPlay();
		//设置高度
		mSlidingPlayView.setLayoutParams(new AbsListView.LayoutParams(LayoutParams.FILL_PARENT,300));
		mListView.addHeaderView(mSlidingPlayView);
		//解决冲突问题
		mSlidingPlayView.setParentListView(mListView);
		mSlidingPlayView.setOnItemClickListener(new AbSlidingPlayView.AbOnItemClickListener() {
			
			@Override
			public void onClick(int position) {
				AbToastUtil.showToast(ListNestViewPagerActivity.this,"点击"+position);
			}
		});
	    
        mSlidingPlayView.setOnPageChangeListener(new AbSlidingPlayView.AbOnChangeListener() {
			
			@Override
			public void onChange(int position) {
				AbToastUtil.showToast(ListNestViewPagerActivity.this,"改变"+position);
			}
		});
        
        mListView.setAdapter(myListViewAdapter);
        
        AbDialogUtil.showProgressDialog(ListNestViewPagerActivity.this,R.drawable.progress_circular,"正在查询...");

    	//第一次下载数据
    	refreshTask();
    }
    

	@Override
	protected void onResume() {
		super.onResume();
	}
	
	public void onPause() {
		super.onPause();
	}
	
	@Override
	public void finish() {
		mSlidingPlayView.stopPlay();
		super.finish();
	}
   
	//动态获得数据
	public void refreshTask(){
        AbTask mAbTask = new AbTask();
    	AbTaskItem item = new AbTaskItem();
    	item.setListener(new AbTaskListener() {
//修改数据
			@Override
			public void update() {
				AbDialogUtil.removeDialog(ListNestViewPagerActivity.this);
				list.clear();
				if(newList!=null && newList.size()>0){
	                list.addAll(newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onHeaderRefreshFinish();
			}
//获得数据
			@Override
			public void get() {
	   		    try {
	   		    	Thread.sleep(1000);
	   		    	currentPage = 1;
	   		    	//list中是map的集合
	   		    	newList = new ArrayList<Map<String, Object>>();
	   		    	Map<String, Object> map = null;
	   		    	//map中包含list
	   		    	for (int i = 0; i < 10; i++) {
	   		    		map = new HashMap<String, Object>();
	   					map.put("itemsIcon",mPhotoList.get(i));
		   		    	map.put("itemsTitle", "item"+i);
		   		    	map.put("itemsText", "item..."+i);
		   		    	newList.add(map);
	   				}
	   		    } catch (Exception e) {
	   		    }
		  };
		});
        
        mAbTask.execute(item);
    }
    
    public void loadMoreTask(){
    	
        AbTask mAbTask = new AbTask();
        AbTaskItem item = new AbTaskItem();
        item.setListener(new AbTaskListener() {

			@Override
			public void update() {
//				list上次的数据不清楚
				if(newList!=null && newList.size()>0){
					list.addAll(newList);
					myListViewAdapter.notifyDataSetChanged();
					newList.clear();
                }
				mAbPullToRefreshView.onFooterLoadFinish();
			}

			@Override
			public void get() {
	   		    try {
	   		    	currentPage++;
	   		    	Thread.sleep(1000);
	   		    	newList = new ArrayList<Map<String, Object>>();
	   		    	Map<String, Object> map = null;
	   		    	
	   		    	for (int i = 0; i < 10; i++) {
	   		    		map = new HashMap<String, Object>();
	   					map.put("itemsIcon",mPhotoList.get(new Random().nextInt(mPhotoList.size())));
		   		    	map.put("itemsTitle", "item上拉"+i);
		   		    	map.put("itemsText", "item上拉..."+i);
		   		    	newList.add(map);
	   				}
	   		    	
	   		    } catch (Exception e) {
	   		    	currentPage--;
	   		    	newList.clear();
	   		    	AbToastUtil.showToastInThread(ListNestViewPagerActivity.this,e.getMessage());
	   		    }
		  };
		});
        
        mAbTask.execute(item);
    }
    
    @Override
    public void onFooterLoad(AbPullToRefreshView view) {
	    loadMoreTask();
    }
	
    @Override
    public void onHeaderRefresh(AbPullToRefreshView view) {
        refreshTask();
        
    }
}

```
<h1 id="7701">1.ListView与ViewPager组合</h1>

[返回目录](#77)

```
package com.andbase.demo.activity;

import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;

import com.ab.activity.AbActivity;
import com.ab.view.slidingmenu.SlidingMenu;
import com.ab.view.titlebar.AbTitleBar;
import com.andbase.R;
/**
 * 
 * © 2012 amsoft.cn
 * 名称：SlidingMenuNestViewPagerActivity.java 
 * 描述：SlidingMenu+ViewPager冲突解决的演示
 * @author 还如一梦中
 * @date：2013-10-25 上午9:15:58
 * @version v1.0
 */
public class SlidingMenuNestViewPagerActivity extends AbActivity {

	private SlidingMenu menu;

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setAbContentView(R.layout.sliding_menu_content);
		
		AbTitleBar mAbTitleBar = this.getTitleBar();
		mAbTitleBar.setTitleText(R.string.sliding_menu_pager_name);
		mAbTitleBar.setLogo(R.drawable.button_selector_back);
		mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
		mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
		mAbTitleBar.setLogoLine(R.drawable.line);
		mAbTitleBar.getLogoView().setBackgroundResource(R.drawable.button_selector_menu);
		
        //主视图的Fragment添加
		getFragmentManager()
		.beginTransaction()
		.replace(R.id.content_frame, new FragmentLoad())
		.commit();

		//SlidingMenu的配置
		menu = new SlidingMenu(this);
		menu.setMode(SlidingMenu.LEFT);
		
		//slidingmenu的事件模式，如果里面有可以滑动的请用TOUCHMODE_MARGIN
		//可解决事件冲突问题
		menu.setTouchModeAbove(SlidingMenu.TOUCHMODE_MARGIN);		
		menu.setShadowWidthRes(R.dimen.shadow_width);
		//渐变的背景
		menu.setShadowDrawable(R.drawable.shadow);
		//偏移的距离
		menu.setBehindOffsetRes(R.dimen.slidingmenu_offset);
		menu.setFadeDegree(0.35f);
		menu.attachToActivity(this, SlidingMenu.SLIDING_CONTENT);
		
		//menu视图的Fragment添加
		menu.setMenu(R.layout.sliding_menu_menu);
		getFragmentManager()
		.beginTransaction()
		.replace(R.id.menu_frame, new FragmentLoad())
		.commit();
		
		mAbTitleBar.getLogoView().setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View arg0) {
				if (menu.isMenuShowing()) {
 					menu.showContent();
 				} else {
 					menu.showMenu();
 				}
			}
		});
	}

	@Override
	public void onBackPressed() {
		if (menu.isMenuShowing()) {
			menu.showContent();
		} else {
			super.onBackPressed();
		}
	}

}

```
<h1 id="10601">1.各种集合框架</h1>

[返回目录](#106)

```
111
```
<h1 id="10602">2.进度条</h1>

[返回目录](#106)

```
//设置进度条的样式
        mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
       
从0到360度 200秒 差值 重复
<?xml version="1.0" encoding="utf-8"?>
<animated-rotate xmlns:android="http://schemas.android.com/apk/res/android"
    android:duration="200"
    android:fromDegrees="0.0"
    android:interpolator="@android:anim/accelerate_decelerate_interpolator"
    android:pivotX="50.0%"
    android:pivotY="50.0%"
    android:repeatMode="restart"
    android:toDegrees="360.0" 
    android:drawable="@drawable/progress_loading2">
</animated-rotate>
```
<h1 id="10603">3.土司</h1>

[返回目录](#106)

```
AbToastUtil.showToast(ListNestViewPagerActivity.this,"点击"+position);
```
<h1 id="10604">4.容器的运用list与map相互嵌套 动态获得数据</h1>

[返回目录](#106)

```
private List<Map<String, Object>> list = null;
	private List<Map<String, Object>> newList = null;


//使用自定义的Adapter  把数据list放入adapter中
    	myListViewAdapter = new ImageListAdapter(this, list,R.layout.item_list,
				new String[] { "itemsIcon", "itemsTitle","itemsText" }, new int[] { R.id.itemsIcon,
						R.id.itemsTitle,R.id.itemsText });

	//动态获得数据
	public void refreshTask(){
        AbTask mAbTask = new AbTask();
    	AbTaskItem item = new AbTaskItem();
    	item.setListener(new AbTaskListener() {
//修改数据
			@Override
			public void update() {
				AbDialogUtil.removeDialog(ListNestViewPagerActivity.this);
				list.clear();
				if(newList!=null && newList.size()>0){
	                list.addAll(newList);
	                myListViewAdapter.notifyDataSetChanged();
	                newList.clear();
   		    	}
				mAbPullToRefreshView.onHeaderRefreshFinish();
			}
//获得数据
			@Override
			public void get() {
	   		    try {
	   		    	Thread.sleep(1000);
	   		    	currentPage = 1;
	   		    	//list中是map的集合
	   		    	newList = new ArrayList<Map<String, Object>>();
	   		    	Map<String, Object> map = null;
	   		    	//map中包含list
	   		    	for (int i = 0; i < 10; i++) {
	   		    		map = new HashMap<String, Object>();
	   					map.put("itemsIcon",mPhotoList.get(i));
		   		    	map.put("itemsTitle", "item"+i);
		   		    	map.put("itemsText", "item..."+i);
		   		    	newList.add(map);
	   				}
	   		    } catch (Exception e) {
	   		    }
		  };
		});
        
        mAbTask.execute(item);
    }


//获取该行的数据
          final Map<String, Object>  obj = (Map<String, Object>)mData.get(position);
          String imageUrl = (String)obj.get("itemsIcon");
          itemsTitle.setText((String)obj.get("itemsTitle"));
          itemsText.setText((String)obj.get("itemsText"));
```
<h1 id="10605">5.图片下载器</h1>

[返回目录](#106)

```
//图片下载器
    private AbImageLoader mAbImageLoader = null;

 //图片下载器
        mAbImageLoader = new AbImageLoader(mContext);
        mAbImageLoader.setMaxWidth(150);
        mAbImageLoader.setMaxHeight(150);
        mAbImageLoader.setLoadingImage(R.drawable.image_loading);
        mAbImageLoader.setErrorImage(R.drawable.image_error);
        mAbImageLoader.setEmptyImage(R.drawable.image_empty);

//设置加载中的View
          mAbImageLoader.setLoadingView(convertView.findViewById(R.id.progressBar));
          //图片的下载
          mAbImageLoader.display(itemsIcon,imageUrl);
```
<h1 id="7901">1.圆形挂钟</h1>

[返回目录](#79)

自定义模拟时钟

```
/*
 * Copyright (C) 2012 www.amsoft.cn
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.ab.view.app;

import java.util.TimeZone;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.graphics.Canvas;
import android.graphics.drawable.Drawable;
import android.os.Handler;
import android.text.format.DateUtils;
import android.text.format.Time;
import android.view.View;

import com.ab.util.AbLogUtil;

// TODO: Auto-generated Javadoc
/**
 * © 2012 amsoft.cn
 * 名称：AbAnalogClock.java 
 * 描述：自定义模拟时钟
 *
 * @author 还如一梦中
 * @version v1.0
 * @date：2013-11-6 上午9:13:49
 */
public class AbAnalogClock extends View {
	
	/** The m calendar. */
	private Time mCalendar;

	//时针图标
	/** The m hour hand. */
	private Drawable mHourHand;
	
	//分针图标
	/** The m minute hand. */
	private Drawable mMinuteHand;
	
	//秒针图标
	/** The m second hand. */
	private Drawable mSecondHand;
		
	//表盘图标
	/** The m dial. */
	private Drawable mDial;

	//表盘图片的大小 宽和高
	/** The m dial width. */
	private int mDialWidth;
	
	/** The m dial height. */
	private int mDialHeight;

	/** The m attached. */
	private boolean mAttached;
	
	//当前时间
	/** The m minutes. */
	private float mMinutes;
	
	/** The m hour. */
	private float mHour;
	
	/** The m second. */
	private float mSecond;
	
	/** The m handler. */
	private final Handler mHandler = new Handler();
	
	/** The m changed. */
	private boolean mChanged;

	/**
	 * Instantiates a new ab analog clock.
	 *通过构造器来传递图片
	 * @param context the context
	 * @param dial the dial
	 * @param hourHand the hour hand
	 * @param minuteHand the minute hand
	 * @param secondHand the second hand
	 */
	public AbAnalogClock(Context context, Drawable dial, Drawable hourHand,
			Drawable minuteHand,Drawable secondHand) {
		super(context);
		
		mDial = dial;
		mHourHand = hourHand;
		mMinuteHand = minuteHand;
		mSecondHand = secondHand;

		mCalendar = new Time();

		mDialWidth = mDial.getIntrinsicWidth();
		mDialHeight = mDial.getIntrinsicHeight();
	}

	/* (non-Javadoc)
	 * @see android.view.View#onAttachedToWindow()
	 */
	@Override
	protected void onAttachedToWindow() {
		super.onAttachedToWindow();

		if (!mAttached) {
			mAttached = true;
//意图过滤器
			IntentFilter filter = new IntentFilter();

			filter.addAction(Intent.ACTION_TIME_TICK);
			filter.addAction(Intent.ACTION_TIME_CHANGED);
			filter.addAction(Intent.ACTION_TIMEZONE_CHANGED);
//注册广播 意图 和mHandler
			getContext().registerReceiver(mIntentReceiver, filter, null,mHandler);
		}

		// NOTE: It's safe to do these after registering the receiver since the
		// receiver always runs
		// in the main thread, therefore the receiver can't run before this
		// method returns.

		// The time zone may have changed while the receiver wasn't registered,
		// so update the Time
		mCalendar = new Time();

		// 更新当前时间每秒调用一次
		onTimeChanged();
		
	}

	/* (non-Javadoc)
	 * @see android.view.View#onDetachedFromWindow()
	 */
	@Override
	protected void onDetachedFromWindow() {
		super.onDetachedFromWindow();
		if (mAttached) {
			getContext().unregisterReceiver(mIntentReceiver);
			mAttached = false;
		}
	}

	/* (non-Javadoc)
	 * @see android.view.View#onMeasure(int, int)
	 */
	@Override
	protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {

		int widthMode = MeasureSpec.getMode(widthMeasureSpec);
		int widthSize = MeasureSpec.getSize(widthMeasureSpec);
		int heightMode = MeasureSpec.getMode(heightMeasureSpec);
		int heightSize = MeasureSpec.getSize(heightMeasureSpec);

		float hScale = 1.0f;
		float vScale = 1.0f;

		if (widthMode != MeasureSpec.UNSPECIFIED && widthSize < mDialWidth) {
			hScale = (float) widthSize / (float) mDialWidth;
		}

		if (heightMode != MeasureSpec.UNSPECIFIED && heightSize < mDialHeight) {
			vScale = (float) heightSize / (float) mDialHeight;
		}

		float scale = Math.min(hScale, vScale);

		setMeasuredDimension(mDialWidth * (int)scale,mDialHeight * (int)scale);
	}

	/* (non-Javadoc)
	 * @see android.view.View#onSizeChanged(int, int, int, int)
	 */
	@Override
	protected void onSizeChanged(int w, int h, int oldw, int oldh) {
		super.onSizeChanged(w, h, oldw, oldh);
		mChanged = true;
	}

	/* (non-Javadoc)
	 * @see android.view.View#onDraw(android.graphics.Canvas)
	 */
	@Override
	protected void onDraw(Canvas canvas) {
		super.onDraw(canvas);

		boolean changed = mChanged;
		if (changed) {
			mChanged = false;
		}

		int availableWidth = getRight() - getLeft();
		int availableHeight = getBottom() - getTop();

		int x = availableWidth / 2;
		int y = availableHeight / 2;

		final Drawable dial = mDial;
		int w = dial.getIntrinsicWidth();
		int h = dial.getIntrinsicHeight();

		boolean scaled = false;

		if (availableWidth < w || availableHeight < h) {
			scaled = true;
			float scale = Math.min((float) availableWidth / (float) w,
					(float) availableHeight / (float) h);
			canvas.save();
			canvas.scale(scale, scale, x, y);
		}

		if (changed) {
			dial.setBounds(x - (w / 2), y - (h / 2), x + (w / 2), y + (h / 2));
		}
		dial.draw(canvas);

		//时针
		canvas.save();
		canvas.rotate(mHour / 12.0f * 360.0f, x, y);
		final Drawable hourHand = mHourHand;
		if (changed) {
			w = hourHand.getIntrinsicWidth();
			h = hourHand.getIntrinsicHeight();
			hourHand.setBounds(x - (w / 2), y - (h / 2), x + (w / 2), y
					+ (h / 2));
		}
		hourHand.draw(canvas);
		canvas.restore();

		//分针
		canvas.save();
		canvas.rotate(mMinutes / 60.0f * 360.0f, x, y);

		final Drawable minuteHand = mMinuteHand;
		if (changed) {
			w = minuteHand.getIntrinsicWidth();
			h = minuteHand.getIntrinsicHeight();
			minuteHand.setBounds(x - (w / 2), y - (h / 2), x + (w / 2), y
					+ (h / 2));
		}
		minuteHand.draw(canvas);
		canvas.restore();
		
		//秒针
		canvas.save();
		canvas.rotate(mSecond / 60.0f * 360.0f, x, y);

		final Drawable secondHand = mSecondHand;
		if (changed) {
			w = secondHand.getIntrinsicWidth();
			h = secondHand.getIntrinsicHeight();
			secondHand.setBounds(x - (w / 2), y - (h / 2), x + (w / 2), y
					+ (h / 2));
		}
		secondHand.draw(canvas);
		canvas.restore();

		if (scaled) {
			canvas.restore();
		}
	}

	/**
	 * On time changed.
	 */
	private void onTimeChanged() {
		mCalendar.setToNow();

		int hour = mCalendar.hour;
		int minute = mCalendar.minute;
		int second = mCalendar.second;
		mSecond =  second;
		mMinutes = minute + second / 60.0f;
		mHour = hour + mMinutes / 60.0f;
		mChanged = true;
		AbLogUtil.d(AbAnalogClock.class, "时间改变:mHour:"+mHour+",mMinutes:"+mMinutes+",mSecond:"+mSecond);
		updateContentDescription(mCalendar);
        new Handler().postDelayed(new Runnable() {
			
			@Override
			public void run() {
				onTimeChanged();
			}
		}, 1000);
        invalidate();
	}

	/** The m intent receiver. */
	private final BroadcastReceiver mIntentReceiver = new BroadcastReceiver() {
		@Override
		public void onReceive(Context context, Intent intent) {
			if (intent.getAction().equals(Intent.ACTION_TIMEZONE_CHANGED)) {
				String tz = intent.getStringExtra("time-zone");
				mCalendar = new Time(TimeZone.getTimeZone(tz).getID());
			}
		}
	};

	/**
	 * Update content description.
	 *
	 * @param time the time
	 */
	private void updateContentDescription(Time time) {
		final int flags = DateUtils.FORMAT_SHOW_TIME | DateUtils.FORMAT_24HOUR;
		String contentDescription = DateUtils.formatDateTime(getContext(),
				time.toMillis(false), flags);
		setContentDescription(contentDescription);
	}
}

```
实现的代码
```
    这个是表壳 时分秒
		Drawable dial = this.getResources().getDrawable(R.drawable.clock_dial);
		Drawable hourHand = this.getResources().getDrawable(R.drawable.clock_hour);
		Drawable minuteHand = this.getResources().getDrawable(R.drawable.clock_minute);
		Drawable secondHand = this.getResources().getDrawable(R.drawable.clock_second);
		AbAnalogClock view = new AbAnalogClock(this, dial, hourHand, minuteHand,secondHand);
        
		LinearLayout contentLayout = (LinearLayout)this.findViewById(R.id.contentLayout);
		contentLayout.addView(view);
```
<h1 id="8001">1.数字时钟</h1>

[返回目录](#80)

自定义的view控件
```
package codewarehouse.yzkj.com.ceshi;

/*
 * Copyright (C) 2012 www.amsoft.cn
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


        import java.util.List;
        import java.util.TimeZone;

        import com.ab.util.AbStrUtil;

        import android.content.BroadcastReceiver;
        import android.content.Context;
        import android.content.Intent;
        import android.content.IntentFilter;
        import android.graphics.Canvas;
        import android.graphics.drawable.Drawable;
        import android.os.Handler;
        import android.text.format.DateUtils;
        import android.text.format.Time;
        import android.view.View;

// TODO: Auto-generated Javadoc
/**
 * © 2012 amsoft.cn
 * 名称：AbNumberClock.java
 * 描述：自定义数字时钟的view
 *
 * @author 还如一梦中
 * @version v1.0
 * @date：2013-11-6 上午10:19:42
 */
public class AbNumberClock extends View {

    /** The m calendar. */
    private Time mCalendar;

    /** The m time bg. */
    private Drawable mTimeBg;

    /** The m time colon. */
    private Drawable mTimeColon;

    /** The d time bmp. */
    private List<Drawable> dTimeBmp;

    /** The d apm bmp. */
    private List<Drawable> dApmBmp;

    /** The m time bg width. */
    private int mTimeBgWidth;

    /** The m time bg height. */
    private int mTimeBgHeight;

    /** The m attached. */
    private boolean mAttached;

    /** The m handler. */
    private final Handler mHandler = new Handler();

    /** The m minutes. */
    private String mMinutes;

    /** The m hour. */
    private String mHour;

    /** The m second. */
    private String mSecond;

    /**
     * Instantiates a new ab number clock.
     *  这个是构造器
     * @param context the context
     * @param timeBg the time bg
     * @param timeColon the time colon
     * @param timeBmp the time bmp
     * @param apmBmp the apm bmp
     */
    public AbNumberClock(Context context, Drawable timeBg, Drawable timeColon,
                         List<Drawable> timeBmp, List<Drawable> apmBmp) {
        super(context);

        mTimeBg = timeBg;
        mTimeColon = timeColon;
        dTimeBmp = timeBmp;
        dApmBmp = apmBmp;

        mCalendar = new Time();
//宽度是2个分隔符和6个数字和上下午的标志的宽度的和
        if (!dApmBmp.isEmpty() && dApmBmp.size() > 0) {
            mTimeBgWidth = 2 * mTimeColon.getIntrinsicWidth() + 6
                    * dTimeBmp.get(0).getIntrinsicWidth()
                    + dApmBmp.get(0).getIntrinsicWidth();
            mTimeBgHeight =  dTimeBmp.get(0).getIntrinsicHeight();
        } else {
            mTimeBgWidth = 2 * mTimeColon.getIntrinsicWidth() + 8
                    * dTimeBmp.get(0).getIntrinsicWidth();
            mTimeBgHeight = dTimeBmp.get(0).getIntrinsicHeight();
        }
    }

    /* (non-Javadoc)
    当把组件放入某个窗口时触发该方法
     * @see android.view.View#onAttachedToWindow()
     */
    @Override
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();

        if (!mAttached) {
            mAttached = true;
            //意图过滤器 过滤三个动作
            IntentFilter filter = new IntentFilter();

            filter.addAction(Intent.ACTION_TIME_TICK);
            filter.addAction(Intent.ACTION_TIME_CHANGED);
            filter.addAction(Intent.ACTION_TIMEZONE_CHANGED);

            getContext().registerReceiver(mIntentReceiver, filter, null,mHandler);
        }

        // NOTE: It's safe to do these after registering the receiver since the
        // receiver always runs
        // in the main thread, therefore the receiver can't run before this
        // method returns.

        // The time zone may have changed while the receiver wasn't registered,
        // so update the Time
        mCalendar = new Time();

        // Make sure we update to the current time
        onTimeChanged();
    }

    /* (non-Javadoc)
    当把该组件从某个窗口分离时触发该方法
     * @see android.view.View#onDetachedFromWindow()
     */
    @Override
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
        if (mAttached) {
            getContext().unregisterReceiver(mIntentReceiver);
            mAttached = false;
        }
    }

    /* (non-Javadoc)
    用来检测view组件和它包含的所有子组件的大小
     * @see android.view.View#onMeasure(int, int)
     */
    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {

        int widthMode = MeasureSpec.getMode(widthMeasureSpec);
        int widthSize = MeasureSpec.getSize(widthMeasureSpec);
        int heightMode = MeasureSpec.getMode(heightMeasureSpec);
        int heightSize = MeasureSpec.getSize(heightMeasureSpec);

        float hScale = 1.0f;
        float vScale = 1.0f;

        if (widthMode != MeasureSpec.UNSPECIFIED && widthSize < mTimeBgWidth) {
            hScale = (float) widthSize / (float) mTimeBgWidth;
        }

        if (heightMode != MeasureSpec.UNSPECIFIED && heightSize < mTimeBgHeight) {
            vScale = (float) heightSize / (float) mTimeBgHeight;
        }

        float scale = Math.min(hScale, vScale);
        setMeasuredDimension(mTimeBgWidth * (int)scale,mTimeBgHeight * (int)scale);

		/*setMeasuredDimension(
				resolveSizeAndState((int) (mTimeBgWidth * scale),widthMeasureSpec, 0),
				resolveSizeAndState((int) (mTimeBgHeight * scale),heightMeasureSpec, 0));*/
    }

    /* (non-Javadoc)
    当该组件的大小被改变时，回调该方法
     * @see android.view.View#onSizeChanged(int, int, int, int)
     */
    @Override
    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
        super.onSizeChanged(w, h, oldw, oldh);
    }

    /* (non-Javadoc)
     * @see android.view.View#onDraw(android.graphics.Canvas)
     */
    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);

        int availableWidth = getRight() - getLeft();
        int availableHeight = getBottom() - getTop();

        int x = availableWidth / 2;
        int y = availableHeight / 2;
        int w = 0;
        int h = 0;

        if (!dApmBmp.isEmpty() && dApmBmp.size() > 0) {
            w = 2*mTimeColon.getIntrinsicWidth() + 8
                    * dTimeBmp.get(0).getIntrinsicWidth()
                    + dApmBmp.get(0).getIntrinsicWidth();
            h = dTimeBmp.get(0).getIntrinsicHeight();
        } else {
            w = 2*mTimeColon.getIntrinsicWidth() +  6
                    * dTimeBmp.get(0).getIntrinsicWidth();
            h = dTimeBmp.get(0).getIntrinsicHeight();
        }

        boolean scaled = false;
        if (availableWidth < w || availableHeight < h) {
            scaled = true;
            float scale = Math.min((float) availableWidth / (float) w,
                    (float) availableHeight / (float) h);
            canvas.save();
            canvas.scale(scale, scale, x, y);
        }

        int dis_x = x - (w / 2);
        int dis_y = y - (h / 2);
        if (mTimeBg != null) {
            final Drawable timeBg = mTimeBg;
            timeBg.setBounds(dis_x, dis_y, dis_x + w, dis_y + h);
            timeBg.draw(canvas);
            canvas.save();
        }

        int pos = Integer.parseInt(mHour.substring(0, 1));
        Drawable timeBmp = dTimeBmp.get(pos);
        int numW = timeBmp.getIntrinsicWidth();
        int numH = timeBmp.getIntrinsicHeight();
        timeBmp.setBounds(dis_x, dis_y, dis_x + numW, dis_y + numH);
        timeBmp.draw(canvas);
        pos = Integer.parseInt(mHour.substring(1, 2));
        timeBmp = dTimeBmp.get(pos);
        timeBmp.setBounds(dis_x + numW, dis_y, dis_x + 2 * numW, dis_y + numH);
        timeBmp.draw(canvas);

        final Drawable timeColon = mTimeColon;
        int colonW = timeColon.getIntrinsicWidth();
        int colonH = timeColon.getIntrinsicHeight();
        if (colonH < numH) {
            timeColon.setBounds(dis_x + 2 * numW, dis_y + (numH - colonH) / 2,
                    dis_x + 2 * numW + colonW, dis_y + (numH - colonH) / 2
                            + colonH);
        } else {
            timeColon.setBounds(dis_x + 2 * numW, dis_y, dis_x + 2 * numW
                    + colonW, dis_y + colonH);
        }
        timeColon.draw(canvas);

        pos = Integer.parseInt(mMinutes.substring(0, 1));
        timeBmp = dTimeBmp.get(pos);
        timeBmp.setBounds(dis_x + 2 * numW + colonW, dis_y, dis_x + 3 * numW
                + colonW, dis_y + numH);
        timeBmp.draw(canvas);
        pos = Integer.parseInt(mMinutes.substring(1, 2));
        timeBmp = dTimeBmp.get(pos);
        timeBmp.setBounds(dis_x + 3 * numW + colonW, dis_y, dis_x + 4 * numW
                + colonW, dis_y + numH);
        timeBmp.draw(canvas);

        if (colonH < numH) {
            timeColon.setBounds(dis_x + 4 * numW+colonW, dis_y + (numH - colonH) / 2,
                    dis_x + 4 * numW + 2*colonW, dis_y + (numH - colonH) / 2
                            + colonH);
        } else {
            timeColon.setBounds(dis_x + 4 * numW+colonW, dis_y, dis_x + 4 * numW
                    + 2*colonW, dis_y + colonH);
        }
        timeColon.draw(canvas);

        pos = Integer.parseInt(mSecond.substring(0, 1));
        timeBmp = dTimeBmp.get(pos);
        timeBmp.setBounds(dis_x + 4 * numW + 2*colonW, dis_y, dis_x + 5 * numW
                + 2*colonW, dis_y + numH);
        timeBmp.draw(canvas);
        pos = Integer.parseInt(mSecond.substring(1, 2));
        timeBmp = dTimeBmp.get(pos);
        timeBmp.setBounds(dis_x + 5 * numW + 2*colonW, dis_y, dis_x + 6 * numW
                + 2*colonW, dis_y + numH);
        timeBmp.draw(canvas);

        if (!dApmBmp.isEmpty() && dApmBmp.size() > 0) {
            if (!get24HourMode()) {
                if (mCalendar.hour > 12) {
                    pos = 1;
                } else {
                    pos = 0;
                }
                timeBmp = dApmBmp.get(pos);
                int apmW = timeBmp.getIntrinsicWidth();
                int apmH = timeBmp.getIntrinsicHeight();
                if (apmH < numH) {
                    timeBmp.setBounds(dis_x + 4 * numW + colonW, dis_y
                            + (numH - apmH) / 2, dis_x + 4 * numW + colonW
                            + apmW, dis_y + (numH - apmH) / 2 + apmH);
                } else {
                    timeBmp.setBounds(dis_x + 4 * numW + colonW, dis_y, dis_x
                            + 4 * numW + colonW + apmW, dis_y + apmH);
                }
                timeBmp.draw(canvas);
            }
        }

        if (scaled) {
            canvas.restore();
        }
    }

    /**
     * Gets the 24 hour mode.
     *
     * @return the 24 hour mode
     */
    private boolean get24HourMode() {
        return android.text.format.DateFormat.is24HourFormat(getContext());
    }

    /**
     * On time changed.
     */
    private void onTimeChanged() {
        mCalendar.setToNow();

        if (!get24HourMode() && !dApmBmp.isEmpty() && dApmBmp.size() > 0) {
            if (mCalendar.hour > 12) {
                mHour = String.format("%02d", mCalendar.hour - 12);
            } else {
                mHour = String.format("%02d", mCalendar.hour);
            }
        } else {
            mHour = String.format("%02d", mCalendar.hour);
        }
        mSecond =  AbStrUtil.strFormat2(String.valueOf(mCalendar.second));
        mMinutes = String.format("%02d", mCalendar.minute);

        updateContentDescription(mCalendar);
        new Handler().postDelayed(new Runnable() {

            @Override
            public void run() {
                onTimeChanged();
            }
        }, 1000);
        invalidate();
    }

    /** The m intent receiver. 广播接受器*/
    private final BroadcastReceiver mIntentReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            if (intent.getAction().equals(Intent.ACTION_TIMEZONE_CHANGED)) {
                String tz = intent.getStringExtra("time-zone");
                mCalendar = new Time(TimeZone.getTimeZone(tz).getID());
            }
        }
    };

    /**
     * Update content description.
     *
     * @param time the time
     */
    private void updateContentDescription(Time time) {
        int flags = DateUtils.FORMAT_SHOW_TIME | DateUtils.FORMAT_24HOUR;

        String contentDescription = DateUtils.formatDateTime(this.getContext(),
                time.toMillis(false), flags);
        setContentDescription(contentDescription);
    }
}

```
代码的实现
```
 //  背景和分割字符
        Drawable timeBg = this.getResources().getDrawable(R.drawable.timer_bg);
        Drawable timeColon = this.getResources().getDrawable(R.drawable.timer_colon);

        List<Drawable> dTimeArray = new ArrayList<Drawable>();
        List<Drawable> dApmArray = new ArrayList<Drawable>();
//		这是10个数字
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time0));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time1));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time2));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time3));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time4));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time5));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time6));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time7));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time8));
        dTimeArray.add(this.getResources().getDrawable(R.drawable.time9));

        //AM 和PM的图标
        //dApmArray.add(this.getResources().getDrawable(R.drawable.time0));
        //dApmArray.add(this.getResources().getDrawable(R.drawable.time1));


        AbNumberClock view = new AbNumberClock(this, timeBg, timeColon, dTimeArray,dApmArray);
        LinearLayout contentLayout = (LinearLayout)this.findViewById(R.id.contentLayout);
        contentLayout.addView(view);
```
<h1 id="9101">1.台历</h1>

[返回目录](#91)

```
//        这个是台历的背景
        Drawable caleBg = this.getResources().getDrawable(R.drawable.desk_calendar);
        Drawable caleDot = null;
		Point posYear = new Point(60,80);
//		以下是十个数字年份
		List<Drawable> dYearArray = new ArrayList<Drawable>();
		dYearArray.add(this.getResources().getDrawable(R.drawable.year0));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year1));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year2));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year3));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year4));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year5));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year6));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year7));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year8));
		dYearArray.add(this.getResources().getDrawable(R.drawable.year9));
		
		
		Point posMonth = new Point(300,80);
//		这个是月份
		List<Drawable> dMonthArray = new ArrayList<Drawable>();
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month1));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month2));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month3));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month4));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month5));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month6));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month7));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month8));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month9));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month10));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month11));
		dMonthArray.add(this.getResources().getDrawable(R.drawable.month12));
//		这个是天
		Point posDate = new Point(90,180);
		List<Drawable> dDateArray = new ArrayList<Drawable>();
		dDateArray.add(this.getResources().getDrawable(R.drawable.date0));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date1));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date2));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date3));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date4));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date5));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date6));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date7));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date8));
		dDateArray.add(this.getResources().getDrawable(R.drawable.date9));
		
		Point posWeek = new Point(322,235);
		List<Drawable> dWeekArray = new ArrayList<Drawable>();
        
		AbCalendar view = new AbCalendar(this, caleBg, caleDot, posYear, dYearArray,
				posMonth, dMonthArray, posDate, dDateArray, posWeek,
				dWeekArray);
        
		LinearLayout contentLayout = (LinearLayout)this.findViewById(R.id.contentLayout);
		contentLayout.addView(view);
```

<h1 id="10001">1.我的联系人</h1>

[返回目录](#100)

xml布局文件
```
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:background="@color/gray_white"
    android:orientation="vertical" >

    <com.ab.view.sliding.AbSlidingSmoothFixTabView
        android:id="@+id/mAbSlidingTabView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent"/>

</RelativeLayout>
```
代码的实现
```
 private AbSlidingSmoothFixTabView mAbSlidingTabView = null;



mAbSlidingTabView = (AbSlidingSmoothFixTabView)findViewById(R.id.mAbSlidingTabView);
        
        //缓存数量
        mAbSlidingTabView.getViewPager().setOffscreenPageLimit(3);
        
        //禁止滑动
        /*mAbSlidingTabView.getViewPager().setOnTouchListener(new OnTouchListener(){

            @Override
            public boolean onTouch(View v, MotionEvent event) {
                return true;
            }
            
        });*/

        FragmentLoad page1 = new FragmentLoad();
        ContacterFragment mContacterFragment = new ContacterFragment();
        FragmentLoad page3 = new FragmentLoad();
//        这个是Fragmentd的容器
        List<Fragment> mFragments = new ArrayList<Fragment>();
        mFragments.add(page1);
        mFragments.add(mContacterFragment);
        mFragments.add(page3);
        
        List<String> tabTexts = new ArrayList<String>();
        tabTexts.add("会话");
        tabTexts.add("好友");
        tabTexts.add("群组");      
        //设置样式
        mAbSlidingTabView.setTabTextSize(15);
        mAbSlidingTabView.setTabColor(Color.BLACK);
        mAbSlidingTabView.setTabSelectedColor(Color.rgb(30, 168, 131));
//        这个是顶部的背景
        mAbSlidingTabView.setTabLayoutBackgroundResource(R.drawable.slide_top);
        //演示增加一组 一组有三个
        mAbSlidingTabView.addItemViews(tabTexts, mFragments);
        
        mAbSlidingTabView.setTabPadding(20, 8, 20, 8);
		
  	    //showProgressDialog();
```
<h1 id="10002">2.ContacterFragment 联系人列表界面</h1>

[返回目录](#100)

xml定义布局
```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:orientation="vertical" >

    <ExpandableListView
        android:id="@+id/contact_list"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:cacheColorHint="@color/transparent"
        android:childDivider="@drawable/list_divider"
        android:childIndicator="@null"
        android:scrollbars="none" >
    </ExpandableListView>
    
    <Button 
        android:id="@+id/tan"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="打开会话"/>

</LinearLayout>
```
代码实现 联系人列表
```

package com.andbase.im.activity;

import java.util.ArrayList;
import java.util.List;

import org.jivesoftware.smack.Roster;

import android.app.Fragment;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ExpandableListView;
import android.widget.ExpandableListView.OnChildClickListener;

import com.andbase.R;
import com.andbase.global.MyApplication;
import com.andbase.im.adapter.ContacterExpandableListAdapter;
import com.andbase.im.model.IMRosterGroup;
import com.andbase.im.model.IMUser;
import com.andbase.im.util.IMUtil;
import com.andbase.model.User;

/**
 * 联系人列表界面
 *
 */
public class ContacterFragment extends Fragment {
	
	private MyApplication application;
	private ContacterActivity mActivity = null;
	private ExpandableListView mListView;
//	这个是两组数据
	private List<String> mGroupNames;
	private List<IMRosterGroup> mIMRosterGroups;
	
	private User mUser = null;
	private ContacterExpandableListAdapter mContacterListAdapter = null;
	
	public View onCreateView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) { 
		 mActivity = (ContacterActivity)this.getActivity();
		 application = (MyApplication) mActivity.getApplication();
		 
		 View view = inflater.inflate(R.layout.im_contact_list, null);
		 mListView = (ExpandableListView) view.findViewById(R.id.contact_list);
		 
		 Button b=(Button)view.findViewById(R.id.tan);
		 
		 b.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
				toChat("tan");
			}
		});
		 
		 mGroupNames = new ArrayList<String>();
		 mIMRosterGroups = new ArrayList<IMRosterGroup>();
		 
		 mContacterListAdapter = new ContacterExpandableListAdapter(mActivity, mIMRosterGroups);
		 mListView.setAdapter(mContacterListAdapter);
			
		 mListView.setOnChildClickListener(new OnChildClickListener() {

				public boolean onChildClick(ExpandableListView parent, View v,
						int groupPosition, int childPosition, long id) {
					IMRosterGroup  mIMRosterGroup  = mIMRosterGroups.get(groupPosition);
					List<IMUser> mUsers = mIMRosterGroup.getUsers();
					IMUser user = mUsers.get(childPosition);
					toChat(user.getName());
					return true;
				}
		});
		 
		initContacter();
		 
		return view;
	} 
	
	
	@Override
	public void onStart() {
		super.onStart();
	}

	public void onActivityCreated(Bundle savedInstanceState) {
		super.onActivityCreated(savedInstanceState);
	}
	
	public void initContacter(){
		mGroupNames.clear();
		mIMRosterGroups.clear();
		//增加分组
		try {
			Roster mRoster = IMUtil.getRoster();
			mGroupNames.addAll(IMUtil.getGroupNames(mRoster));
			mIMRosterGroups.addAll(IMUtil.getRosterGroups(mRoster));
		} catch (Exception e) {
		    e.printStackTrace();
			mGroupNames.clear();
			mIMRosterGroups.clear();
		}
		mContacterListAdapter.notifyDataSetChanged();
		if(mGroupNames.size()>0){
			//扩大在分组列表视图组  将第一个组展开
			mListView.expandGroup(0);
		}
		
	}
	
	public void toChat(String userName){
	    //进入会话窗口
        Intent chatIntent = new Intent(mActivity,ChatActivity.class);
        chatIntent.putExtra("USERNAME", userName);
        startActivity(chatIntent);
    }
	
	

}


```
<h1 id="10801">1.与朋友的会话</h1>

[返回目录](#108)

```
比较难理解，所以没有做看懂，就没有在这里写注释
```
<h1 id="10501">1.重连接服务</h1>

[返回目录](#105)

```
package com.andbase.im.service;

import org.jivesoftware.smack.XMPPConnection;
import org.jivesoftware.smack.packet.Presence;

import android.app.Service;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.net.ConnectivityManager;
import android.os.IBinder;
import android.util.Log;
import android.widget.Toast;

import com.ab.task.AbTask;
import com.ab.task.AbTaskItem;
import com.ab.task.AbTaskListener;
import com.ab.util.AbAppUtil;
import com.andbase.im.global.IMConstant;
import com.andbase.im.util.IMUtil;

/**
 * 重连接服务.
 */
public class ReConnectService extends Service {
	private Context context;

	@Override
	public void onCreate() {
		context = this;
		Log.i("TAG", "[服务]重连服务：启动");
		//意图过滤器
		IntentFilter mFilter = new IntentFilter();
		mFilter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);
		//监听网络状态变化的 广播接收器
		registerReceiver(reConnectionBroadcastReceiver, mFilter);
		super.onCreate();
	}

	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		return super.onStartCommand(intent, flags, startId);
	}

	@Override
	public IBinder onBind(Intent intent) {
		return null;
	}

	@Override
	public void onDestroy() {
	    Log.i("TAG", "[服务]重连服务：关闭");
		unregisterReceiver(reConnectionBroadcastReceiver);
		super.onDestroy();
	}
//这个是广播
	BroadcastReceiver reConnectionBroadcastReceiver = new BroadcastReceiver() {

		@Override
		public void onReceive(Context context, Intent intent) {
			String action = intent.getAction();
			if (action.equals(ConnectivityManager.CONNECTIVITY_ACTION)) {
				Log.d("TAG", "----监听到网络状态改变----");
				XMPPConnection connection = IMUtil.getXMPPConnection();
				//网络是否可以连接到网络
				boolean isAvailable = AbAppUtil.isNetworkAvailable(context);
				//分别是网络可用和不可用时的状态
				if (isAvailable) {
					if (!connection.isConnected()) {
						reConnect(connection);
					} else {
						sendInentAndPre(IMConstant.RECONNECT_STATE_SUCCESS);
						Toast.makeText(context, "用户已上线!", Toast.LENGTH_LONG).show();
					}
				} else {
					sendInentAndPre(IMConstant.RECONNECT_STATE_FAIL);
					Toast.makeText(context, "网络断开,用户已离线!", Toast.LENGTH_LONG).show();
				}
			}

		}

	};

	/**
	 * 
	 * 递归重连，直连上为止.
	 * 
	 */
	public void reConnect(final XMPPConnection connection) {
	       AbTask task = new AbTask();
	       final AbTaskItem item = new AbTaskItem();
	       item.setListener(new AbTaskListener(){

                @Override
                public void get(){
                    try{
                        connection.connect();
                    }catch (Exception e){
                        e.printStackTrace();
                    }
                }
    
                @Override
                public void update(){
                    if (connection.isConnected()) {
                        Presence presence = new Presence(Presence.Type.available);
                        connection.sendPacket(presence);
                        Toast.makeText(context, "用户已上线!", Toast.LENGTH_LONG).show();
                     }else{
                         reConnect(connection);
                     }
                }
	           
	       });
	       
	       task.execute(item);
	}

	private void sendInentAndPre(boolean isSuccess) {
		Intent intent = new Intent();
		SharedPreferences preference = getSharedPreferences(IMConstant.IMSHARE,0);
		// 保存在线连接信息
		preference.edit().putBoolean(IMConstant.IS_ONLINE, isSuccess).commit();
		intent.setAction(IMConstant.ACTION_RECONNECT_STATE);
		intent.putExtra(IMConstant.RECONNECT_STATE, isSuccess);
		sendBroadcast(intent);
	}

}

```
<h1 id="10401">1.系统消息服务</h1>

[返回目录](#104)

```
package com.andbase.im.service;

import org.jivesoftware.smack.PacketListener;
import org.jivesoftware.smack.XMPPConnection;
import org.jivesoftware.smack.filter.MessageTypeFilter;
import org.jivesoftware.smack.packet.Message;
import org.jivesoftware.smack.packet.Message.Type;
import org.jivesoftware.smack.packet.Packet;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.IBinder;
import android.util.Log;

import com.ab.util.AbDateUtil;
import com.andbase.global.Constant;
import com.andbase.im.XmppConnectionManager;
import com.andbase.im.dao.IMMsgDao;
import com.andbase.im.global.IMConstant;
import com.andbase.im.model.IMMessage;

/**
 * 
 * 系统消息服务.
 * 
 */
public class IMSystemMsgService extends Service {
    
    /** 记录日志的标记. */
    private String TAG = IMSystemMsgService.class.getSimpleName();
    
    /** 记录日志的开关. */
    private boolean D = Constant.DEBUG;
    
	private Context context;
	
	private IMMsgDao mIMMsgDao = null;

	@Override
	public void onCreate() {
		context = this;
		Log.i("TAG", "[服务]系统消息服务：启动");
		init();
		super.onCreate();
	}

	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		return super.onStartCommand(intent, flags, startId);
	}

	@Override
	public IBinder onBind(Intent intent) {
		return null;
	}

	@Override
	public void onDestroy() {
	    Log.i("TAG", "[服务]系统消息服务：关闭");
		XmppConnectionManager.getInstance().getConnection()
				.removePacketListener(pListener);
		super.onDestroy();
	}

	private void init() {
	    //数据业务类
        mIMMsgDao = new IMMsgDao(context);
		XMPPConnection con = XmppConnectionManager.getInstance()
				.getConnection();
		con.addPacketListener(pListener, new MessageTypeFilter(
				Message.Type.normal));
	}

	// 来消息监听
	PacketListener pListener = new PacketListener() {

		@Override
		public void processPacket(Packet packetz) {
			Message message = (Message) packetz;
            if (message != null && message.getBody() != null
                    && !message.getBody().equals("null")) {
                if (message.getType() == Type.normal) {
                    
                    Log.i("TAG", "[服务]收到系统消息："+message.getBody());
                    
                    // 生成消息历史记录
                    IMMessage mIMMessage = new IMMessage();
                    mIMMessage.setTitle("系统信息");
                    mIMMessage.setContent(message.getBody());
                    
                    if (Message.Type.error == message.getType()) {
                        mIMMessage.setSendState(IMMessage.FAILED);
                    } else {
                        mIMMessage.setSendState(IMMessage.RECEIVED);
                    }
                    mIMMessage.setType(IMMessage.SYS_MSG);
                    
                    String from = message.getFrom().split("@")[0];
                    //发送方
                    mIMMessage.setUserName(from);
                    //接收方
                    mIMMessage.setToUserName(message.getTo().split("@")[0]);
                    
                    mIMMessage.setReadState(IMMessage.UNREAD);
                    
                    String time = AbDateUtil.getCurrentDate(AbDateUtil.dateFormatYMDHMS);
                    mIMMessage.setTime(time);
    
                    //保存本地
                    mIMMsgDao.startWritableDatabase(false);
                    long messageId = mIMMsgDao.insert(mIMMessage);
                    mIMMsgDao.closeDatabase();
    
                    if (messageId != -1) {
                        //发出接收到的系统消息
                        Intent intent = new Intent();
                        intent.setAction(IMConstant.ACTION_NEW_MESSAGE);
                        intent.setAction(IMConstant.ACTION_SYS_MESSAGE);
                        intent.putExtra("MESSAGE", mIMMessage);
                        sendBroadcast(intent);
    
                    }
    
                }
			}
		}
	};
	

}

```
<h1 id="10301">1.聊天服务</h1>

[返回目录](#103)

```
package com.andbase.im.service;

import org.jivesoftware.smack.PacketListener;
import org.jivesoftware.smack.XMPPConnection;
import org.jivesoftware.smack.filter.MessageTypeFilter;
import org.jivesoftware.smack.packet.Message;
import org.jivesoftware.smack.packet.Packet;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.IBinder;
import android.util.Log;

import com.ab.util.AbDateUtil;
import com.andbase.global.Constant;
import com.andbase.im.XmppConnectionManager;
import com.andbase.im.dao.IMMsgDao;
import com.andbase.im.global.IMConstant;
import com.andbase.im.model.IMMessage;
import com.andbase.im.util.IMUtil;

/**
 * 
 * 聊天服务.
 */
public class IMChatService extends Service {
    
    /** 记录日志的标记. */
    private String TAG = IMChatService.class.getSimpleName();
    
    /** 记录日志的开关. */
    private boolean D = Constant.DEBUG;
    
	private Context context;
	private IMMsgDao mIMMsgDao = null;

	@Override
	public void onCreate() {
		context = this;
		Log.i("TAG", "[服务]会话服务：启动");
		init();
		super.onCreate();
	}

	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		return super.onStartCommand(intent, flags, startId);
	}

	@Override
	public IBinder onBind(Intent intent) {
		return null;
	}

	@Override
	public void onDestroy() {
	    Log.i("TAG", "[服务]会话服务：关闭");
		super.onDestroy();
	}

	private void init() {
		//数据业务类
		mIMMsgDao = new IMMsgDao(context);
		XMPPConnection conn = XmppConnectionManager.getInstance()
				.getConnection();
		conn.addPacketListener(pListener, new MessageTypeFilter(
				Message.Type.chat));
		
		
	}

	/**监听到消息*/
	PacketListener pListener = new PacketListener() {

		@Override
		public void processPacket(Packet arg0) {
			Message message = (Message) arg0;
			if (message != null && message.getBody() != null
					&& !message.getBody().equals("null")) {
				
				Log.i("TAG", "[服务]收到会话消息："+message.getBody());
				
				// 生成消息历史记录
				IMMessage mIMMessage = new IMMessage();
				mIMMessage.setTitle("会话信息");
				mIMMessage.setContent(message.getBody());
				
				if (Message.Type.error == message.getType()) {
					mIMMessage.setSendState(IMMessage.FAILED);
				} else {
					mIMMessage.setSendState(IMMessage.RECEIVED);
				}
				mIMMessage.setType(IMMessage.CHAT_MSG);
				
				String from = IMUtil.getUserNameByJid(message.getFrom());
				//发送方
				mIMMessage.setUserName(from);
				//接收方
				mIMMessage.setToUserName(IMUtil.getUserNameByJid(message.getTo()));
				
				mIMMessage.setReadState(IMMessage.UNREAD);
				
				String time = AbDateUtil.getCurrentDate(AbDateUtil.dateFormatYMDHMS);
				mIMMessage.setTime(time);

				//保存本地
				mIMMsgDao.startWritableDatabase(false);
				long messageId = mIMMsgDao.insert(mIMMessage);
				mIMMsgDao.closeDatabase();

				if (messageId != -1) {
					//发出接收到会话的消息
					Intent intent = new Intent();
					intent.setAction(IMConstant.ACTION_NEW_MESSAGE);
					intent.setAction(IMConstant.ACTION_CHAT_MESSAGE);
					intent.putExtra("MESSAGE", mIMMessage);
					sendBroadcast(intent);

				}

			}

		}

	};
	
}

```
<h1 id="10201">1.联系人服务</h1>

[返回目录](#102)

```
package com.andbase.im.service;

import java.util.Collection;

import org.jivesoftware.smack.PacketListener;
import org.jivesoftware.smack.Roster;
import org.jivesoftware.smack.Roster.SubscriptionMode;
import org.jivesoftware.smack.RosterEntry;
import org.jivesoftware.smack.RosterListener;
import org.jivesoftware.smack.filter.PacketFilter;
import org.jivesoftware.smack.packet.Packet;
import org.jivesoftware.smack.packet.Presence;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.IBinder;
import android.util.Log;

import com.ab.util.AbDateUtil;
import com.andbase.global.Constant;
import com.andbase.im.dao.IMMsgDao;
import com.andbase.im.global.IMConstant;
import com.andbase.im.model.IMMessage;
import com.andbase.im.model.IMUser;
import com.andbase.im.util.IMUtil;

/**
 * 
 * 联系人服务.
 * 
 */
public class IMContactService extends Service {

    /** 记录日志的标记. */
    private String TAG = IMContactService.class.getSimpleName();
    
    /** 记录日志的开关. */
    private boolean D = Constant.DEBUG;
    
	private Roster roster = null;
	private Context context;
	private IMMsgDao mIMMsgDao = null;

	@Override
	public void onCreate() {
		context = this;
		Log.i("TAG", "[服务]联系人服务：启动");
		init();
		addSubscriptionListener();
		super.onCreate();
	}

	@Override
	public IBinder onBind(Intent intent) {
		return null;
	}

	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		return super.onStartCommand(intent, flags, startId);
	}

	private void init() {
		initRoster();
	}

	/**
	 * 添加一个监听，监听好友添加请求。
	 */
	private void addSubscriptionListener() {
		PacketFilter filter = new PacketFilter() {
			@Override
			public boolean accept(Packet packet) {
				if (packet instanceof Presence) {
					Presence presence = (Presence) packet;
					if (presence.getType().equals(Presence.Type.subscribe)) {
						return true;
					}
				}
				return false;
			}
		};
		IMUtil.getXMPPConnection()
				.addPacketListener(subscriptionPacketListener, filter);
	}

	/**
	 * 初始化花名册 服务重启时，更新花名册
	 */
	private void initRoster() {
	    roster = IMUtil.getRoster();
		roster.removeRosterListener(rosterListener);
		roster.addRosterListener(rosterListener);
		IMUtil.updateContacterList();
		//数据业务类
        mIMMsgDao = new IMMsgDao(context);
		
	}

	private PacketListener subscriptionPacketListener = new PacketListener() {

		@Override
		public void processPacket(Packet packet) {
		    
		    Log.i("TAG", "[服务]收到联系人消息："+packet.getFrom());
		    
		    //在登录中保存的
			String user = getSharedPreferences(IMConstant.IMSHARE, 0)
					.getString(IMConstant.USERNAME, null);
			if (packet.getFrom().contains(user))
				return;
			
			
			// 如果是自动接收所有请求，则回复一个添加信息
			if (Roster.getDefaultSubscriptionMode().equals(
					SubscriptionMode.accept_all)) {
				Presence subscription = new Presence(Presence.Type.subscribe);
				subscription.setTo(packet.getFrom());
				IMUtil.getXMPPConnection()
						.sendPacket(subscription);
			} else {
			    // 生成消息历史记录
                IMMessage mIMMessage = new IMMessage();
                mIMMessage.setTitle("好友请求");
                String from = IMUtil.getUserNameByJid(packet.getFrom());
                mIMMessage.setContent(from + "申请加您为好友");
                
                Log.i("TAG", "[服务]收到好友请求："+from + "申请加您为好友");
                
                mIMMessage.setSendState(IMMessage.RECEIVED);
                mIMMessage.setType(IMMessage.ADD_FRIEND_MSG);
                
                //发送方
                mIMMessage.setUserName(from);
                //接收方
                mIMMessage.setToUserName(IMUtil.getUserNameByJid(packet.getTo()));
                
                mIMMessage.setReadState(IMMessage.UNREAD);
                mIMMessage.setRequestState(IMMessage.ALL);
                String time = AbDateUtil.getCurrentDate(AbDateUtil.dateFormatYMDHMS);
                mIMMessage.setTime(time);

                //保存本地
                mIMMsgDao.startWritableDatabase(false);
                long messageId = mIMMsgDao.insert(mIMMessage);
                mIMMsgDao.closeDatabase();
                if (messageId != -1) {
                    //发出接收到会话的消息
                    Intent intent = new Intent();
                    intent.setAction(IMConstant.ACTION_ROSTER_SUBSCRIPTION);
                    intent.putExtra("MESSAGE", mIMMessage);
                    sendBroadcast(intent);

                }
			}
		}
	};


	@Override
	public void onDestroy() {
	    Log.i("TAG", "[服务]联系人服务：关闭");
		// 释放资源
	    IMUtil.getXMPPConnection()
				.removePacketListener(subscriptionPacketListener);
	    IMUtil.destroyContacterList();
		super.onDestroy();
	}

	private RosterListener rosterListener = new RosterListener() {

		@Override
		public void presenceChanged(Presence presence) {
			Intent intent = new Intent();
			intent.setAction(IMConstant.ACTION_ROSTER_PRESENCE_CHANGED);
			String subscriber = presence.getFrom().substring(0,
					presence.getFrom().indexOf("/"));
			RosterEntry entry = roster.getEntry(subscriber);
			if (IMUtil.contacters.containsKey(subscriber)) {
				// 将状态改变之前的user广播出去
				intent.putExtra(IMUser.USERKEY,
				        IMUtil.contacters.get(subscriber));
				IMUtil.contacters.remove(subscriber);
				IMUtil.contacters.put(subscriber,
				        IMUtil.transEntryToUser(entry, roster));
			}
			sendBroadcast(intent);
		}

		@Override //更新联系人
		public void entriesUpdated(Collection<String> addresses) {
			for (String address : addresses) {
				Intent intent = new Intent();
				intent.setAction(IMConstant.ACTION_ROSTER_UPDATED);
				// 获得状态改变的entry
				RosterEntry userEntry = roster.getEntry(address);
				IMUser user = IMUtil
						.transEntryToUser(userEntry, roster);
				if (IMUtil.contacters.get(address) != null) {
					// 这里发布的是更新前的user
					intent.putExtra(IMUser.USERKEY,
					        IMUtil.contacters.get(address));
					// 将发生改变的用户更新到userManager
					IMUtil.contacters.remove(address);
					IMUtil.contacters.put(address, user);
				}
				sendBroadcast(intent);
				// 用户更新，getEntries会更新
				// roster.getUnfiledEntries中的entry不会更新
			}
		}

		@Override //删除联系人
		public void entriesDeleted(Collection<String> addresses) {
			for (String address : addresses) {
				Intent intent = new Intent();
				intent.setAction(IMConstant.ACTION_ROSTER_DELETED);
				IMUser user = null;
				if (IMUtil.contacters.containsKey(address)) {
					user = IMUtil.contacters.get(address);
					IMUtil.contacters.remove(address);
				}
				intent.putExtra(IMUser.USERKEY, user);
				sendBroadcast(intent);
			}
		}

		@Override //添加联系人
		public void entriesAdded(Collection<String> addresses) {
			for (String address : addresses) {
				Intent intent = new Intent();
				intent.setAction(IMConstant.ACTION_ROSTER_ADDED);
				RosterEntry userEntry = roster.getEntry(address);
				IMUser user = IMUtil
						.transEntryToUser(userEntry, roster);
				IMUtil.contacters.put(address, user);
				intent.putExtra(IMUser.USERKEY, user);
				sendBroadcast(intent);
			}
		}
	};
	
	

}

```
<h1 id="10901">1.接收消息的广播接受器</h1>

[返回目录](#109)

```
package com.andbase.im.receiver;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

import com.ab.db.storage.AbSqliteStorage;
import com.andbase.R;
import com.andbase.friend.UserDao;
import com.andbase.im.activity.MessageActivity;
import com.andbase.im.model.IMMessage;
import com.andbase.main.MainActivity;

public class IMMessageReceiver extends BroadcastReceiver {

	private final static String TAG = "PushMessageReceiver";
	//通知管理器
	private NotificationManager mNotificationManager;
	//通知的id
	private static int NOTIFICATIONS_ID = R.layout.main;
	//数据库操作类
	public AbSqliteStorage mAbSqliteStorage = null;
	public UserDao mUserDao = null;
	
	@Override
	public void onReceive(Context context, Intent intent) {
        
		IMMessage mIMMessage = (IMMessage)intent.getParcelableExtra("MESSAGE");
		if(mIMMessage!=null){
		    
		     //获取通知管理器
            mNotificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);
            //设置通知的图标与提示的内容
            Notification notification = new Notification(R.drawable.ic_launcher,"新消息",System.currentTimeMillis());
            //点击跳转
            Intent mIntent  = null;
            if(mIMMessage.getType()==IMMessage.ADD_FRIEND_MSG){
			    Log.d(TAG, "[广播接收器]收到了好友请求:" + mIMMessage.getContent());
			    mIntent  = new Intent(context, MessageActivity.class);
            }else if(mIMMessage.getType()==IMMessage.CHAT_MSG){
			    Log.d(TAG, "[广播接收器]收到了会话消息:" + mIMMessage.getContent());
			    mIntent  = new Intent(context, MainActivity.class);
	            mIntent.putExtra("USERNAME", mIMMessage.getUserName());
	            mIntent.putExtra("TYPE",mIMMessage.getType());
			}else if(mIMMessage.getType()==IMMessage.SYS_MSG){
                Log.d(TAG, "[广播接收器]收到了系统消息:" + mIMMessage.getContent());
                mIntent  = new Intent(context, MessageActivity.class);
            }
	        
	        PendingIntent contentIntent = PendingIntent.getActivity(context, 0,mIntent, 0);
	        
	        //设置通知的标题与显示的内容及点击通知后的跳转
	        notification.setLatestEventInfo(context,mIMMessage.getUserName(), mIMMessage.getContent(), contentIntent);
	        //点击notification之后，该notification自动消失
	        notification.flags = Notification.FLAG_AUTO_CANCEL;
	        //notification被notify的时候，触发默认声音和默认震动
	        notification.defaults = Notification.DEFAULT_SOUND|Notification.DEFAULT_VIBRATE;
	        //显示通知
	        mNotificationManager.notify(NOTIFICATIONS_ID, notification);
			
		}else{
			Log.d(TAG, "收到了消息:空");
		}
		
		
	}


}

```
<h1 id="10101">1.系统通知 分配从数据库加载数据</h1>

[返回目录](#101)

```
package com.andbase.im.activity;

import java.util.ArrayList;
import java.util.List;

import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.Toast;

import com.ab.activity.AbActivity;
import com.ab.db.storage.AbSqliteStorage;
import com.ab.db.storage.AbSqliteStorageListener.AbDataSelectListener;
import com.ab.db.storage.AbStorageQuery;
import com.ab.util.AbToastUtil;
import com.ab.view.pullview.AbPullToRefreshView;
import com.ab.view.pullview.AbPullToRefreshView.OnFooterLoadListener;
import com.ab.view.pullview.AbPullToRefreshView.OnHeaderRefreshListener;
import com.ab.view.titlebar.AbTitleBar;
import com.andbase.R;
import com.andbase.global.MyApplication;
import com.andbase.im.adapter.MessageListAdapter;
import com.andbase.im.dao.IMMsgDao;
import com.andbase.im.model.IMMessage;
/**
 * 消息列表界面
 *
 */
public class MessageActivity extends AbActivity implements OnHeaderRefreshListener,OnFooterLoadListener{
	
    private MyApplication application;
    private List<IMMessage> list = null;
    private AbPullToRefreshView mAbPullToRefreshView = null;
	private ListView mListView = null;
    private MessageListAdapter myListViewAdapter = null;
    //每一页显示的行数
    public int pageSize = 10;
    //当前页数
    public int pageNum = 1;
    
    //数据库操作类
    private AbSqliteStorage mAbSqliteStorage = null;
    private IMMsgDao mIMMsgDao = null;
    
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setAbContentView(R.layout.im_message_list);
        
        AbTitleBar mAbTitleBar = this.getTitleBar();
        mAbTitleBar.setTitleText(R.string.message_name);
        mAbTitleBar.setLogo(R.drawable.button_selector_back);
        mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
        mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
        mAbTitleBar.setLogoLine(R.drawable.line);
        
        ImageView ii=new ImageView(this);
        ii.setImageResource(R.drawable.button_selector_back);
        ii.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
				Toast.makeText(MessageActivity.this,"你好", 1).show();
			}
		});
        mAbTitleBar.addRightView(ii);
        
        application = (MyApplication) getApplication();
        
        //初始化AbSqliteStorage
        mAbSqliteStorage = AbSqliteStorage.getInstance(this);
        //数据业务类
        mIMMsgDao = new IMMsgDao(this);
        
        //获取ListView对象
        mAbPullToRefreshView = (AbPullToRefreshView)this.findViewById(R.id.mPullRefreshView);
        mListView = (ListView)this.findViewById(R.id.mListView);
        
        //打开关闭下拉刷新加载更多功能
        mAbPullToRefreshView.setOnHeaderRefreshListener(this);
        mAbPullToRefreshView.setOnFooterLoadListener(this);
        
        //设置进度条的样式
        mAbPullToRefreshView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        mAbPullToRefreshView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular));
        //mAbPullListView.getHeaderView().setHeaderProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular2));
        //mAbPullListView.getFooterView().setFooterProgressBarDrawable(this.getResources().getDrawable(R.drawable.progress_circular2));
        
        //ListView数据
        list = new ArrayList<IMMessage>();
       
        //使用自定义的Adapter 
        myListViewAdapter = new MessageListAdapter(this,list);
        mListView.setAdapter(myListViewAdapter);
        //item被点击事件
        mListView.setOnItemClickListener(new OnItemClickListener(){
           @Override
           public void onItemClick(AdapterView<?> parent, View view,
                   int position, long id) {
           }
        });
        
    }

    @Override
    protected void onResume(){
        //第一次下载数据
        list.clear();
        queryData(0);
        
        super.onResume();
    }
    
    @Override
    public void onHeaderRefresh(AbPullToRefreshView view) {
    	pageNum = 1;
        list.clear();
        queryData(0);
    }
    
    @Override
    public void onFooterLoad(AbPullToRefreshView view) {
    	pageNum ++;
        queryData(1);
    }
    
//这个是从数据库查询数据  query是0则表示刷新
    public void queryData(final int query){
        //查询数据 类型是以下两种
        AbStorageQuery mAbStorageQuery = new AbStorageQuery();
        mAbStorageQuery.equals("type", IMMessage.SYS_MSG);
        
        AbStorageQuery mAbStorageQuery2 = new AbStorageQuery();
        mAbStorageQuery2.equals("type", IMMessage.ADD_FRIEND_MSG);
        
        mAbStorageQuery.or(mAbStorageQuery2);
       // 每次加载10条
        mAbStorageQuery.setLimit(pageSize);
        //从第几个数据开始加载
        mAbStorageQuery.setOffset((pageNum-1)*pageSize);
        
        //无sql存储的查询
        mAbSqliteStorage.findData(mAbStorageQuery, mIMMsgDao, new AbDataSelectListener(){

            @Override
            public void onFailure(int errorCode, String errorMessage) {
                AbToastUtil.showToast(MessageActivity.this,errorMessage);
            }

            @Override
            public void onSuccess(List<?> paramList) {
                if(query==0){
                    if(paramList!=null && paramList.size()>0){
                        list.addAll((List<IMMessage> )paramList);
                        myListViewAdapter.notifyDataSetChanged();
                    }
                    mAbPullToRefreshView.onHeaderRefreshFinish();
                }else{
                    if(paramList!=null){
                        list.addAll((List<IMMessage>)paramList);
                        myListViewAdapter.notifyDataSetChanged();
                    }
                    mAbPullToRefreshView.onFooterLoadFinish();
                }
                
            }
            
        });
        
    }
    
}

```


<h1 id="0301">1.类 MainActivity主页</h1>

[返回目录](#1)

![](http://i.imgur.com/qgoGTaJ.png)
xml文件
```
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity">

    <ProgressBar
        android:id="@+id/progress_bar"
        style="?android:progressBarStyleHorizontal"
        android:layout_width="fill_parent"
        android:layout_height="8dip"
        android:max="100"
        android:progress="0"
        android:progressDrawable="@drawable/progress_horizontal_img"
        android:visibility="gone" />

    <WebView
        android:id="@+id/webView"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent"/>

</LinearLayout>

```
右边的按钮
```
<?xml version="1.0" encoding="UTF-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:orientation="horizontal" >

    <ImageButton
        android:id="@+id/line1"
        android:layout_width="1dip"
        android:layout_height="wrap_content"
        android:layout_gravity="center_vertical"
        android:background="@drawable/line"
        android:scaleType="fitCenter" />

    <Button
        android:id="@+id/moreBtn"
        android:layout_width="48dp"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal|center_vertical"
        android:background="@drawable/button_selector_more" />.

    <ImageButton
        android:id="@+id/line2"
        android:layout_width="1dip"
        android:layout_height="wrap_content"
        android:background="@drawable/line"
        android:scaleType="fitCenter"
        android:layout_gravity="center_vertical"/>

    <Button
        android:id="@+id/appBtn"
        android:layout_width="48dp"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal|center_vertical"
        android:background="@drawable/button_selector_app" />

</LinearLayout>
```
源代码的实现
```
package com.tyq.StudyDiary;

import android.app.Activity;
import android.content.Intent;
import android.graphics.Bitmap;
import android.os.Build;
import android.os.Handler;
import android.support.v7.app.ActionBarActivity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.webkit.JsPromptResult;
import android.webkit.JsResult;
import android.webkit.WebChromeClient;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;

import com.ab.activity.AbActivity;
import com.ab.util.AbToastUtil;
import com.ab.view.titlebar.AbTitleBar;


public class MainActivity extends AbActivity {
    // 标题栏
    private AbTitleBar mAbTitleBar = null;
    // 主界面
    private WebView mWebView = null;
    //进度条
    private ProgressBar mProgressBar = null;
    //访问的网址
    String url = "https://tanyinqing.github.io/";
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setAbContentView(R.layout.activity_main);
        //初始化标题
        initTitle();
        //初始化右边标题
        initTitleRightLayout();

        mWebView = (WebView)findViewById(R.id.webView);
        mProgressBar = (ProgressBar)findViewById(R.id.progress_bar);
        // 设置支持JavaScript脚本
        WebSettings webSettings = mWebView.getSettings();
        //解决高版本图片不显示  在5.0以下的系统即使不加这句话，图片也可以正常显示，亲测有效。
        if(Build.VERSION.SDK_INT>=Build.VERSION_CODES.LOLLIPOP) {
            webSettings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);
        }
        webSettings.setBlockNetworkImage(false);//解决图片不显示
        webSettings.setJavaScriptEnabled(true);
        // 设置可以访问文件
        webSettings.setAllowFileAccess(true);
        // 设置可以支持缩放
        webSettings.setSupportZoom(true);
        // 设置默认缩放方式尺寸是far
        webSettings.setDefaultZoom(WebSettings.ZoomDensity.MEDIUM);
        // 设置出现缩放工具
        webSettings.setBuiltInZoomControls(false);
        webSettings.setDefaultFontSize(24);

        // 回到首页
        mWebView.loadUrl(url);

        // 设置WebViewClient
        mWebView.setWebViewClient(new WebViewClient() {
            // url拦截
            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url) {
                // 使用自己的WebView组件来响应Url加载事件，而不是使用默认浏览器器加载页面
                view.loadUrl(url);
                // 相应完成返回true
                return true;
                // return super.shouldOverrideUrlLoading(view, url);
            }

            // 页面开始加载  显示进度条
            @Override
            public void onPageStarted(WebView view, String url, Bitmap favicon) {
                mProgressBar.setVisibility(View.VISIBLE);
                super.onPageStarted(view, url, favicon);
            }

            // 页面加载完成  隐藏进度条
            @Override
            public void onPageFinished(WebView view, String url) {
                mProgressBar.setVisibility(View.GONE);
                super.onPageFinished(view, url);
            }

            // WebView加载的所有资源url
            @Override
            public void onLoadResource(WebView view, String url) {
                super.onLoadResource(view, url);
            }

            @Override
            public void onReceivedError(WebView view, int errorCode,
                                        String description, String failingUrl) {
                super.onReceivedError(view, errorCode, description, failingUrl);
            }

        });

        // 设置WebChromeClient
        mWebView.setWebChromeClient(new WebChromeClient() {
            @Override
            // 处理javascript中的alert
            public boolean onJsAlert(WebView view, String url, String message,
                                     final JsResult result) {
                return super.onJsAlert(view, url, message, result);
            };

            @Override
            // 处理javascript中的confirm
            public boolean onJsConfirm(WebView view, String url,
                                       String message, final JsResult result) {
                return super.onJsConfirm(view, url, message, result);
            };

            @Override
            // 处理javascript中的prompt
            public boolean onJsPrompt(WebView view, String url, String message,
                                      String defaultValue, final JsPromptResult result) {
                return super.onJsPrompt(view, url, message, defaultValue,
                        result);
            };

            // 设置网页加载的进度条  不断跟新进度条
            @Override
            public void onProgressChanged(WebView view, int newProgress) {
                mProgressBar.setProgress(newProgress);
                super.onProgressChanged(view, newProgress);
            }

            // 设置程序的Title
            @Override
            public void onReceivedTitle(WebView view, String title) {
                super.onReceivedTitle(view, title);
            }
        });
    }

    private Boolean isExit = false;
    /**
     * 描述：返回.
     */
    @Override
    public void onBackPressed() {
            if (canBack()) {//如果网页不能够回退
                if (isExit == false) {//如果是2秒内第一次按返回键
                    isExit = true;
                    AbToastUtil.showToast(MainActivity.this,"再按一次退出程序");
                    new Handler().postDelayed(new Runnable(){

                        @Override
                        public void run() {
                            isExit = false;
                        }

                    }, 2000);
                } else {//如果是2秒内第二次按返回键
                    super.onBackPressed();
                }
            }
    }

    /**
     *
     * 描述：页面是否能退回
     * @return
     * @throws
     * @date：2013-12-13 上午11:06:58
     * @version v1.0
     */
    public boolean canBack(){
        if(mWebView.canGoBack()){
            mWebView.goBack();
            return false;
        }
        return true;
    }
    //初始化标题
    private void initTitle() {
        mAbTitleBar = this.getTitleBar();
        mAbTitleBar.setTitleText(R.string.im_login);
        mAbTitleBar.setLogo(R.drawable.button_selector_back);
        mAbTitleBar.setTitleBarBackground(R.drawable.top_bg);
        mAbTitleBar.setTitleTextMargin(10, 0, 0, 0);
        mAbTitleBar.setLogoLine(R.drawable.line);
        //限制标题栏的高
        RelativeLayout.LayoutParams buttonParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, DensityUtil.dip2px(this, 48));
        buttonParams.setMargins(0, 0, 0, 0);
        mAbTitleBar.setLayoutParams(buttonParams);
        mAbTitleBar.setPadding(0, 0, 0, 0);
//这个是现在返回键的大小
        RelativeLayout.LayoutParams mTitleLogoViewParams = new RelativeLayout.LayoutParams(DensityUtil.dip2px(this, 48),DensityUtil.dip2px(this, 48));
        mTitleLogoViewParams.setMargins(0, 0, 0, 0);
        mAbTitleBar.getLogoView().setLayoutParams(mTitleLogoViewParams);

//这个是分割的竖线
        RelativeLayout.LayoutParams mTitleLogoLineParams = new RelativeLayout.LayoutParams(DensityUtil.dip2px(this, 2),DensityUtil.dip2px(this, 48));
        mTitleLogoLineParams.addRule(RelativeLayout.RIGHT_OF, mAbTitleBar.getLogoView().getId());
        mTitleLogoLineParams.setMargins(DensityUtil.dip2px(this, 48), 0, 0, 0);
        mAbTitleBar.getChildAt(1).setLayoutParams(mTitleLogoLineParams);

        mAbTitleBar.getLogoView().setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View arg0) {
                // 回到上一页
                if(mWebView.canGoBack()) {
                    mWebView.goBack();
                }
            }
        });
    }
    //初始化右边标题
    private void initTitleRightLayout() {
        mAbTitleBar.clearRightView();

        //显示的是下面这个
        View rightViewApp = mInflater.inflate(R.layout.more_btn, null);

        mAbTitleBar.addRightView(rightViewApp);
        Button about = (Button) rightViewApp.findViewById(R.id.moreBtn);
        Button appBtn = (Button) rightViewApp.findViewById(R.id.appBtn);

        appBtn.setOnClickListener(new View.OnClickListener() {

            @Override
            public void onClick(View v) {
                mWebView.loadUrl(url);
            }
        });

        about.setOnClickListener(new View.OnClickListener() {

            @Override
            public void onClick(View v) {
                mWebView.loadUrl(url);
            }

        });
    }
}

```